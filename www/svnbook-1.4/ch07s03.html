<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#20351;&#29992;&#22806;&#32622;&#27604;&#36739;&#24037;&#20855;</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.73.2"><link rel="start" href="index.html" title="Subversion &#26435;&#23041;&#25351;&#21335;"><link rel="up" href="ch07.html" title="&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#23450;&#21046;&#20320;&#30340; Subversion &#29992;&#27861;"><link rel="prev" href="ch07s02.html" title="&#26412;&#22320;&#21270;"><link rel="next" href="ch08.html" title="&#31532;&nbsp;8&nbsp;&#31456;&nbsp;&#23884;&#20837; Subversion"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#20351;&#29992;&#22806;&#32622;&#27604;&#36739;&#24037;&#20855;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch07s02.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#23450;&#21046;&#20320;&#30340; Subversion &#29992;&#27861;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch08.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="svn.advanced.externaldifftools"></a>&#20351;&#29992;&#22806;&#32622;&#27604;&#36739;&#24037;&#20855;</h2></div></div></div><p>&#36873;&#39033;<code class="option">--diff-cmd</code>&#21644;<code class="option">--diff3-cmd</code>&#30340;&#24418;&#24335;&#30456;&#20284;&#65292;&#20063;&#26377;&#31867;&#20284;&#21517;&#31216;&#30340;&#36816;&#34892;&#37197;&#32622;&#21442;&#25968;&#65288;&#35265;<a class="xref" href="ch07.html#svn.advanced.confarea.opts.config" title="&#37197;&#32622;">&#8220;&#37197;&#32622;&#8221;&#19968;&#33410;</a>&#65289;&#65292;&#36825;&#20250;&#23548;&#33268;&#19968;&#20010;&#38169;&#35823;&#30340;&#35266;&#24565;&#65292;&#20063;&#23601;&#26159;&#22312;Subversion&#20013;&#20351;&#29992;&#22806;&#32622;&#30340;&#27604;&#36739;&#65288;&#25110;&#8220;<span class="quote">diff</span>&#8221;&#65289;&#21644;&#21512;&#24182;&#24037;&#20855;&#20250;&#38750;&#24120;&#30340;&#23481;&#26131;&#65292;&#34429;&#28982;Subversion&#21487;&#20197;&#20351;&#29992;&#22823;&#22810;&#25968;&#31867;&#20284;&#30340;&#24037;&#20855;&#65292;&#20294;&#26159;&#35774;&#32622;&#36825;&#20123;&#24037;&#20855;&#32477;&#38750;&#26131;&#20107;&#12290;</p><p>The interface between Subversion and external diff and merge
      tools harkens back to a time when Subversion's only contextual
      differencing capabilities were built around invocations of the
      GNU diffutils toolchain, specifically the
      <span class="command"><strong>diff</strong></span> and <span class="command"><strong>diff3</strong></span> utilities.
      To get the kind of behavior Subversion needed, it called these
      utilities with more than a handful of options and parameters,
      most of which were quite specific to the utilities.  Some time
      later, Subversion grew its own internal differencing library,
      and as a failover mechanism,
      <sup>[<a name="d0e12776" href="#ftn.d0e12776" class="footnote">48</a>]</sup>
      the <code class="option">--diff-cmd</code> and <code class="option">--diff3-cmd</code>
      options were added to the Subversion command-line client so
      users could more easily indicate that they preferred to use the
      GNU diff and diff3 utilities instead of the newfangled internal
      diff library.  If those options were used, Subversion would
      simply ignore the internal diff library, and fall back to
      running those external programs, lengthy argument lists and all.
      And that's where things remain today.</p><p>&#20154;&#20204;&#24456;&#24555;&#24847;&#35782;&#21040;&#20351;&#29992;&#31616;&#21333;&#30340;&#37197;&#32622;&#26426;&#21046;&#24517;&#39035;&#20351;Subversion&#20351;&#29992;&#20301;&#20110;&#29305;&#23450;&#20301;&#32622;&#30340;GNU diff&#21644;diff3&#24037;&#20855;&#65292;&#27605;&#31455;&#65292;Subversion&#24182;&#19981;&#39564;&#35777;&#20854;&#34987;&#21578;&#20043;&#35201;&#25191;&#34892;&#30340;&#31243;&#24207;&#26159;&#21542;&#26159;GNU&#30340;&#24037;&#20855;&#38142;&#30340;&#27604;&#36739;&#24037;&#20855;&#12290;&#21807;&#19968;&#21487;&#20197;&#37197;&#32622;&#30340;&#26041;&#38754;&#26159;&#22806;&#32622;&#24037;&#20855;&#22312;&#31995;&#32479;&#30340;&#20301;&#32622;&#8212;&#32780;&#19981;&#26159;&#36873;&#39033;&#38598;&#65292;&#21442;&#25968;&#39034;&#24207;&#31561;&#31561;&#12290;Subversion&#19968;&#30452;&#23558;&#36825;&#20123;GNU&#24037;&#20855;&#36873;&#39033;&#21457;&#32473;&#20320;&#30340;&#22806;&#32622;&#27604;&#36739;&#24037;&#20855;&#65292;&#32780;&#19981;&#31649;&#31243;&#24207;&#26159;&#21542;&#21487;&#20197;&#29702;&#35299;&#37027;&#20123;&#36873;&#39033;&#65292;&#37027;&#19981;&#26159;&#25152;&#26377;&#29992;&#25143;&#30452;&#35273;&#30340;&#26041;&#24335;&#12290;</p><p>&#20351;&#29992;&#22806;&#32622;&#27604;&#36739;&#21644;&#21512;&#24182;&#24037;&#20855;&#30340;&#20851;&#38190;&#26159;&#20351;&#29992;&#21253;&#35065;&#33050;&#26412;&#23558;Subversion&#30340;&#36755;&#20986;&#36716;&#21270;&#20026;&#20320;&#30340;&#33050;&#26412;&#31243;&#24207;&#21487;&#20197;&#29702;&#35299;&#30340;&#24418;&#24335;&#65292;&#28982;&#21518;&#23558;&#36825;&#20123;&#27604;&#36739;&#24037;&#20855;&#30340;&#36755;&#20986;&#36716;&#21270;&#20026;&#20320;&#30340;Subversion&#26399;&#26395;&#30340;&#26684;&#24335;&#8212;GNU&#24037;&#20855;&#21487;&#33021;&#20351;&#29992;&#30340;&#26684;&#24335;&#65292;&#19979;&#38754;&#30340;&#23567;&#33410;&#35206;&#30422;&#20102;&#37027;&#20123;&#26399;&#26395;&#26684;&#24335;&#30340;&#32454;&#33410;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">&#27880;&#24847;</h3><p>The decision on when to fire off a contextual diff or
        merge as part of a larger Subversion operation is made
        entirely by Subversion, and is affected by, among other
        things, whether or not the files being operated on are
        human-readable as determined by their
        <code class="literal">svn:mime-type</code> property.  This means, for
        example, that even if you had the niftiest Microsoft
        Word-aware differencing or merging tool in the Universe, it
        would never be invoked by Subversion so long as your versioned
        Word documents had a configured MIME type that denoted that
        they were not human-readable (such as
        <code class="literal">application/msword</code>).  For more about MIME
        type settings, see <a class="xref" href="ch03s03.html#svn.advanced.props.special.mime-type" title="&#25991;&#20214;&#20869;&#23481;&#31867;&#22411;">&#8220;&#25991;&#20214;&#20869;&#23481;&#31867;&#22411;&#8221;&#19968;&#33410;</a></p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.advanced.externaldifftools.diff"></a>&#22806;&#32622; diff</h3></div></div></div><p>Subversion calls external diff programs with parameters
        suitable for the GNU diff utility, and expects only that the
        external program return with a successful error code.  For
        most alternative diff programs, only the sixth and seventh
        arguments&#8212;the paths of the files which represent the left and
        right sides of the diff, respectively&#8212;are of interest.  Note
        that Subversion runs the diff program once per modified file
        covered by the Subversion operation, so if your program runs
        in an asynchronous fashion (or &#8220;<span class="quote">backgrounded</span>&#8221;),
        you might have several instances of it all running
        simultaneously.  Finally, Subversion expects that your program
        return an error code of 1 if your program detected differences,
        or 0 if it did not&#8212;any other error code is considered a
        fatal error.
        <sup>[<a name="d0e12810" href="#ftn.d0e12810" class="footnote">49</a>]</sup>
      </p><p><a class="xref" href="ch07s03.html#svn.advanced.externaldifftools.diff.ex-1" title="&#20363;&nbsp;7.2.&nbsp;diffwrap.sh">&#20363;&nbsp;7.2 &#8220;diffwrap.sh&#8221;</a>&#21644;<a class="xref" href="ch07s03.html#svn.advanced.externaldifftools.diff.ex-2" title="&#20363;&nbsp;7.3.&nbsp;diffwrap.bat">&#20363;&nbsp;7.3 &#8220;diffwrap.bat&#8221;</a>&#20998;&#21035;&#26159;Bourne shell&#21644;Windows&#25209;&#22788;&#29702;&#22806;&#32622;diff&#24037;&#20855;&#30340;&#21253;&#35065;&#22120;&#27169;&#29256;&#12290;</p><div class="example"><a name="svn.advanced.externaldifftools.diff.ex-1"></a><p class="title"><b>&#20363;&nbsp;7.2.&nbsp;diffwrap.sh</b></p><div class="example-contents"><pre class="programlisting">
#!/bin/sh

# Configure your favorite diff program here.
DIFF="/usr/local/bin/my-diff-tool"

# Subversion provides the paths we need as the sixth and seventh 
# parameters.
LEFT=${6}
RIGHT=${7}

# Call the diff command (change the following line to make sense for
# your merge program).
$DIFF --left $LEFT --right $RIGHT

# Return an errorcode of 0 if no differences were detected, 1 if some were.
# Any other errorcode will be treated as fatal.
</pre></div></div><br class="example-break"><div class="example"><a name="svn.advanced.externaldifftools.diff.ex-2"></a><p class="title"><b>&#20363;&nbsp;7.3.&nbsp;diffwrap.bat</b></p><div class="example-contents"><pre class="programlisting">
@ECHO OFF

REM Configure your favorite diff program here.
SET DIFF="C:\Program Files\Funky Stuff\My Diff Tool.exe"

REM Subversion provides the paths we need as the sixth and seventh 
REM parameters.
SET LEFT=%6
SET RIGHT=%7

REM Call the diff command (change the following line to make sense for
REM your merge program).
%DIFF% --left %LEFT% --right %RIGHT%

REM Return an errorcode of 0 if no differences were detected, 1 if some were.
REM Any other errorcode will be treated as fatal.
</pre></div></div><br class="example-break"></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.advanced.externaldifftools.diff3"></a>&#22806;&#32622; diff3</h3></div></div></div><p>Subversion calls external merge programs with parameters
        suitable for the GNU diff3 utility, expecting that the
        external program return with a successful error code and that
        the full file contents which result from the completed merge
        operation are printed on the standard output stream (so that
        Subversion can redirect them into the appropriate version
        controlled file).  For most alternative merge programs, only
        the ninth, tenth, and eleventh arguments, the paths of the
        files which represent the &#8220;<span class="quote">mine</span>&#8221;,
        &#8220;<span class="quote">older</span>&#8221;, and &#8220;<span class="quote">yours</span>&#8221; inputs,
        respectively, are of interest.  Note that because Subversion
        depends on the output of your merge program, you wrapper
        script must not exit before that output has been delivered to
        Subversion.  When it finally does exit, it should return an
        error code of 0 if the merge was successful, or 1 if unresolved
        conflicts remain in the output&#8212;any other error code is
        considered a fatal error.</p><p><a class="xref" href="ch07s03.html#svn.advanced.externaldifftools.diff3.ex-1" title="&#20363;&nbsp;7.4.&nbsp;diff3wrap.sh">&#20363;&nbsp;7.4 &#8220;diff3wrap.sh&#8221;</a>&#21644;<a class="xref" href="ch07s03.html#svn.advanced.externaldifftools.diff3.ex-2" title="&#20363;&nbsp;7.5.&nbsp;diff3wrap.bat">&#20363;&nbsp;7.5 &#8220;diff3wrap.bat&#8221;</a>&#20998;&#21035;&#26159;Bourne shell&#21644;Windows&#25209;&#22788;&#29702;&#22806;&#32622;diff&#24037;&#20855;&#30340;&#21253;&#35065;&#22120;&#27169;&#29256;&#12290;</p><div class="example"><a name="svn.advanced.externaldifftools.diff3.ex-1"></a><p class="title"><b>&#20363;&nbsp;7.4.&nbsp;diff3wrap.sh</b></p><div class="example-contents"><pre class="programlisting">
#!/bin/sh

# Configure your favorite diff3/merge program here.
DIFF3="/usr/local/bin/my-merge-tool"

# Subversion provides the paths we need as the ninth, tenth, and eleventh 
# parameters.
MINE=${9}
OLDER=${10}
YOURS=${11}

# Call the merge command (change the following line to make sense for
# your merge program).
$DIFF3 --older $OLDER --mine $MINE --yours $YOURS

# After performing the merge, this script needs to print the contents
# of the merged file to stdout.  Do that in whatever way you see fit.
# Return an errorcode of 0 on successful merge, 1 if unresolved conflicts
# remain in the result.  Any other errorcode will be treated as fatal.
</pre></div></div><br class="example-break"><div class="example"><a name="svn.advanced.externaldifftools.diff3.ex-2"></a><p class="title"><b>&#20363;&nbsp;7.5.&nbsp;diff3wrap.bat</b></p><div class="example-contents"><pre class="programlisting">
@ECHO OFF

REM Configure your favorite diff3/merge program here.
SET DIFF3="C:\Program Files\Funky Stuff\My Merge Tool.exe"

REM Subversion provides the paths we need as the ninth, tenth, and eleventh 
REM parameters.  But we only have access to nine parameters at a time, so we
REM shift our nine-parameter window twice to let us get to what we need.
SHIFT
SHIFT
SET MINE=%7
SET OLDER=%8
SET YOURS=%9

REM Call the merge command (change the following line to make sense for
REM your merge program).
%DIFF3% --older %OLDER% --mine %MINE% --yours %YOURS%

REM After performing the merge, this script needs to print the contents
REM of the merged file to stdout.  Do that in whatever way you see fit.
REM Return an errorcode of 0 on successful merge, 1 if unresolved conflicts
REM remain in the result.  Any other errorcode will be treated as fatal.
</pre></div></div><br class="example-break"></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e12776" href="#d0e12776" class="para">48</a>] </sup>Subversion&#30340;&#24320;&#21457;&#32773;&#24456;&#22909;&#65292;&#20294;&#26368;&#22909;&#30340;&#20063;&#20250;&#21457;&#29983;&#38169;&#35823;&#12290;</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e12810" href="#d0e12810" class="para">49</a>] </sup>GNU&#30340;diff&#25163;&#20876;&#36825;&#26679;&#35828;&#30340;&#65306;&#8220;<span class="quote">&#36820;&#22238;0&#24847;&#21619;&#30528;&#27809;&#26377;&#21306;&#21035;&#65292;1&#26159;&#26377;&#26377;&#21306;&#21035;&#65292;&#20854;&#23427;&#20540;&#24847;&#21619;&#30528;&#20986;&#29616;&#38382;&#39064;&#12290;</span>&#8221;</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07s02.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch07.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch08.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#26412;&#22320;&#21270;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;8&nbsp;&#31456;&nbsp;&#23884;&#20837; Subversion</td></tr></table></div></body></html>