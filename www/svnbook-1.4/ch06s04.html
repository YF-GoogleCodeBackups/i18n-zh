<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>httpd&#65292;Apache &#30340; HTTP &#26381;&#21153;&#22120;</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.73.2"><link rel="start" href="index.html" title="Subversion &#26435;&#23041;&#25351;&#21335;"><link rel="up" href="ch06.html" title="&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#26381;&#21153;&#37197;&#32622;"><link rel="prev" href="ch06s03.html" title="svnserve&#65292;&#19968;&#20010;&#23450;&#21046;&#30340;&#26381;&#21153;&#22120;"><link rel="next" href="ch06s05.html" title="&#22522;&#20110;&#36335;&#24452;&#30340;&#25480;&#26435;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">httpd&#65292;Apache &#30340; HTTP &#26381;&#21153;&#22120;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06s03.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#26381;&#21153;&#37197;&#32622;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch06s05.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="svn.serverconfig.httpd"></a>httpd&#65292;Apache &#30340; HTTP &#26381;&#21153;&#22120;</h2></div></div></div><p>The Apache HTTP Server is a &#8220;<span class="quote">heavy duty</span>&#8221;
      network server that Subversion can leverage.  Via a custom
      module, <span class="command"><strong>httpd</strong></span> makes Subversion repositories
      available to clients via the WebDAV/DeltaV protocol, which is an
      extension to HTTP 1.1 (see <code class="uri">http://www.webdav.org/</code>
      for more information).  This protocol takes the ubiquitous HTTP
      protocol that is the core of the World Wide Web, and adds
      writing&#8212;specifically, versioned
      writing&#8212;capabilities.  The result is a standardized,
      robust system that is conveniently packaged as part of the
      Apache 2.0 software, is supported by numerous operating systems
      and third-party products, and doesn't require network
      administrators to open up yet another custom port.
      <sup>[<a name="d0e10605" href="#ftn.d0e10605" class="footnote">41</a>]</sup>
      While an Apache-Subversion server has more features than
      <span class="command"><strong>svnserve</strong></span>, it's also a bit more difficult
      to set up.  With flexibility often comes more complexity.</p><p>Much of the following discussion includes references to
      Apache configuration directives.  While some examples are given
      of the use of these directives, describing them in full is
      outside the scope of this chapter.  The Apache team maintains
      excellent documentation, publicly available on their website at
      <code class="uri">http://httpd.apache.org</code>.  For example, a general
      reference for the configuration directives is located at <code class="uri">       http://httpd.apache.org/docs-2.0/mod/directives.html</code>.</p><p>Also, as you make changes to your Apache setup, it is likely
      that somewhere along the way a mistake will be made.  If you are
      not already familiar with Apache's logging subsystem, you should
      become aware of it.  In your <code class="filename">httpd.conf</code>
      file are directives that specify the on-disk locations of the
      access and error logs generated by Apache (the
      <code class="literal">CustomLog</code> and <code class="literal">ErrorLog</code>
      directives, respectively).  Subversion's mod_dav_svn uses
      Apache's error logging interface as well.  You can always browse
      the contents of those files for information that might reveal
      the source of a problem that is not clearly noticeable
      otherwise.</p><div class="sidebar"><p class="title"><b>&#20026;&#20160;&#20040;&#26159; Apache 2&#65311;</b></p><p>&#22914;&#26524;&#20320;&#31995;&#32479;&#31649;&#29702;&#21592;&#65292;&#24456;&#26377;&#21487;&#33021;&#26159;&#20320;&#24050;&#32463;&#36816;&#34892;&#20102;Apache&#26381;&#21153;&#22120;&#65292;&#24182;&#19988;&#26377;&#19968;&#20123;&#39640;&#32423;&#32463;&#39564;&#12290;&#20889;&#26412;&#25991;&#30340;&#26102;&#20505;&#65292;Apache 1.3&#26159;Apache&#26368;&#27969;&#34892;&#30340;&#29256;&#26412;&#65292;&#36825;&#20010;&#19990;&#30028;&#22240;&#20026;&#35768;&#22810;&#21407;&#22240;&#32780;&#25918;&#32531;&#21319;&#32423;&#21040;2.X&#31995;&#21015;&#65306;&#22914;&#20154;&#20204;&#23475;&#24597;&#25913;&#21464;&#65292;&#29305;&#21035;&#26159;&#20687;web&#26381;&#21153;&#22120;&#36825;&#31181;&#37325;&#35201;&#30340;&#21464;&#21270;&#65292;&#26377;&#20123;&#20154;&#38656;&#35201;&#19968;&#20123;&#22312;Apache 1.3 API&#19979;&#24037;&#20316;&#30340;&#25554;&#20214;&#27169;&#22359;&#65292;&#22312;&#31561;&#24453;2.X&#30340;&#29256;&#26412;&#12290;&#26080;&#35770;&#20160;&#20040;&#21407;&#22240;&#65292;&#35768;&#22810;&#20154;&#20250;&#22312;&#39318;&#27425;&#21457;&#29616;Subversion&#30340;Apache&#27169;&#22359;&#21482;&#26159;&#20026;Apache 2 API&#20889;&#30340;&#21518;&#24320;&#22987;&#25285;&#24515;&#12290;</p><p>&#23545;&#27492;&#38382;&#39064;&#30340;&#36866;&#24403;&#21453;&#24212;&#26159;&#65306;&#19981;&#38656;&#35201;&#25285;&#24515;&#65292;&#21516;&#26102;&#36816;&#34892;Apache 1.3&#21644;Apache 2&#38750;&#24120;&#31616;&#21333;&#65292;&#21482;&#38656;&#35201;&#23433;&#35013;&#21040;&#19981;&#21516;&#30340;&#20301;&#32622;&#65292;&#29992;Apache 2&#20316;&#20026;Subversion&#30340;&#19987;&#29992;&#26381;&#21153;&#22120;&#65292;&#24182;&#19988;&#19981;&#20351;&#29992;80&#31471;&#21475;&#65292;&#23458;&#25143;&#31471;&#21487;&#20197;&#35775;&#38382;&#29256;&#26412;&#24211;&#26102;&#22312;URL&#37324;&#25351;&#23450;&#31471;&#21475;&#65306;</p><pre class="screen">
$ svn checkout http://host.example.com:7382/repos/project
&#8230;
</pre></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.httpd.prereqs"></a>&#20808;&#20915;&#26465;&#20214;</h3></div></div></div><p>To network your repository over HTTP, you basically need
        four components, available in two packages.  You'll need
        Apache <span class="command"><strong>httpd</strong></span> 2.0, the
        <span class="command"><strong>mod_dav</strong></span> DAV module that comes with it,
        Subversion, and the <span class="command"><strong>mod_dav_svn</strong></span>
        filesystem provider module distributed with Subversion.
        Once you have all of those components, the process of
        networking your repository is as simple as:</p><div class="itemizedlist"><ul type="disc"><li><p>&#37197;&#32622;&#22909;httpd 2.0&#65292;&#24182;&#19988;&#20351;&#29992;mod_dav&#21551;&#21160;&#65292;</p></li><li><p>&#20026;mod_dav&#23433;&#35013;mod_dav_svn&#25554;&#20214;&#65292;&#23427;&#20250;&#20351;&#29992;Subversion&#30340;&#24211;&#35775;&#38382;&#29256;&#26412;&#24211;&#65292;&#24182;&#19988;</p></li><li><p>configuring your <code class="filename">httpd.conf</code>
            file to export (or expose) the repository.</p></li></ul></div><p>You can accomplish the first two items either by
        compiling <span class="command"><strong>httpd</strong></span> and Subversion from
        source code, or by installing pre-built binary packages of
        them on your system.  For the most up-to-date information on
        how to compile Subversion for use with the Apache HTTP Server,
        as well as how to compile and configure Apache itself for
        this purpose, see the <code class="filename">INSTALL</code> file in
        the top level of the Subversion source code tree.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.httpd.basic"></a>&#22522;&#26412;&#30340; Apache &#37197;&#32622;</h3></div></div></div><p>Once you have all the necessary components installed on
        your system, all that remains is the configuration of Apache
        via its <code class="filename">httpd.conf</code> file.  Instruct Apache
        to load the mod_dav_svn module using the
        <code class="literal">LoadModule</code> directive.  This directive must
        precede any other Subversion-related configuration items.  If
        your Apache was installed using the default layout, your
        <span class="command"><strong>mod_dav_svn</strong></span> module should have been
        installed in the <code class="filename">modules</code> subdirectory of
        the Apache install location (often
        <code class="filename">/usr/local/apache2</code>).  The
        <code class="literal">LoadModule</code> directive has a simple syntax,
        mapping a named module to the location of a shared library on
        disk:</p><pre class="screen">
LoadModule dav_svn_module     modules/mod_dav_svn.so
</pre><p>Note that if <span class="command"><strong>mod_dav</strong></span> was compiled as a
        shared object (instead of statically linked directly to the
        <span class="command"><strong>httpd</strong></span> binary), you'll need a similar
        <code class="literal">LoadModule</code> statement for it, too.  Be sure
        that it comes before the <span class="command"><strong>mod_dav_svn</strong></span> line:</p><pre class="screen">
LoadModule dav_module         modules/mod_dav.so
LoadModule dav_svn_module     modules/mod_dav_svn.so
</pre><p>At a later location in your configuration file, you now
        need to tell Apache where you keep your Subversion repository
        (or repositories).  The <code class="literal">Location</code> directive
        has an XML-like notation, starting with an opening tag, and
        ending with a closing tag, with various other configuration
        directives in the middle.  The purpose of the
        <code class="literal">Location</code> directive is to instruct Apache to
        do something special when handling requests that are directed
        at a given URL or one of its children.  In the case of
        Subversion, you want Apache to simply hand off support for
        URLs that point at versioned resources to the DAV layer.  You
        can instruct Apache to delegate the handling of all URLs whose
        path portions (the part of the URL that follows the server's
        name and the optional port number) begin with
        <code class="filename">/repos/</code> to a DAV provider whose
        repository is located at
        <code class="filename">/absolute/path/to/repository</code> using the
        following <code class="filename">httpd.conf</code> syntax:</p><pre class="screen">
&lt;Location /repos&gt;
  DAV svn
  SVNPath /absolute/path/to/repository
&lt;/Location&gt;
</pre><p>If you plan to support multiple Subversion repositories
        that will reside in the same parent directory on your local
        disk, you can use an alternative directive, the
        <code class="literal">SVNParentPath</code> directive, to indicate that
        common parent directory.  For example, if you know you will be
        creating multiple Subversion repositories in a directory
        <code class="filename">/usr/local/svn</code> that would be accessed via
        URLs like <code class="uri">http://my.server.com/svn/repos1</code>,
        <code class="uri">http://my.server.com/svn/repos2</code>, and
        so on, you could use the <code class="filename">httpd.conf</code>
        configuration syntax in the following example:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn

  # any "/svn/foo" URL will map to a repository /usr/local/svn/foo
  SVNParentPath /usr/local/svn
&lt;/Location&gt;
</pre><p>Using the previous syntax, Apache will delegate the
        handling of all URLs whose path portions begin with
        <code class="filename">/svn/</code> to the Subversion DAV provider,
        which will then assume that any items in the directory
        specified by the <code class="literal">SVNParentPath</code> directive
        are actually Subversion repositories.  This is a particularly
        convenient syntax in that, unlike the use of the
        <code class="literal">SVNPath</code> directive, you don't have to
        restart Apache in order to create and network new
        repositories.</p><p>Be sure that when you define your new
        <code class="literal">Location</code>, it doesn't overlap with other
        exported Locations.  For example, if your main
        <code class="literal">DocumentRoot</code> is exported to
        <code class="filename">/www</code>, do not export a Subversion
        repository in <code class="literal">&lt;Location /www/repos&gt;</code>.
        If a request comes in for the URI
        <code class="filename">/www/repos/foo.c</code>, Apache won't know
        whether to look for a file <code class="filename">repos/foo.c</code> in
        the <code class="literal">DocumentRoot</code>, or whether to delegate
        <span class="command"><strong>mod_dav_svn</strong></span> to return
        <code class="filename">foo.c</code> from the Subversion repository.
        The result is often an error from the server of the form
        <code class="literal">301 Moved Permanently</code>.</p><div class="sidebar"><p class="title"><b>&#26381;&#21153;&#22120;&#21517;&#31216;&#21644;&#22797;&#21046;&#35831;&#27714;</b></p><p>Subversion makes use of the <code class="literal">COPY</code>
          request type to perform server-side copies of files and
          directories.  As part of the sanity checking done by the
          Apache modules, the source of the copy is expected to be
          located on the same machine as the destination of the copy.
          To satisfy this requirement, you might need to tell mod_dav
          the name you use as the hostname of your server.  Generally,
          you can use the <code class="literal">ServerName</code> directive in
          <code class="filename">httpd.conf</code> to accomplish this.</p><pre class="screen">
ServerName svn.example.com
</pre><p>If you are using Apache's virtual hosting support via
          the <code class="literal">NameVirtualHost</code> directive, you may
          need to use the <code class="literal">ServerAlias</code> directive to
          specify additional names that your server is known by.
          Again, refer to the Apache documentation for full
          details.</p></div><p>&#22312;&#26412;&#38454;&#27573;&#65292;&#20320;&#19968;&#23450;&#35201;&#32771;&#34385;&#35775;&#38382;&#26435;&#38480;&#38382;&#39064;&#65292;&#22914;&#26524;&#20320;&#24050;&#32463;&#20316;&#20026;&#26222;&#36890;&#30340;web&#26381;&#21153;&#22120;&#36816;&#34892;&#36807;Apache&#65292;&#20320;&#19968;&#23450;&#26377;&#20102;&#19968;&#20123;&#20869;&#23481;&#8212;&#32593;&#39029;&#12289;&#33050;&#26412;&#21644;&#20854;&#20182;&#12290;&#36825;&#20123;&#39033;&#30446;&#24050;&#32463;&#37197;&#32622;&#20102;&#35768;&#22810;&#22312;Apache&#19979;&#21487;&#20197;&#24037;&#20316;&#30340;&#35775;&#38382;&#35768;&#21487;&#65292;&#25110;&#32773;&#26356;&#20934;&#30830;&#19968;&#28857;&#65292;&#20801;&#35768;Apache&#19982;&#36825;&#20123;&#25991;&#20214;&#19968;&#36215;&#24037;&#20316;&#12290;Apache&#24403;&#20316;&#20026;Subversion&#26381;&#21153;&#22120;&#36816;&#34892;&#26102;&#65292;&#21516;&#26679;&#38656;&#35201;&#27491;&#30830;&#30340;&#35775;&#38382;&#35768;&#21487;&#26469;&#35835;&#20889;&#20320;&#30340;Subversion&#29256;&#26412;&#24211;&#12290;</p><p>You will need to determine a permission system setup that
        satisfies Subversion's requirements without messing up any
        previously existing web page or script installations.  This
        might mean changing the permissions on your Subversion
        repository to match those in use by other things that Apache
        serves for you, or it could mean using the
        <code class="literal">User</code> and <code class="literal">Group</code>
        directives in <code class="filename">httpd.conf</code> to specify that
        Apache should run as the user and group that owns your
        Subversion repository.  There is no single correct way to set
        up your permissions, and each administrator will have
        different reasons for doing things a certain way.  Just be
        aware that permission-related problems are perhaps the most
        common oversight when configuring a Subversion repository for
        use with Apache.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.httpd.authn"></a>&#35748;&#35777;&#36873;&#39033;</h3></div></div></div><p>At this point, if you configured
        <code class="filename">httpd.conf</code> to contain something like</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn
&lt;/Location&gt;
</pre><p>&#8230;then your repository is &#8220;<span class="quote">anonymously</span>&#8221;
        accessible to the world.  Until you configure some
        authentication and authorization policies, the Subversion
        repositories you make available via the
        <code class="literal">Location</code> directive will be generally
        accessible to everyone.  In other words,</p><div class="itemizedlist"><ul type="disc"><li><p>anyone can use their Subversion client to check out a
            working copy of a repository URL (or any of its
            subdirectories),</p></li><li><p>&#20219;&#20309;&#20154;&#21487;&#20197;&#22312;&#27983;&#35272;&#22120;&#36755;&#20837;&#29256;&#26412;&#24211;URL&#20132;&#20114;&#27983;&#35272;&#30340;&#26041;&#24335;&#26469;&#26597;&#30475;&#29256;&#26412;&#24211;&#30340;&#26368;&#26032;&#20462;&#35746;&#29256;&#26412;&#65292;&#24182;&#19988;</p></li><li><p>&#20219;&#20309;&#20154;&#21487;&#20197;&#25552;&#20132;&#21040;&#29256;&#26412;&#24211;&#12290;</p></li></ul></div><p>Of course, you might have already set up
        a <code class="filename">pre-commit</code> hook script to prevent
        commits (see <a class="xref" href="ch05s03.html#svn.reposadmin.create.hooks" title="&#23454;&#29616;&#29256;&#26412;&#24211;&#38057;&#23376;">&#8220;&#23454;&#29616;&#29256;&#26412;&#24211;&#38057;&#23376;&#8221;&#19968;&#33410;</a>).
        But as you read on, you'll see that it's also possible use
        Apache's built-in methods to restrict access in specific
        ways.</p><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.authn.basic"></a>&#22522;&#26412; HTTP &#35748;&#35777;</h4></div></div></div><p>The easiest way to authenticate a client is via the
          HTTP Basic authentication mechanism, which simply uses a
          username and password to verify that a user is who she says
          she is.  Apache provides an <span class="command"><strong>htpasswd</strong></span>
          utility for managing the list of acceptable usernames and
          passwords.  Let's grant commit access to
          Sally and Harry.  First, we need to add them to the password
          file.</p><pre class="screen">
$ ### First time: use -c to create the file
$ ### Use -m to use MD5 encryption of the password, which is more secure
$ htpasswd -cm /etc/svn-auth-file harry
New password: *****
Re-type new password: *****
Adding password for user harry
$ htpasswd -m /etc/svn-auth-file sally
New password: *******
Re-type new password: *******
Adding password for user sally
$
</pre><p>Next, you need to add some more
          <code class="filename">httpd.conf</code> directives inside your
          <code class="literal">Location</code> block to tell Apache what to do
          with your new password file.  The
          <code class="literal">AuthType</code> directive specifies the type of
          authentication system to use.  In this case, we want to
          specify the <code class="literal">Basic</code> authentication system.
          <code class="literal">AuthName</code> is an arbitrary name that you
          give for the authentication domain.  Most browsers will
          display this name in the pop-up dialog box when the browser
          is querying the user for his name and password.  Finally,
          use the <code class="literal">AuthUserFile</code> directive to specify
          the location of the password file you created using
          <span class="command"><strong>htpasswd</strong></span>.</p><p>After adding these three directives, your
          <code class="literal">&lt;Location&gt;</code> block should look
          something like this:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn
  AuthType Basic
  AuthName "Subversion repository"
  AuthUserFile /etc/svn-auth-file
&lt;/Location&gt;
</pre><p>This <code class="literal">&lt;Location&gt;</code> block is not
          yet complete, and will not do anything useful.  It's merely
          telling Apache that whenever authorization is required,
          Apache should harvest a username and password from the
          Subversion client.  What's missing here, however, are
          directives that tell Apache <span class="emphasis"><em>which</em></span> sorts
          of client requests require authorization.  Wherever
          authorization is required, Apache will demand
          authentication as well.  The simplest thing to do is protect
          all requests.  Adding <code class="literal">Require valid-user</code>
          tells Apache that all requests require an authenticated
          user:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn
  AuthType Basic
  AuthName "Subversion repository"
  AuthUserFile /etc/svn-auth-file
  Require valid-user
&lt;/Location&gt;
</pre><p>Be sure to read the next section (<a class="xref" href="ch06s04.html#svn.serverconfig.httpd.authz" title="&#25480;&#26435;&#36873;&#39033;">&#8220;&#25480;&#26435;&#36873;&#39033;&#8221;&#19968;&#33410;</a>) for more detail on the
          <code class="literal">Require</code> directive and other ways to set
          authorization policies.</p><p>One word of warning: HTTP Basic Auth passwords pass in
          very nearly plain-text over the network, and thus are
          extremely insecure.  If you're worried about password
          snooping, it may be best to use some sort of SSL encryption,
          so that clients authenticate via <code class="literal">https://</code>
          instead of <code class="literal">http://</code>; at a bare minimum,
          you can configure Apache to use a self-signed server
          certificate.
          <sup>[<a name="d0e10947" href="#ftn.d0e10947" class="footnote">42</a>]</sup>
          Consult Apache's documentation (and OpenSSL documentation)
          about how to do that.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.authn.sslcerts"></a>SSL &#35777;&#20070;&#31649;&#29702;</h4></div></div></div><p>&#21830;&#19994;&#24212;&#29992;&#38656;&#35201;&#36234;&#36807;&#20844;&#21496;&#38450;&#28779;&#22681;&#30340;&#29256;&#26412;&#24211;&#35775;&#38382;&#65292;&#38450;&#28779;&#22681;&#38656;&#35201;&#23567;&#24515;&#30340;&#32771;&#34385;&#38750;&#35748;&#35777;&#29992;&#25143;&#8220;<span class="quote">&#21560;&#21462;</span>&#8221;&#20182;&#20204;&#30340;&#32593;&#32476;&#27969;&#37327;&#30340;&#24773;&#20917;&#65292;SSL&#35753;&#37027;&#31181;&#24418;&#24335;&#30340;&#20851;&#27880;&#26356;&#19981;&#23481;&#26131;&#23548;&#33268;&#25935;&#24863;&#25968;&#25454;&#27844;&#38706;&#12290;</p><p>If a Subversion client is compiled to use OpenSSL, then
          it gains the ability to speak to an Apache server via
          <code class="literal">https://</code> URLs.  The Neon library used by
          the Subversion client is not only able to verify server
          certificates, but can also supply client certificates when
          challenged.  When the client and server have exchanged SSL
          certificates and successfully authenticated one another, all
          further communication is encrypted via a session key.</p><p>&#24590;&#26679;&#20135;&#29983;&#23458;&#25143;&#31471;&#21644;&#26381;&#21153;&#22120;&#31471;&#35777;&#20070;&#20197;&#21450;&#24590;&#26679;&#20351;&#29992;&#23427;&#20204;&#24050;&#32463;&#36229;&#20986;&#20102;&#26412;&#20070;&#30340;&#33539;&#22260;&#65292;&#35768;&#22810;&#20070;&#31821;&#65292;&#21253;&#25324;Apache&#33258;&#24049;&#30340;&#25991;&#26723;&#65292;&#25551;&#36848;&#36825;&#20010;&#20219;&#21153;&#65292;&#29616;&#22312;&#25105;&#20204;<span class="emphasis"><em>&#21487;&#20197;</em></span>&#35206;&#30422;&#30340;&#26159;&#26222;&#36890;&#30340;&#23458;&#25143;&#31471;&#24590;&#26679;&#26469;&#31649;&#29702;&#26381;&#21153;&#22120;&#19982;&#23458;&#25143;&#31471;&#35777;&#20070;&#12290;</p><p>When speaking to Apache via <code class="literal">https://</code>,
          a Subversion client can receive two different types of
          information:</p><div class="itemizedlist"><ul type="disc"><li><p>&#19968;&#20010;&#26381;&#21153;&#22120;&#35777;&#20070;</p></li><li><p>&#19968;&#20010;&#23458;&#25143;&#31471;&#35777;&#20070;&#30340;&#35201;&#27714;</p></li></ul></div><p>&#22914;&#26524;&#23458;&#25143;&#31471;&#25509;&#25910;&#20102;&#19968;&#20010;&#26381;&#21153;&#22120;&#35777;&#20070;&#65292;&#23427;&#38656;&#35201;&#21435;&#39564;&#35777;&#23427;&#26159;&#21487;&#20197;&#30456;&#20449;&#30340;&#65306;&#36825;&#20010;&#26381;&#21153;&#22120;&#26159;&#23427;&#33258;&#31216;&#30340;&#37027;&#19968;&#20010;&#21527;&#65311;OpenSSL&#24211;&#20250;&#21435;&#26816;&#39564;&#26381;&#21153;&#22120;&#35777;&#20070;&#30340;&#31614;&#21517;&#20154;&#25110;&#32773;&#26159;<em class="firstterm">&#26680;&#35777;&#26426;&#26500;</em>&#65288;CA&#65289;&#12290;&#22914;&#26524;OpenSSL&#19981;&#21487;&#20197;&#33258;&#21160;&#20449;&#20219;&#36825;&#20010;CA&#65292;&#25110;&#32773;&#26159;&#19968;&#20123;&#20854;&#20182;&#30340;&#38382;&#39064;&#65288;&#22914;&#35777;&#20070;&#36807;&#26399;&#25110;&#32773;&#26159;&#20027;&#26426;&#21517;&#19981;&#21305;&#37197;&#65289;&#65292;Subversion&#21629;&#20196;&#34892;&#23458;&#25143;&#31471;&#20250;&#35810;&#38382;&#20320;&#26159;&#21542;&#24895;&#24847;&#20173;&#28982;&#20449;&#20219;&#36825;&#20010;&#35777;&#20070;&#65306;</p><pre class="screen">
$ svn list https://host.example.com/repos/project

Error validating server certificate for 'https://host.example.com:443':
 - The certificate is not issued by a trusted authority. Use the
   fingerprint to validate the certificate manually!
Certificate information:
 - Hostname: host.example.com
 - Valid: from Jan 30 19:23:56 2004 GMT until Jan 30 19:23:56 2006 GMT
 - Issuer: CA, example.com, Sometown, California, US
 - Fingerprint: 7d:e1:a9:34:33:39:ba:6a:e9:a5:c4:22:98:7b:76:5c:92:a0:9c:7b

(R)eject, accept (t)emporarily or accept (p)ermanently?
</pre><p>This dialogue should look familiar; it's essentially the
          same question you've probably seen coming from your web
          browser (which is just another HTTP client like Subversion).
          If you choose the (p)ermanent option, the server certificate
          will be cached in your private run-time
          <code class="filename">auth/</code> area in just the same way your
          username and password are cached (see <a class="xref" href="ch03s09.html#svn.serverconfig.netmodel.credcache" title="&#23458;&#25143;&#31471;&#20973;&#35777;&#32531;&#23384;">&#8220;&#23458;&#25143;&#31471;&#20973;&#35777;&#32531;&#23384;&#8221;&#19968;&#33410;</a>).  If cached,
          Subversion will automatically trust this certificate
          in future negotiations.</p><p>Your run-time <code class="filename">servers</code> file also gives
          you the ability to make your Subversion client automatically
          trust specific CAs, either globally or on a per-host basis.
          Simply set the <code class="literal">ssl-authority-files</code>
          variable to a semicolon-separated list of PEM-encoded CA
          certificates:</p><pre class="screen">
[global]
ssl-authority-files = /path/to/CAcert1.pem;/path/to/CAcert2.pem
</pre><p>Many OpenSSL installations also have a pre-defined set
          of &#8220;<span class="quote">default</span>&#8221; CAs that are nearly universally
          trusted.  To make the Subversion client automatically trust
          these standard authorities, set the
          <code class="literal">ssl-trust-default-ca</code> variable to
          <code class="literal">true</code>.</p><p>&#24403;&#19982;Apache&#36890;&#35805;&#26102;&#65292;Subversion&#23458;&#25143;&#31471;&#20063;&#20250;&#25910;&#21040;&#19968;&#20010;&#35777;&#20070;&#30340;&#35201;&#27714;&#65292;Apache&#26159;&#35810;&#38382;&#23458;&#25143;&#31471;&#26469;&#35777;&#26126;&#33258;&#24049;&#30340;&#36523;&#20221;&#65306;&#36825;&#20010;&#23458;&#25143;&#31471;&#26159;&#21542;&#26159;&#20182;&#25152;&#35828;&#30340;&#37027;&#19968;&#20010;&#65311;&#22914;&#26524;&#19968;&#20999;&#27491;&#24120;&#65292;Subversion&#23458;&#25143;&#31471;&#20250;&#21457;&#36865;&#22238;&#19968;&#20010;&#36890;&#36807;Apache&#20449;&#20219;&#30340;CA&#31614;&#21517;&#30340;&#31169;&#26377;&#35777;&#20070;&#65292;&#19968;&#20010;&#23458;&#25143;&#31471;&#35777;&#20070;&#36890;&#24120;&#20250;&#20197;&#21152;&#23494;&#26041;&#24335;&#23384;&#25918;&#22312;&#30913;&#30424;&#65292;&#20351;&#29992;&#26412;&#22320;&#23494;&#30721;&#20445;&#25252;&#65292;&#24403;Subversion&#25910;&#21040;&#36825;&#20010;&#35201;&#27714;&#65292;&#23427;&#20250;&#35810;&#38382;&#20320;&#35777;&#20070;&#30340;&#36335;&#24452;&#21644;&#20445;&#25252;&#29992;&#30340;&#23494;&#30721;&#65306;</p><pre class="screen">
$ svn list https://host.example.com/repos/project

Authentication realm: https://host.example.com:443
Client certificate filename: /path/to/my/cert.p12
Passphrase for '/path/to/my/cert.p12':  ********
&#8230;
</pre><p>&#27880;&#24847;&#36825;&#20010;&#23458;&#25143;&#31471;&#35777;&#20070;&#26159;&#19968;&#20010;&#8220;<span class="quote">p12</span>&#8221;&#25991;&#20214;&#65292;&#20026;&#20102;&#35753;Subversion&#20351;&#29992;&#23458;&#25143;&#31471;&#35777;&#20070;&#65292;&#23427;&#24517;&#39035;&#26159;&#36816;&#36755;&#26631;&#20934;&#30340;PKCS#12&#26684;&#24335;&#65292;&#22823;&#22810;&#25968;&#27983;&#35272;&#22120;&#21487;&#20197;&#23548;&#20837;&#21644;&#23548;&#20986;&#36825;&#31181;&#26684;&#24335;&#30340;&#35777;&#20070;&#65292;&#21478;&#19968;&#20010;&#36873;&#25321;&#26159;&#29992;OpenSSL&#21629;&#20196;&#34892;&#24037;&#20855;&#26469;&#36716;&#21270;&#23384;&#22312;&#30340;&#35777;&#20070;&#20026;PKCS#12&#26684;&#24335;&#12290;</p><p>Again, the runtime <code class="filename">servers</code> file
          allows you to automate this challenge on a per-host basis.
          Either or both pieces of information can be described in
          runtime variables:</p><pre class="screen">
[groups]
examplehost = host.example.com

[examplehost]
ssl-client-cert-file = /path/to/my/cert.p12
ssl-client-cert-password = somepassword
</pre><p>Once you've set the
          <code class="literal">ssl-client-cert-file</code> and
          <code class="literal">ssl-client-cert-password</code> variables, the
          Subversion client can automatically respond to a client
          certificate challenge without prompting you.
          <sup>[<a name="d0e11045" href="#ftn.d0e11045" class="footnote">43</a>]</sup>
        </p></div></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.httpd.authz"></a>&#25480;&#26435;&#36873;&#39033;</h3></div></div></div><p>&#27492;&#21051;&#65292;&#20320;&#24050;&#32463;&#37197;&#32622;&#20102;&#35748;&#35777;&#65292;&#20294;&#26159;&#27809;&#26377;&#37197;&#32622;&#25480;&#26435;&#65292;Apache&#21487;&#20197;&#35201;&#27714;&#29992;&#25143;&#35748;&#35777;&#24182;&#19988;&#30830;&#23450;&#36523;&#20221;&#65292;&#20294;&#26159;&#24182;&#27809;&#26377;&#35828;&#26126;&#36825;&#20010;&#36523;&#20221;&#30340;&#24590;&#26679;&#20801;&#35768;&#21644;&#38480;&#21046;&#65292;&#36825;&#20010;&#37096;&#20998;&#25551;&#36848;&#20102;&#20004;&#31181;&#25511;&#21046;&#35775;&#38382;&#29256;&#26412;&#24211;&#30340;&#31574;&#30053;&#12290;</p><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.authz.blanket"></a>&#25972;&#20307;&#35775;&#38382;&#25511;&#21046;</h4></div></div></div><p>&#26368;&#31616;&#21333;&#30340;&#35775;&#38382;&#25511;&#21046;&#24418;&#24335;&#26159;&#25480;&#26435;&#29305;&#23450;&#29992;&#25143;&#20026;&#21482;&#35835;&#29256;&#26412;&#24211;&#35775;&#38382;&#25110;&#32773;&#26159;&#35835;/&#20889;&#35775;&#38382;&#29256;&#26412;&#24211;&#12290;</p><p>You can restrict access on all repository operations by
          adding the <code class="literal">Require valid-user</code> directive
          to your <code class="literal">&lt;Location&gt;</code> block.  Using
          our previous example, this would mean that only clients that
          claimed to be either <code class="literal">harry</code> or
          <code class="literal">sally</code>, and provided the correct
          password for their respective username, would be allowed to
          do anything with the Subversion repository:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  # how to authenticate a user
  AuthType Basic
  AuthName "Subversion repository"
  AuthUserFile /path/to/users/file

  # only authenticated users may access the repository
  Require valid-user
&lt;/Location&gt;
</pre><p>Sometimes you don't need to run such a tight ship.  For
          example, Subversion's own source code repository at
          <code class="uri">http://svn.collab.net/repos/svn</code> allows anyone
          in the world to perform read-only repository tasks (like
          checking out working copies and browsing the repository with
          a web browser), but restricts all write operations to
          authenticated users.  To do this type of selective
          restriction, you can use the <code class="literal">Limit</code> and
          <code class="literal">LimitExcept</code> configuration directives.
          Like the <code class="literal">Location</code> directive, these blocks
          have starting and ending tags, and you would nest them
          inside your <code class="literal">&lt;Location&gt;</code>
          block.</p><p>The parameters present on the <code class="literal">Limit</code>
          and <code class="literal">LimitExcept</code> directives are HTTP
          request types that are affected by that block.  For example,
          if you wanted to disallow all access to your repository
          except the currently supported read-only operations, you
          would use the <code class="literal">LimitExcept</code> directive,
          passing the <code class="literal">GET</code>,
          <code class="literal">PROPFIND</code>, <code class="literal">OPTIONS</code>, and
          <code class="literal">REPORT</code> request type parameters.  Then the
          previously mentioned <code class="literal">Require valid-user</code>
          directive would be placed inside the
          <code class="literal">&lt;LimitExcept&gt;</code> block instead of just
          inside the <code class="literal">&lt;Location&gt;</code> block.</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  # how to authenticate a user
  AuthType Basic
  AuthName "Subversion repository"
  AuthUserFile /path/to/users/file

  # For any operations other than these, require an authenticated user.
  &lt;LimitExcept GET PROPFIND OPTIONS REPORT&gt;
    Require valid-user
  &lt;/LimitExcept&gt;
&lt;/Location&gt;
</pre><p>These are only a few simple examples.  For more in-depth
          information about Apache access control and the
          <code class="literal">Require</code> directive, take a look at the
          <code class="literal">Security</code> section of the Apache
          documentation's tutorials collection at <code class="uri">http://httpd.apache.org/docs-2.0/misc/tutorials.html</code>.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.authz.perdir"></a>&#27599;&#30446;&#24405;&#35775;&#38382;&#25511;&#21046;</h4></div></div></div><p>It's possible to set up finer-grained permissions using
          a second Apache httpd module,
          <span class="command"><strong>mod_authz_svn</strong></span>.  This module grabs the
          various opaque URLs passing from client to server, asks
          <span class="command"><strong>mod_dav_svn</strong></span> to decode them, and then
          possibly vetoes requests based on access policies defined in
          a configuration file.</p><p>If you've built Subversion from source code,
          <span class="command"><strong>mod_authz_svn</strong></span> is automatically built
          and installed alongside <span class="command"><strong>mod_dav_svn</strong></span>.
          Many binary distributions install it automatically as well.
          To verify that it's installed correctly, make sure it comes
          right after <span class="command"><strong>mod_dav_svn</strong></span>'s
          <code class="literal">LoadModule</code> directive in
          <code class="filename">httpd.conf</code>:</p><pre class="screen">
LoadModule dav_module         modules/mod_dav.so
LoadModule dav_svn_module     modules/mod_dav_svn.so
LoadModule authz_svn_module   modules/mod_authz_svn.so
</pre><p>To activate this module, you need to configure your
          <code class="literal">Location</code> block to use the
          <code class="literal">AuthzSVNAccessFile</code> directive, which
          specifies a file containing the permissions policy for paths
          within your repositories.  (In a moment, we'll discuss the
          format of that file.)</p><p>Apache&#38750;&#24120;&#30340;&#28789;&#27963;&#65292;&#20320;&#21487;&#20197;&#20174;&#19977;&#31181;&#27169;&#24335;&#37324;&#36873;&#25321;&#19968;&#31181;&#26469;&#37197;&#32622;&#20320;&#30340;&#21306;&#22359;&#65292;&#20316;&#20026;&#24320;&#22987;&#65292;&#20320;&#36873;&#25321;&#19968;&#31181;&#22522;&#26412;&#30340;&#37197;&#32622;&#27169;&#24335;&#12290;&#65288;&#19979;&#38754;&#30340;&#20363;&#23376;&#38750;&#24120;&#31616;&#21333;&#65307;&#35265;Apache&#33258;&#24049;&#30340;&#25991;&#26723;&#20013;&#30340;&#35748;&#35777;&#21644;&#25480;&#26435;&#36873;&#39033;&#26469;&#26597;&#30475;&#26356;&#22810;&#30340;&#32454;&#33410;&#12290;&#65289;</p><p>&#26368;&#31616;&#21333;&#30340;&#21306;&#22359;&#26159;&#20801;&#35768;&#20219;&#20309;&#20154;&#21487;&#20197;&#35775;&#38382;&#65292;&#22312;&#36825;&#20010;&#22330;&#26223;&#37324;&#65292;Apache&#20915;&#19981;&#20250;&#21457;&#36865;&#35748;&#35777;&#35831;&#27714;&#65292;&#25152;&#26377;&#30340;&#29992;&#25143;&#20316;&#20026;&#8220;<span class="quote">&#21311;&#21517;</span>&#8221;&#23545;&#24453;&#12290;</p><div class="example"><a name="svn.serverconfig.httpd.authz.perdir.ex-1"></a><p class="title"><b>&#20363;&nbsp;6.1.&nbsp;&#21311;&#21517;&#35775;&#38382;&#30340;&#37197;&#32622;&#23454;&#20363;&#12290;</b></p><div class="example-contents"><pre class="programlisting">
&lt;Location /repos&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  # our access control policy
  AuthzSVNAccessFile /path/to/access/file
&lt;/Location&gt;
          </pre></div></div><br class="example-break"><p>On the opposite end of the paranoia scale, you can
          configure your block to demand authentication from everyone.
          All clients must supply credentials to identify themselves.
          Your block unconditionally requires authentication via the
          <code class="literal">Require valid-user</code> directive, and defines
          a means to authenticate.</p><div class="example"><a name="svn.serverconfig.httpd.authz.perdir.ex-2"></a><p class="title"><b>&#20363;&nbsp;6.2.&nbsp;&#19968;&#20010;&#35748;&#35777;&#35775;&#38382;&#30340;&#37197;&#32622;&#23454;&#20363;&#12290;</b></p><div class="example-contents"><pre class="programlisting">
&lt;Location /repos&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  # our access control policy
  AuthzSVNAccessFile /path/to/access/file

  # only authenticated users may access the repository
  Require valid-user

  # how to authenticate a user
  AuthType Basic
  AuthName "Subversion repository"
  AuthUserFile /path/to/users/file
&lt;/Location&gt;
          </pre></div></div><br class="example-break"><p>A third very popular pattern is to allow a combination
          of authenticated and anonymous access.  For example, many
          administrators want to allow anonymous users to read certain
          repository directories, but want only authenticated users to
          read (or write) more sensitive areas.  In this setup, all
          users start out accessing the repository anonymously.  If
          your access control policy demands a real username at any
          point, Apache will demand authentication from the client.
          To do this, you use both the <code class="literal">Satisfy Any</code>
          and <code class="literal">Require valid-user</code> directives
          together.</p><div class="example"><a name="svn.serverconfig.httpd.authz.perdir.ex-3"></a><p class="title"><b>&#20363;&nbsp;6.3.&nbsp;&#19968;&#20010;&#28151;&#21512;&#35748;&#35777;/&#21311;&#21517;&#35775;&#38382;&#30340;&#37197;&#32622;&#23454;&#20363;&#12290;</b></p><div class="example-contents"><pre class="programlisting">
&lt;Location /repos&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  # our access control policy
  AuthzSVNAccessFile /path/to/access/file

  # try anonymous access first, resort to real
  # authentication if necessary.
  Satisfy Any
  Require valid-user

  # how to authenticate a user
  AuthType Basic
  AuthName "Subversion repository"
  AuthUserFile /path/to/users/file
&lt;/Location&gt;
          </pre></div></div><br class="example-break"><p>Once you've settled on one of these three
          basic <code class="filename">httpd.conf</code> templates, you need to
          create your file containing access rules for particular
          paths within the repository.  This is described in
          <a class="xref" href="ch06s05.html" title="&#22522;&#20110;&#36335;&#24452;&#30340;&#25480;&#26435;">&#8220;&#22522;&#20110;&#36335;&#24452;&#30340;&#25480;&#26435;&#8221;&#19968;&#33410;</a>.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.authz.pathauthzoff"></a>&#31105;&#29992;&#22522;&#20110;&#36335;&#24452;&#30340;&#26816;&#26597;</h4></div></div></div><p>The <span class="command"><strong>mod_dav_svn</strong></span> module goes through a
          lot of work to make sure that data you've marked
          &#8220;<span class="quote">unreadable</span>&#8221; doesn't get accidentally leaked.
          This means that it needs to closely monitor all of the paths
          and file-contents returned by commands like <span class="command"><strong>svn
          checkout</strong></span> or <span class="command"><strong>svn update</strong></span>
          commands.  If these commands encounter a path that isn't
          readable according to some authorization policy, then the
          path is typically omitted altogether.  In the case of
          history or rename tracing&#8212;e.g. running a command like
          <span class="command"><strong>svn cat -r OLD foo.c</strong></span> on a file that was
          renamed long ago&#8212;the rename tracking will simply halt
          if one of the object's former names is determined to be
          read-restricted.</p><p>All of this path-checking can sometimes be quite
          expensive, especially in the case of <span class="command"><strong>svn
          log</strong></span>.  When retrieving a list of revisions, the server
          looks at every changed path in each revision and checks it
          for readability.  If an unreadable path is discovered, then
          it's omitted from the list of the revision's changed paths
          (normally seen with the <code class="option">--verbose</code> option),
          and the whole log message is suppressed.  Needless to say,
          this can be time-consuming on revisions that affect a large
          number of files.  This is the cost of security: even if you
          haven't configured a module like
          <span class="command"><strong>mod_authz_svn</strong></span> at all, the
          <span class="command"><strong>mod_dav_svn</strong></span> module is still asking Apache
          <span class="command"><strong>httpd</strong></span> to run authorization checks on
          every path.  The <span class="command"><strong>mod_dav_svn</strong></span> module has
          no idea what authorization modules have been installed, so
          all it can do is ask Apache to invoke whatever might be
          present.</p><p>On the other hand, there's also an escape-hatch of
          sorts, one which allows you to trade security features for
          speed.  If you're not enforcing any sort of per-directory
          authorization (i.e. not using
          <span class="command"><strong>mod_authz_svn</strong></span> or similar module), then
          you can disable all of this path-checking.  In your
          <code class="filename">httpd.conf</code> file, use the
          <code class="literal">SVNPathAuthz</code> directive:</p><div class="example"><a name="svn.serverconfig.httpd.authz.pathauthzoff.ex-1"></a><p class="title"><b>&#20363;&nbsp;6.4.&nbsp;&#31105;&#29992;&#25152;&#26377;&#30340;&#36335;&#24452;&#26816;&#26597;</b></p><div class="example-contents"><pre class="programlisting">
&lt;Location /repos&gt;
  DAV svn
  SVNParentPath /usr/local/svn

  SVNPathAuthz off
&lt;/Location&gt;
          </pre></div></div><br class="example-break"><p>The <code class="literal">SVNPathAuthz</code> directive is &#8220;<span class="quote">on</span>&#8221; by
          default.  When set &#8220;<span class="quote">off</span>&#8221;, all path-based
          authorization checking is disabled;
          <span class="command"><strong>mod_dav_svn</strong></span> stops invoking authorization
          checks on every path it discovers.</p></div></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.httpd.extra"></a>&#39069;&#22806;&#30340;&#31958;&#26524;</h3></div></div></div><p>&#25105;&#20204;&#24050;&#32463;&#35206;&#30422;&#20102;&#20851;&#20110;&#35748;&#35777;&#21644;&#25480;&#26435;&#30340;Apache&#21644;mod_dav_svn&#30340;&#22823;&#22810;&#25968;&#36873;&#39033;&#65292;&#20294;&#26159;Apache&#36824;&#25552;&#20379;&#20102;&#35768;&#22810;&#24456;&#22909;&#30340;&#29305;&#24615;&#12290;</p><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.extra.browsing"></a>&#29256;&#26412;&#24211;&#27983;&#35272;</h4></div></div></div><p>One of the most useful benefits of an Apache/WebDAV
          configuration for your Subversion repository is that the
          youngest revisions of your versioned files and directories
          are immediately available for viewing via a regular web
          browser.  Since Subversion uses URLs to identify versioned
          resources, those URLs used for HTTP-based repository access
          can be typed directly into a Web browser.  Your browser will
          issue an HTTP <code class="literal">GET</code> request for that URL, and
          based on whether that URL represents a versioned directory
          or file, mod_dav_svn will respond with a directory listing
          or with file contents.</p><p>&#22240;&#20026;URL&#19981;&#33021;&#30830;&#23450;&#20320;&#25152;&#24076;&#26395;&#30475;&#21040;&#30340;&#36164;&#28304;&#30340;&#29256;&#26412;&#65292;mod_dav_svn&#20250;&#19968;&#30452;&#36820;&#22238;&#26368;&#26032;&#30340;&#29256;&#26412;&#65292;&#36825;&#26679;&#20250;&#26377;&#19968;&#20123;&#32654;&#22937;&#30340;&#21103;&#20316;&#29992;&#65292;&#20320;&#21487;&#20197;&#30452;&#25509;&#25226;Subversion&#30340;URL&#20256;&#36882;&#32473;&#25991;&#26723;&#20316;&#20026;&#24341;&#29992;&#65292;&#36825;&#20123;URL&#20250;&#19968;&#30452;&#25351;&#21521;&#25991;&#26723;&#26368;&#26032;&#30340;&#26448;&#26009;&#65292;&#24403;&#28982;&#65292;&#20320;&#20063;&#21487;&#20197;&#22312;&#21035;&#30340;&#32593;&#31449;&#20316;&#20026;&#36229;&#38142;&#20351;&#29992;&#36825;&#20123;URL&#12290;</p><div class="sidebar"><p class="title"><b>&#25105;&#21487;&#20197;&#30475;&#21040;&#32769;&#30340;&#20462;&#35746;&#29256;&#26412;&#21527;&#65311;</b></p><p>With an ordinary web browser?  In one word: nope.  At
            least, not with <span class="command"><strong>mod_dav_svn</strong></span> as your
            only tool.</p><p>&#20320;&#30340;Web&#27983;&#35272;&#22120;&#21482;&#20250;&#35828;&#26222;&#36890;&#30340;HTTP&#65292;&#20063;&#23601;&#26159;&#35828;&#23427;&#21482;&#20250;GET&#20844;&#20849;&#30340;URL&#65292;&#36825;&#20010;URL&#20195;&#34920;&#20102;&#26368;&#26032;&#29256;&#26412;&#30340;&#25991;&#20214;&#21644;&#30446;&#24405;&#65292;&#26681;&#25454;WebDAV/DeltaV&#35268;&#33539;&#65292;&#27599;&#31181;&#26381;&#21153;&#22120;&#23450;&#20041;&#20102;&#19968;&#31181;&#31169;&#26377;&#30340;URL&#35821;&#27861;&#26469;&#20195;&#34920;&#32769;&#30340;&#36164;&#28304;&#30340;&#29256;&#26412;&#65292;&#36825;&#20010;&#35821;&#27861;&#23545;&#23458;&#25143;&#31471;&#26159;&#19981;&#36879;&#26126;&#30340;&#65292;&#20026;&#20102;&#24471;&#21040;&#32769;&#30340;&#29256;&#26412;&#65292;&#19968;&#20010;&#23458;&#25143;&#31471;&#24517;&#39035;&#36890;&#36807;&#19968;&#31181;&#35268;&#33539;&#36807;&#31243;&#26469;&#8220;<span class="quote">&#21457;&#29616;</span>&#8221;&#27491;&#30830;&#30340;URL&#65307;&#36825;&#20010;&#36807;&#31243;&#21253;&#25324;&#25191;&#34892;&#19968;&#31995;&#21015;WebDAV PROPFIND&#35831;&#27714;&#21644;&#29702;&#35299;DeltaV&#27010;&#24565;&#65292;&#36825;&#20123;&#20107;&#24773;&#19968;&#33324;&#26159;&#20320;&#30340;web&#27983;&#35272;&#22120;&#20570;&#19981;&#20102;&#30340;&#12290;</p><p>So to answer the question, one obvious way to see
            older revisions of files and directories is by passing the
            <code class="option">--revision (-r)</code> argument to
            the <span class="command"><strong>svn list</strong></span> and <span class="command"><strong>svn
            cat</strong></span> commands.  To browse old revisions with your
            web browser, however, you can use third-party software.  A
            good example of this is ViewVC
            (<code class="uri">http://viewvc.tigris.org/</code>).  ViewVC was
            originally written to display CVS repositories through the
            web,
            <sup>[<a name="d0e11349" href="#ftn.d0e11349" class="footnote">44</a>]</sup>
            and the latest releases are able to understand Subversion
            repositories as well.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h5 class="title"><a name="svn.serverconfig.httpd.extra.browsing.mimetype"></a>&#27491;&#30830;&#30340;&#25991;&#20214;&#31867;&#22411;</h5></div></div></div><p>When browsing a Subversion repository, the web browser
            gets a clue about how to render a file's contents by
            looking at the <code class="literal">Content-Type:</code> header
            returned in Apache's response to the
            HTTP <code class="literal">GET</code> request.  The value of this
            header is some sort of MIME type.  By default, Apache will
            tell the web browsers that all repository files are of
            the &#8220;<span class="quote">default</span>&#8221; MIME type,
            typically <code class="literal">text/plain</code>.  This can be
            frustrating, however, if a user wishes repository files to
            render as something more meaningful&#8212;for example,
            it might be nice to have a <code class="filename">foo.html</code> file
            in the repository actually render as HTML when
            browsing.</p><p>To make this happen, you only need to make sure that
            your files have the
            proper <code class="literal">svn:mime-type</code> set.  This is
            discussed in more detail in
            <a class="xref" href="ch03s03.html#svn.advanced.props.special.mime-type" title="&#25991;&#20214;&#20869;&#23481;&#31867;&#22411;">&#8220;&#25991;&#20214;&#20869;&#23481;&#31867;&#22411;&#8221;&#19968;&#33410;</a>,
            and you can even configure your client to automatically
            attach proper <code class="literal">svn:mime-type</code> properties
            to files entering the repository for the first time;  see
            <a class="xref" href="ch03s02.html#svn.advanced.props.auto" title="&#33258;&#21160;&#35774;&#32622;&#23646;&#24615;">&#8220;&#33258;&#21160;&#35774;&#32622;&#23646;&#24615;&#8221;&#19968;&#33410;</a>.</p><p>So in our example, if one were to set
          the <code class="literal">svn:mime-type</code> property
          to <code class="literal">text/html</code> on
          file <code class="filename">foo.html</code>, then Apache would
          properly tell your web browser to render the file as
          HTML.  One could also attach
          proper <code class="literal">image/*</code> mime-type properties to
          images, and by doing this, ultimately get an entire web
          site to be viewable directly from a repository!  There's
          generally no problem with doing this, as long as the
          website doesn't contain any dynamically-generated
          content.</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h5 class="title"><a name="svn.serverconfig.httpd.extra.browsing.xslt"></a>&#23450;&#21046;&#22806;&#35266;</h5></div></div></div><p>You generally will get more use out of URLs to
            versioned files&#8212;after all, that's where the
            interesting content tends to lie.  But you might have
            occasion to browse a Subversion directory listing, where
            you'll quickly note that the generated HTML used to
            display that listing is very basic, and certainly not
            intended to be aesthetically pleasing (or even
            interesting).  To enable customization of these directory
            displays, Subversion provides an XML index feature.  A
            single <code class="literal">SVNIndexXSLT</code> directive in your
            repository's <code class="literal">Location</code> block of
            <code class="filename">httpd.conf</code> will instruct mod_dav_svn
            to generate XML output when displaying a directory
            listing, and to reference the XSLT stylesheet of your
            choice:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn
  SVNIndexXSLT "/svnindex.xsl"
  &#8230;
&lt;/Location&gt;
</pre><p>Using the <code class="literal">SVNIndexXSLT</code> directive and
           a creative XSLT stylesheet, you can make your directory
           listings match the color schemes and imagery used in other
           parts of your website.  Or, if you'd prefer, you can use
           the sample stylesheets provided in the Subversion source
           distribution's <code class="filename">tools/xslt/</code> directory.
           Keep in mind that the path provided to the
           <code class="literal">SVNIndexXSLT</code> directory is actually a URL
           path&#8212;browsers need to be able to read your
           stylesheets in order to make use of them!</p></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h5 class="title"><a name="svn.serverconfig.httpd.extra.browsing.reposlisting"></a>&#29256;&#26412;&#24211;&#21015;&#34920;</h5></div></div></div><p>If you're serving a collection of repositories from a
            single URL via the <code class="literal">SVNParentPath</code>
            directive, then it's also possible to have Apache display
            all available repositories to a web browser.  Just
            activate the <code class="literal">SVNListParentPath</code>
            directive:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  SVNParentPath /usr/local/svn
  SVNListParentPath on
  &#8230;
&lt;/Location&gt;
</pre><p>If a user now points her web browser to the
          URL <code class="literal">http://host.example.com/svn/</code>, she'll
          see list of all Subversion repositories sitting
          in <code class="filename">/usr/local/svn</code>.  Obviously, this can
          be a security problem, so this feature is turned off by
          default.</p></div></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.extra.logging"></a>Apache &#26085;&#24535;</h4></div></div></div><p>Because Apache is an HTTP server at heart, it contains
          fantastically flexible logging features.  It's beyond the
          scope of this book to discuss all ways logging can be
          configured, but we should point out that even the most
          generic <code class="filename">httpd.conf</code> file will cause
          Apache to produce two logs:
          <code class="filename">error_log</code>
          and <code class="filename">access_log</code>.  These logs may appear
          in different places, but are typically created in the
          logging area of your Apache installation.  (On Unix, they
          often live
          in <code class="filename">/usr/local/apache2/logs/</code>.)</p><p>The <code class="filename">error_log</code> describes any internal
          errors that Apache runs into as it works.
          The <code class="filename">access_log</code> file records every
          incoming HTTP request received by Apache.  This makes it
          easy to see, for example, which IP addresses Subversion
          clients are coming from, how often particular clients use
          the server, which users are authenticating properly, and
          which requests succeed or fail.</p><p>Unfortunately, because HTTP is a stateless protocol,
          even the simplest Subversion client operation generates
          multiple network requests.  It's very difficult to look at
          the <code class="filename">access_log</code> and deduce what the
          client was doing&#8212;most operations look like a series
          of cryptic <code class="literal">PROPPATCH</code>, <code class="literal">GET</code>,
          <code class="literal">PUT</code>, and <code class="literal">REPORT</code>
          requests.  To make things worse, many client operations send
          nearly-identical series of requests, so it's even harder to
          tell them apart.</p><p><code class="literal">mod_dav_svn</code>, however, can come to
          your aid.  By activating an &#8220;<span class="quote">operational
          logging</span>&#8221; feature, you can
          ask <code class="literal">mod_dav_svn</code> to create a separate log
          file describing what sort of high-level operations your
          clients are performing.</p><p>To do this, you need to make use of
          Apache's <code class="literal">CustomLog</code> directive (which is
          explained in more detail in Apache's own documentation).
          Be sure to invoke this
          directive <span class="emphasis"><em>outside</em></span> of your
          Subversion <code class="literal">Location</code> block:</p><pre class="screen">
&lt;Location /svn&gt;
  DAV svn
  &#8230;
&lt;/Location&gt;

CustomLog logs/svn_logfile "%t %u %{SVN-ACTION}e" env=SVN-ACTION
</pre><p>In this example, we're asking Apache to create a special
          logfile <code class="filename">svn_logfile</code> in the standard
          Apache <code class="filename">logs</code> directory.
          The <code class="literal">%t</code> and <code class="literal">%u</code>
          variables are replaced by the time and username of the
          request, respectively.  The really important part are the
          two instances of <code class="literal">SVN-ACTION</code>.
          When Apache sees that variable, it substitutes the value of
          the <code class="literal">SVN-ACTION</code> environment variable,
          which is automatically set by <code class="literal">mod_dav_svn</code>
          whenever it detects a high-level client action.</p><p>So instead of having to interpret a
          traditional <code class="filename">access_log</code> like
          this:</p><pre class="screen">
[26/Jan/2007:22:25:29 -0600] "PROPFIND /svn/calc/!svn/vcc/default HTTP/1.1" 207 398
[26/Jan/2007:22:25:29 -0600] "PROPFIND /svn/calc/!svn/bln/59 HTTP/1.1" 207 449
[26/Jan/2007:22:25:29 -0600] "PROPFIND /svn/calc HTTP/1.1" 207 647
[26/Jan/2007:22:25:29 -0600] "REPORT /svn/calc/!svn/vcc/default HTTP/1.1" 200 607
[26/Jan/2007:22:25:31 -0600] "OPTIONS /svn/calc HTTP/1.1" 200 188
[26/Jan/2007:22:25:31 -0600] "MKACTIVITY /svn/calc/!svn/act/e6035ef7-5df0-4ac0-b811-4be7c823f998 HTTP/1.1" 201 227
&#8230;
</pre><p>&#8230; you can instead peruse a much more
          intelligible <code class="filename">svn_logfile</code> like this:</p><pre class="screen">
[26/Jan/2007:22:24:20 -0600] - list-dir '/'
[26/Jan/2007:22:24:27 -0600] - update '/'
[26/Jan/2007:22:25:29 -0600] - remote-status '/'
[26/Jan/2007:22:25:31 -0600] sally commit r60
</pre></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.httpd.extra.other"></a>&#20854;&#23427;&#29305;&#24615;</h4></div></div></div><p>Several of the features already provided by Apache in
          its role as a robust Web server can be leveraged for
          increased functionality or security in Subversion as well.
          Subversion communicates with Apache using Neon, which is a
          generic HTTP/WebDAV library with support for such mechanisms
          as SSL (the Secure Socket Layer, discussed earlier).  If
          your Subversion client is built to support SSL, then it can
          access your Apache server
          using <code class="literal">https://</code>.</p><p>&#21516;&#26679;&#26377;&#29992;&#30340;&#26159;Apache&#21644;Subversion&#20851;&#31995;&#30340;&#19968;&#20123;&#29305;&#24615;&#65292;&#20687;&#21487;&#20197;&#25351;&#23450;&#33258;&#23450;&#20041;&#30340;&#31471;&#21475;&#65288;&#32780;&#19981;&#26159;&#32570;&#30465;&#30340;HTTP&#30340;80&#65289;&#25110;&#32773;&#26159;&#19968;&#20010;Subversion&#21487;&#20197;&#34987;&#35775;&#38382;&#30340;&#34394;&#25311;&#20027;&#26426;&#21517;&#65292;&#25110;&#32773;&#26159;&#36890;&#36807;HTTP&#20195;&#29702;&#26381;&#21153;&#22120;&#35775;&#38382;&#30340;&#33021;&#21147;&#65292;&#36825;&#20123;&#29305;&#24615;&#37117;&#26159;Neon&#25152;&#25903;&#25345;&#30340;&#65292;&#25152;&#20197;Subversion&#36731;&#26131;&#24471;&#21040;&#36825;&#20123;&#25903;&#25345;&#12290;</p><p>Finally, because <span class="command"><strong>mod_dav_svn</strong></span> is
          speaking a subset of the WebDAV/DeltaV protocol, it's
          possible to access the repository via third-party DAV
          clients.  Most modern operating systems (Win32, OS X, and
          Linux) have the built-in ability to mount a DAV server as a
          standard network share.  This is a complicated topic; for
          details, read <a class="xref" href="apc.html" title="&#38468;&#24405;&nbsp;C.&nbsp;WebDAV &#21644;&#33258;&#21160;&#29256;&#26412;">&#38468;&#24405;&nbsp;C, <i>WebDAV &#21644;&#33258;&#21160;&#29256;&#26412;</i></a>.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e10605" href="#d0e10605" class="para">41</a>] </sup>&#20182;&#20204;&#35752;&#21388;&#36825;&#26679;&#20570;&#12290;</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e10947" href="#d0e10947" class="para">42</a>] </sup>While self-signed server certificates are still
              vulnerable to a &#8220;<span class="quote">man in the middle</span>&#8221; attack,
              such an attack is much more difficult for a casual
              observer to pull off, compared to sniffing unprotected
              passwords.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e11045" href="#d0e11045" class="para">43</a>] </sup>More security-conscious folk might not want to store
              the client certificate password in the runtime
              <code class="filename">servers</code> file.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e11349" href="#d0e11349" class="para">44</a>] </sup>&#20043;&#21069;&#21483;&#20570;&#8220;<span class="quote">ViewCVS</span>&#8221;&#12290;</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06s03.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch06.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch06s05.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">svnserve&#65292;&#19968;&#20010;&#23450;&#21046;&#30340;&#26381;&#21153;&#22120;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#22522;&#20110;&#36335;&#24452;&#30340;&#25480;&#26435;</td></tr></table></div></body></html>