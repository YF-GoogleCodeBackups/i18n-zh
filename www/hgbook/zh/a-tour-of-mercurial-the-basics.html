<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>第 1 章 Mercurial 教程: 基础知识</title>
<link rel="stylesheet" href="hgbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.74.3">
<link rel="home" href="index.html" title="Mercurial 权威指南">
<link rel="up" href="index.html" title="Mercurial 权威指南">
<link rel="prev" href="preface.html" title="序言">
<link rel="next" href="a-tour-of-mercurial-merging-work.html" title="第 2 章 Mercurial 教程: 合并工作">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">第 1 章 Mercurial 教程: 基础知识</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="preface.html">上一页</a> </td>
<th width="60%" align="center"> </th>
<td width="20%" align="right"> <a accesskey="n" href="a-tour-of-mercurial-merging-work.html">下一页</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" lang="zh">
<div class="titlepage"><div><div><h2 class="title">
<a name="chap:tour-basic"></a>第 1 章 Mercurial 教程: 基础知识</h2></div></div></div>
<div class="toc">
<p><b>目录</b></p>
<dl>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#sec:tour:install">1.1. 安装 Mercurial</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id506931">1.1.1. Linux</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507019">1.1.2. Solaris</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507039">1.1.3. Mac OS X</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507078">1.1.4. Windows</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id507110">1.2. 开始</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507150">1.2.1. 内置帮助</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id507225">1.3. 使用版本库</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507251">1.3.1. 创建版本库的工作副本</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507354">1.3.2. 什么是版本库?</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id507446">1.4. 回溯历史</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507635">1.4.1. 修改集，版本，与其它用户交互</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507747">1.4.2. 察看指定版本</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id507887">1.4.3. 更详细的信息</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id507992">1.5. 命令选项</a></span></dt>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id508120">1.6. 创建和复审修改</a></span></dt>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id508379">1.7. 在新修改集中记录修改</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id508426">1.7.1. 配置用户名称</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id508672">1.7.2. 写提交日志</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id508748">1.7.3. 写好提交日志</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id508803">1.7.4. 终止提交</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id508844">1.7.5. 欣赏我们的成果</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="a-tour-of-mercurial-the-basics.html#id508902">1.8. 共享修改</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#sec:tour:pull">1.8.1. 从其它版本库取得修改</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id509144">1.8.2. 更新工作目录</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id509422">1.8.3. 发布修改到其它版本库</a></span></dt>
<dt><span class="sect2"><a href="a-tour-of-mercurial-the-basics.html#id509600">1.8.4. 通过网络共享修改</a></span></dt>
</dl></dd>
</dl>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="sec:tour:install"></a>1.1. 安装 Mercurial</h2></div></div></div>
<p><a name="x_1"></a>对于每种流行的操作系统，都有已经构建的二进制软件包。这让在你的计算机上开始使用 Mercurial 变得很容易。</p>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id506931"></a>1.1.1. Linux</h3></div></div></div>
<p><a name="x_2"></a>由于每种 Linux 发行版都有自己的包管理工具，开发策略和进度，从而很难给出安装 Mercurial 二进制包的全面说明。你安装的 Mercurial
版本，在很大程度上依赖于你所使用的发行版的 Mercurial 维护者的活跃程度。</p>
<p><a name="x_3"></a>为了让事情简单，我会致力于说明在最流行的 Linux 发行版中，从命令行安装 Mercurial
的方法。这些发行版都提供了图形界面的包管理器，让你通过点击鼠标安装 Mercurial；寻找的包名称是
<code class="literal">mercurial</code>。</p>
<div class="itemizedlist"><ul type="disc">
<li>
<p><a name="x_4"></a>Debian:</p>
<pre class="programlisting">apt-get install mercurial</pre>
</li>
<li>
<p><a name="x_5"></a>Fedora Core:</p>
<pre class="programlisting">yum install mercurial</pre>
</li>
<li>
<p><a name="x_6"></a>Gentoo:</p>
<pre class="programlisting">emerge mercurial</pre>
</li>
<li>
<p><a name="x_7"></a>OpenSUSE:</p>
<pre class="programlisting">yum install mercurial</pre>
</li>
<li>
<p><a name="x_8"></a>Ubuntu: Ubuntu 的 Mercurial 包基于 Debian。安装时，使用如下命令：</p>
<pre class="programlisting">apt-get install mercurial</pre>
</li>
</ul></div>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507019"></a>1.1.2. Solaris</h3></div></div></div>
<p><a name="x_9"></a>位于 <a class="ulink" href="http://www.sunfreeware.com" target="_top">http://www.sunfreeware.com</a> 的
SunFreeWare 是很好的二进制安装源，它包含 Intel 和 Sparc 架构的 32 位和 64 位包，包含 Mercurial 的当前版本。</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507039"></a>1.1.3. Mac OS X</h3></div></div></div>
<p><a name="x_a"></a>Lee Cantey publishes an installer of Mercurial for Mac OS X at <a class="ulink" href="http://mercurial.berkwood.com" target="_top">http://mercurial.berkwood.com</a>.
This package works on both Intel- and Power-based Macs. Before you can use
it, you must install a compatible version of Universal MacPython
[<span class="citation">web:macpython</span>]. This is easy to do; simply follow the
instructions on Lee's site.</p>
<p><a name="x_b"></a>It's also possible to install Mercurial using Fink or MacPorts, two popular
free package managers for Mac OS X.  If you have Fink, use <span class="command"><strong>sudo
apt-get install mercurial-py25</strong></span>.  If MacPorts, <span class="command"><strong>sudo port
install mercurial</strong></span>.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507078"></a>1.1.4. Windows</h3></div></div></div>
<p><a name="x_c"></a>Lee Cantey publishes an installer of Mercurial for Windows at <a class="ulink" href="http://mercurial.berkwood.com" target="_top">http://mercurial.berkwood.com</a>.
This package has no external dependencies; it “<span class="quote">just works</span>”.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="figs/note.png"></td>
<th align="left">注意</th>
</tr>
<tr><td align="left" valign="top"><p><a name="x_d"></a>  The Windows version of Mercurial does not automatically convert line endings
between Windows and Unix styles.  If you want to share work with Unix users,
you must do a little additional configuration work. XXX Flesh this out.</p></td></tr>
</table></div>
</div>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id507110"></a>1.2. 开始</h2></div></div></div>
<p><a name="x_e"></a>To begin, we'll use the <span class="command"><strong>hg version</strong></span> command
to find out whether Mercurial is actually installed properly.  The actual
version information that it prints isn't so important; it's whether it
prints anything at all that we care about.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg version</code></strong>
Mercurial Distributed SCM (version 1.2)

Copyright (C) 2005-2008 Matt Mackall &lt;mpm@selenic.com&gt; and others
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</pre>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507150"></a>1.2.1. 内置帮助</h3></div></div></div>
<p><a name="x_f"></a>Mercurial provides a built-in help system.  This is invaluable for those
times when you find yourself stuck trying to remember how to run a command.
If you are completely stuck, simply run <span class="command"><strong>hg
help</strong></span>; it will print a brief list of commands, along with a
description of what each does.  If you ask for help on a specific command
(as below), it prints more detailed information.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg help init</code></strong>
hg init [-e CMD] [--remotecmd CMD] [DEST]

create a new repository in the given directory

    Initialize a new repository in the given directory. If the given
    directory does not exist, it is created.

    If no directory is given, the current directory is used.

    It is possible to specify an ssh:// URL as the destination.
    See 'hg help urls' for more information.

options:

 -e --ssh        specify ssh command to use
    --remotecmd  specify hg command to run on the remote side

use "hg -v help init" to show global options
</pre>
<p><a name="x_10"></a>For a more impressive level of detail (which you won't usually need) run
<span class="command"><strong>hg help <code class="option">-v</code></strong></span>.  The <code class="option">-v</code> option is short for <code class="option">--verbose</code>, and tells Mercurial to print more
information than it usually would.</p>
</div>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id507225"></a>1.3. 使用版本库</h2></div></div></div>
<p><a name="x_11"></a>In Mercurial, everything happens inside a <span class="emphasis"><em>repository</em></span>.
The repository for a project contains all of the files that “<span class="quote">belong
to</span>” that project, along with a historical record of the project's
files.</p>
<p><a name="x_12"></a>There's nothing particularly magical about a repository; it is simply a
directory tree in your filesystem that Mercurial treats as special. You can
rename or delete a repository any time you like, using either the command
line or your file browser.</p>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507251"></a>1.3.1. 创建版本库的工作副本</h3></div></div></div>
<p><a name="x_13"></a><span class="emphasis"><em>Copying</em></span> a repository is just a little bit special.
While you could use a normal file copying command to make a copy of a
repository, it's best to use a built-in command that Mercurial provides.
This command is called <span class="command"><strong>hg clone</strong></span>, because it
creates an identical copy of an existing repository.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg clone http://hg.serpentine.com/tutorial/hello</code></strong>
destination directory: hello
requesting all changes
adding changesets
adding manifests
adding file changes
added 5 changesets with 5 changes to 2 files
updating working directory
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
</pre>
<p><a name="x_14"></a>If our clone succeeded, we should now have a local directory called
<code class="filename">hello</code>.  This directory will contain
some files.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>ls -l</code></strong>
total 0
drwxr-xr-x 3 dongsheng g11n 120 Mar 31 06:55 hello
<code class="prompt">$</code> <strong class="userinput"><code>ls hello</code></strong>
Makefile  hello.c
</pre>
<p><a name="x_15"></a>These files have the same contents and history in our repository as they do
in the repository we cloned.</p>
<p><a name="x_16"></a>Every Mercurial repository is complete, self-contained, and independent.  It
contains its own private copy of a project's files and history.  A cloned
repository remembers the location of the repository it was cloned from, but
it does not communicate with that repository, or any other, unless you tell
it to.</p>
<p><a name="x_17"></a>What this means for now is that we're free to experiment with our
repository, safe in the knowledge that it's a private “<span class="quote">sandbox</span>”
that won't affect anyone else.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507354"></a>1.3.2. 什么是版本库?</h3></div></div></div>
<p><a name="x_18"></a>When we take a more detailed look inside a repository, we can see that it
contains a directory named <code class="filename">.hg</code>.  This
is where Mercurial keeps all of its metadata for the repository.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd hello</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>ls -a</code></strong>
.  ..  .hg  Makefile  hello.c
</pre>
<p><a name="x_19"></a>The contents of the <code class="filename">.hg</code> directory and
its subdirectories are private to Mercurial.  Every other file and directory
in the repository is yours to do with as you please.</p>
<p><a name="x_1a"></a>To introduce a little terminology, the <code class="filename">.hg</code> directory is the “<span class="quote">real</span>”
repository, and all of the files and directories that coexist with it are
said to live in the <span class="emphasis"><em>working directory</em></span>.  An easy way to
remember the distinction is that the <span class="emphasis"><em>repository</em></span>
contains the <span class="emphasis"><em>history</em></span> of your project, while the
<span class="emphasis"><em>working directory</em></span> contains a
<span class="emphasis"><em>snapshot</em></span> of your project at a particular point in
history.</p>
</div>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id507446"></a>1.4. 回溯历史</h2></div></div></div>
<p><a name="x_1b"></a>One of the first things we might want to do with a new, unfamiliar
repository is understand its history.  The <span class="command"><strong>hg
log</strong></span> command gives us a view of history.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg log</code></strong>
changeset:   4:2278160e78d4
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:16:53 2008 +0200
summary:     Trim comments.

changeset:   3:0272e0d5a517
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:08:02 2008 +0200
summary:     Get make to generate the final binary from a .o file.

changeset:   2:fef857204a0c
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:05:04 2008 +0200
summary:     Introduce a typo into hello.c.

changeset:   1:82e55d328c8c
user:        mpm@selenic.com
date:        Fri Aug 26 01:21:28 2005 -0700
summary:     Create a makefile

changeset:   0:0a04b987be5a
user:        mpm@selenic.com
date:        Fri Aug 26 01:20:50 2005 -0700
summary:     Create a standard "hello, world" program

</pre>
<p><a name="x_1c"></a>By default, this command prints a brief paragraph of output for each change
to the project that was recorded.  In Mercurial terminology, we call each of
these recorded events a <span class="emphasis"><em>changeset</em></span>, because it can
contain a record of changes to several files.</p>
<p><a name="x_1d"></a>The fields in a record of output from <span class="command"><strong>hg
log</strong></span> are as follows.</p>
<div class="itemizedlist"><ul type="disc">
<li><p><a name="x_1e"></a><code class="literal">changeset</code>: This field has the format of a number,
followed by a colon, followed by a hexadecimal string.  These are
<span class="emphasis"><em>identifiers</em></span> for the changeset.  There are two
identifiers because the number is shorter and easier to type than the hex
string.</p></li>
<li><p><a name="x_1f"></a><code class="literal">user</code>: The identity of the person who created the
changeset.  This is a free-form field, but it most often contains a person's
name and email address.</p></li>
<li><p><a name="x_20"></a><code class="literal">date</code>: The date and time on which the changeset was
created, and the timezone in which it was created.  (The date and time are
local to that timezone; they display what time and date it was for the
person who created the changeset.)</p></li>
<li><p><a name="x_21"></a><code class="literal">summary</code>: The first line of the text message that the
creator of the changeset entered to describe the changeset.</p></li>
</ul></div>
<p><a name="x_22"></a>The default output printed by <span class="command"><strong>hg log</strong></span> is
purely a summary; it is missing a lot of detail.</p>
<p><a name="x_23"></a><a class="xref" href="a-tour-of-mercurial-the-basics.html#fig:tour-basic:history" title="图 1.1. 版本库 hello 的历史图">图 1.1 “版本库 hello 的历史图”</a> provides a graphical representation
of the history of the <code class="filename">hello</code>
repository, to make it a little easier to see which direction history is
“<span class="quote">flowing</span>” in.  We'll be returning to this figure several times
in this chapter and the chapter that follows.</p>
<div class="figure">
<a name="fig:tour-basic:history"></a><p class="title"><b>图 1.1. 版本库 <code class="filename">hello</code> 的历史图</b></p>
<div class="figure-contents"><div class="mediaobject"><img src="figs/tour-history.png" alt="XXX add text"></div></div>
</div>
<br class="figure-break"><div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507635"></a>1.4.1. 修改集，版本，与其它用户交互</h3></div></div></div>
<p><a name="x_25"></a>As English is a notoriously sloppy language, and computer science has a
hallowed history of terminological confusion (why use one term when four
will do?), revision control has a variety of words and phrases that mean the
same thing.  If you are talking about Mercurial history with other people,
you will find that the word “<span class="quote">changeset</span>” is often compressed to
“<span class="quote">change</span>” or (when written)  “<span class="quote">cset</span>”, and sometimes
a changeset is referred to as a “<span class="quote">revision</span>” or a
“<span class="quote">rev</span>”.</p>
<p><a name="x_26"></a>While it doesn't matter what <span class="emphasis"><em>word</em></span> you use to refer to
the concept of “<span class="quote">a changeset</span>”, the
<span class="emphasis"><em>identifier</em></span> that you use to refer to “<span class="quote">a
<span class="emphasis"><em>specific</em></span> changeset</span>” is of great
importance. Recall that the <code class="literal">changeset</code> field in the output
from <span class="command"><strong>hg log</strong></span> identifies a changeset using
both a number and a hexadecimal string.</p>
<div class="itemizedlist"><ul type="disc">
<li><p><a name="x_27"></a>The revision number is <span class="emphasis"><em>only valid in that repository</em></span>,</p></li>
<li><p><a name="x_28"></a>while the hex string is the <span class="emphasis"><em>permanent, unchanging
identifier</em></span> that will always identify that exact changeset in
<span class="emphasis"><em>every</em></span> copy of the repository.</p></li>
</ul></div>
<p><a name="x_29"></a>This distinction is important.  If you send someone an email talking about
“<span class="quote">revision 33</span>”, there's a high likelihood that their revision 33
will <span class="emphasis"><em>not be the same</em></span> as yours.  The reason for this is
that a revision number depends on the order in which changes arrived in a
repository, and there is no guarantee that the same changes will happen in
the same order in different repositories. Three changes $a,b,c$ can easily
appear in one repository as $0,1,2$, while in another as $1,0,2$.</p>
<p><a name="x_2a"></a>Mercurial uses revision numbers purely as a convenient shorthand.  If you
need to discuss a changeset with someone, or make a record of a changeset
for some other reason (for example, in a bug report), use the hexadecimal
identifier.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507747"></a>1.4.2. 察看指定版本</h3></div></div></div>
<p><a name="x_2b"></a>To narrow the output of <span class="command"><strong>hg log</strong></span> down to a
single revision, use the <code class="option">-r</code> (or <code class="option">--rev</code>) option.  You can use either a revision
number or a long-form changeset identifier, and you can provide as many
revisions as you want.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg log -r 3</code></strong>
changeset:   3:0272e0d5a517
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:08:02 2008 +0200
summary:     Get make to generate the final binary from a .o file.

<code class="prompt">$</code> <strong class="userinput"><code>hg log -r 0272e0d5a517</code></strong>
changeset:   3:0272e0d5a517
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:08:02 2008 +0200
summary:     Get make to generate the final binary from a .o file.

<code class="prompt">$</code> <strong class="userinput"><code>hg log -r 1 -r 4</code></strong>
changeset:   1:82e55d328c8c
user:        mpm@selenic.com
date:        Fri Aug 26 01:21:28 2005 -0700
summary:     Create a makefile

changeset:   4:2278160e78d4
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:16:53 2008 +0200
summary:     Trim comments.

</pre>
<p><a name="x_2c"></a>If you want to see the history of several revisions without having to list
each one, you can use <span class="emphasis"><em>range notation</em></span>; this lets you
express the idea “<span class="quote">I want all revisions between <code class="literal">abc</code>
and <code class="literal">def</code>, inclusive</span>”.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg log -r 2:4</code></strong>
changeset:   2:fef857204a0c
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:05:04 2008 +0200
summary:     Introduce a typo into hello.c.

changeset:   3:0272e0d5a517
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:08:02 2008 +0200
summary:     Get make to generate the final binary from a .o file.

changeset:   4:2278160e78d4
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:16:53 2008 +0200
summary:     Trim comments.

</pre>
<p><a name="x_2d"></a>Mercurial also honours the order in which you specify revisions, so <span class="command"><strong>hg log -r 2:4</strong></span> prints 2, 3, and 4. while <span class="command"><strong>hg log -r 4:2</strong></span> prints 4, 3, and 2.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id507887"></a>1.4.3. 更详细的信息</h3></div></div></div>
<p><a name="x_2e"></a>While the summary information printed by <span class="command"><strong>hg
log</strong></span> is useful if you already know what you're looking for, you may
need to see a complete description of the change, or a list of the files
changed, if you're trying to decide whether a changeset is the one you're
looking for. The <span class="command"><strong>hg log</strong></span> command's <code class="option">-v</code> (or <code class="option">--verbose</code>) option gives you this extra detail.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg log -v -r 3</code></strong>
changeset:   3:0272e0d5a517
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:08:02 2008 +0200
files:       Makefile
description:
Get make to generate the final binary from a .o file.


</pre>
<p><a name="x_2f"></a>If you want to see both the description and content of a change, add the
<code class="option">-p</code> (or <code class="option">--patch</code>) option.  This displays the content of a
change as a <span class="emphasis"><em>unified diff</em></span> (if you've never seen a
unified diff before, see <a class="xref" href="managing-change-with-mercurial-queues.html#sec:mq:patch" title="11.4. 理解补丁">第 11.4 节 “理解补丁”</a> for an overview).</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg log -v -p -r 2</code></strong>
changeset:   2:fef857204a0c
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:05:04 2008 +0200
files:       hello.c
description:
Introduce a typo into hello.c.


diff -r 82e55d328c8c -r fef857204a0c hello.c
--- a/hello.c	Fri Aug 26 01:21:28 2005 -0700
+++ b/hello.c	Sat Aug 16 22:05:04 2008 +0200
@@ -11,6 +11,6 @@
 
 int main(int argc, char **argv)
 {
-	printf("hello, world!\n");
+	printf("hello, world!\");
 	return 0;
 }

</pre>
</div>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id507992"></a>1.5. 命令选项</h2></div></div></div>
<p><a name="x_30"></a>Let's take a brief break from exploring Mercurial commands to discuss a
pattern in the way that they work; you may find this useful to keep in mind
as we continue our tour.</p>
<p><a name="x_31"></a>Mercurial has a consistent and straightforward approach to dealing with the
options that you can pass to commands.  It follows the conventions for
options that are common to modern Linux and Unix systems.</p>
<div class="itemizedlist"><ul type="disc">
<li><p><a name="x_32"></a>Every option has a long name.  For example, as we've already seen, the
<span class="command"><strong>hg log</strong></span> command accepts a <code class="option">--rev</code> option.</p></li>
<li><p><a name="x_33"></a>Most options have short names, too.  Instead of <code class="option">--rev</code>, we can use <code class="option">-r</code>.  (The reason that some options don't have
short names is that the options in question are rarely used.)</p></li>
<li><p><a name="x_34"></a>Long options start with two dashes (e.g. <code class="option">--rev</code>), while short options start with one
(e.g. <code class="option">-r</code>).</p></li>
<li><p><a name="x_35"></a>Option naming and usage is consistent across commands.  For example, every
command that lets you specify a changeset ID or revision number accepts both
<code class="option">-r</code> and <code class="option">--rev</code> arguments.</p></li>
</ul></div>
<p><a name="x_36"></a>In the examples throughout this book, I use short options instead of long.
This just reflects my own preference, so don't read anything significant
into it.</p>
<p><a name="x_37"></a>Most commands that print output of some kind will print more output when
passed a <code class="option">-v</code> (or <code class="option">--verbose</code>) option, and less when passed
<code class="option">-q</code> (or <code class="option">--quiet</code>).</p>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id508120"></a>1.6. 创建和复审修改</h2></div></div></div>
<p><a name="x_38"></a>Now that we have a grasp of viewing history in Mercurial, let's take a look
at making some changes and examining them.</p>
<p><a name="x_39"></a>The first thing we'll do is isolate our experiment in a repository of its
own.  We use the <span class="command"><strong>hg clone</strong></span> command, but we
don't need to clone a copy of the remote repository.  Since we already have
a copy of it locally, we can just clone that instead.  This is much faster
than cloning over the network, and cloning a local repository uses less disk
space in most cases, too.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ..</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>hg clone hello my-hello</code></strong>
updating working directory
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
<code class="prompt">$</code> <strong class="userinput"><code>cd my-hello</code></strong>
</pre>
<p><a name="x_3a"></a>As an aside, it's often good practice to keep a “<span class="quote">pristine</span>” copy
of a remote repository around, which you can then make temporary clones of
to create sandboxes for each task you want to work on.  This lets you work
on multiple tasks in parallel, each isolated from the others until it's
complete and you're ready to integrate it back.  Because local clones are so
cheap, there's almost no overhead to cloning and destroying repositories
whenever you want.</p>
<p><a name="x_3b"></a>In our <code class="filename">my-hello</code> repository, we have a
file <code class="filename">hello.c</code> that contains the classic “<span class="quote">hello,
world</span>” program. Let's use the ancient and venerable
<span class="command"><strong>sed</strong></span> command to edit this file so that it prints a second
line of output.  (I'm only using <span class="command"><strong>sed</strong></span> to do this because
it's easy to write a scripted example this way.  Since you're not under the
same constraint, you probably won't want to use <span class="command"><strong>sed</strong></span>;
simply use your preferred text editor to do the same thing.)</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sed -i '/printf/a\\tprintf("hello again!\\n");' hello.c</code></strong>
</pre>
<p><a name="x_3c"></a>Mercurial's <span class="command"><strong>hg status</strong></span> command will tell us
what Mercurial knows about the files in the repository.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>ls</code></strong>
Makefile  hello.c
<code class="prompt">$</code> <strong class="userinput"><code>hg status</code></strong>
M hello.c
</pre>
<p><a name="x_3d"></a>The <span class="command"><strong>hg status</strong></span> command prints no output for
some files, but a line starting with “<span class="quote"><code class="literal">M</code></span>” for
<code class="filename">hello.c</code>.  Unless you tell it to, <span class="command"><strong>hg status</strong></span> will not print any output for files that
have not been modified.</p>
<p><a name="x_3e"></a>The “<span class="quote"><code class="literal">M</code></span>” indicates that Mercurial has noticed
that we modified <code class="filename">hello.c</code>.  We didn't need to
<span class="emphasis"><em>inform</em></span> Mercurial that we were going to modify the file
before we started, or that we had modified the file after we were done; it
was able to figure this out itself.</p>
<p><a name="x_3f"></a>It's a little bit helpful to know that we've modified
<code class="filename">hello.c</code>, but we might prefer to know exactly
<span class="emphasis"><em>what</em></span> changes we've made to it.  To do this, we use the
<span class="command"><strong>hg diff</strong></span> command.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg diff</code></strong>
diff -r 2278160e78d4 hello.c
--- a/hello.c	Sat Aug 16 22:16:53 2008 +0200
+++ b/hello.c	Tue Mar 31 06:55:36 2009 +0000
@@ -8,5 +8,6 @@
 int main(int argc, char **argv)
 {
 	printf("hello, world!\");
+	printf("hello again!\n");
 	return 0;
 }
</pre>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id508379"></a>1.7. 在新修改集中记录修改</h2></div></div></div>
<p><a name="x_40"></a>We can modify files, build and test our changes, and use <span class="command"><strong>hg status</strong></span> and <span class="command"><strong>hg
diff</strong></span> to review our changes, until we're satisfied with what we've
done and arrive at a natural stopping point where we want to record our work
in a new changeset.</p>
<p><a name="x_41"></a>The <span class="command"><strong>hg commit</strong></span> command lets us create a new
changeset; we'll usually refer to this as “<span class="quote">making a commit</span>” or
“<span class="quote">committing</span>”.</p>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id508426"></a>1.7.1. 配置用户名称</h3></div></div></div>
<p><a name="x_42"></a>When you try to run <span class="command"><strong>hg commit</strong></span> for the first
time, it is not guaranteed to succeed.  Mercurial records your name and
address with each change that you commit, so that you and others will later
be able to tell who made each change.  Mercurial tries to automatically
figure out a sensible username to commit the change with.  It will attempt
each of the following methods, in order:</p>
<div class="orderedlist"><ol type="1">
<li><p><a name="x_43"></a>If you specify a <code class="option">-u</code> option to the
<span class="command"><strong>hg commit</strong></span> command on the command line,
followed by a username, this is always given the highest precedence.</p></li>
<li><p><a name="x_44"></a>If you have set the <code class="envar">HGUSER</code> environment variable, this is
checked next.</p></li>
<li><p><a name="x_45"></a>If you create a file in your home directory called <code class="filename">.hgrc</code>, with a <code class="envar">username</code> entry, that will be used next.  To see
what the contents of this file should look like, refer to <a class="xref" href="a-tour-of-mercurial-the-basics.html#sec:tour-basic:username" title="1.7.1.1. 创建 Mercurial 的配置文件">第 1.7.1.1 节 “创建 Mercurial 的配置文件”</a> below.</p></li>
<li><p><a name="x_46"></a>If you have set the <code class="envar">EMAIL</code> environment variable, this will be
used next.</p></li>
<li><p><a name="x_47"></a>Mercurial will query your system to find out your local user name and host
name, and construct a username from these components. Since this often
results in a username that is not very useful, it will print a warning if it
has to do this.</p></li>
</ol></div>
<p><a name="x_48"></a>If all of these mechanisms fail, Mercurial will fail, printing an error
message.  In this case, it will not let you commit until you set up a
username.</p>
<p><a name="x_49"></a>You should think of the <code class="envar">HGUSER</code> environment variable and the
<code class="option">-u</code> option to the <span class="command"><strong>hg commit</strong></span> command as ways to
<span class="emphasis"><em>override</em></span> Mercurial's default selection of username.
For normal use, the simplest and most robust way to set a username for
yourself is by creating a <code class="filename">.hgrc</code> file;
see below for details.</p>
<div class="sect3" lang="zh">
<div class="titlepage"><div><div><h4 class="title">
<a name="sec:tour-basic:username"></a>1.7.1.1. 创建 Mercurial 的配置文件</h4></div></div></div>
<p><a name="x_4a"></a>To set a user name, use your favourite editor to create a file called
<code class="filename">.hgrc</code> in your home directory.  Mercurial
will use this file to look up your personalised configuration settings.  The
initial contents of your <code class="filename">.hgrc</code> should
look like this.</p>
<pre class="programlisting"># This is a Mercurial configuration file.
[ui]
username = Firstname Lastname
&lt;email.address@domain.net&gt;</pre>
<p><a name="x_4b"></a>The “<span class="quote"><code class="literal">[ui]</code></span>” line begins a
<span class="emphasis"><em>section</em></span> of the config file, so you can read the
“<span class="quote"><code class="literal">username = ...</code></span>” line as meaning “<span class="quote">set
the value of the <code class="literal">username</code> item in the
<code class="literal">ui</code> section</span>”. A section continues until a new
section begins, or the end of the file.  Mercurial ignores empty lines and
treats any text from “<span class="quote"><code class="literal">#</code></span>” to the end of a
line as a comment.</p>
</div>
<div class="sect3" lang="zh">
<div class="titlepage"><div><div><h4 class="title">
<a name="id508642"></a>1.7.1.2. 选择用户名称</h4></div></div></div>
<p><a name="x_4c"></a>You can use any text you like as the value of the
<code class="literal">username</code> config item, since this information is for
reading by other people, but for interpreting by Mercurial.  The convention
that most people follow is to use their name and email address, as in the
example above.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="figs/note.png"></td>
<th align="left">注意</th>
</tr>
<tr><td align="left" valign="top"><p><a name="x_4d"></a>Mercurial's built-in web server obfuscates email addresses, to make it more
difficult for the email harvesting tools that spammers use. This reduces the
likelihood that you'll start receiving more junk email if you publish a
Mercurial repository on the web.</p></td></tr>
</table></div>
</div>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id508672"></a>1.7.2. 写提交日志</h3></div></div></div>
<p><a name="x_4e"></a>When we commit a change, Mercurial drops us into a text editor, to enter a
message that will describe the modifications we've made in this changeset.
This is called the <span class="emphasis"><em>commit message</em></span>.  It will be a record
for readers of what we did and why, and it will be printed by <span class="command"><strong>hg log</strong></span> after we've finished committing.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg commit</code></strong>
</pre>
<p><a name="x_4f"></a>The editor that the <span class="command"><strong>hg commit</strong></span> command drops
us into will contain an empty line, followed by a number of lines starting
with “<span class="quote"><code class="literal">HG:</code></span>”.</p>
<pre class="programlisting">XXX fix this XXX</pre>
<p><a name="x_50"></a>Mercurial ignores the lines that start with
“<span class="quote"><code class="literal">HG:</code></span>”; it uses them only to tell us which
files it's recording changes to.  Modifying or deleting these lines has no
effect.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id508748"></a>1.7.3. 写好提交日志</h3></div></div></div>
<p><a name="x_51"></a>Since <span class="command"><strong>hg log</strong></span> only prints the first line of
a commit message by default, it's best to write a commit message whose first
line stands alone.  Here's a real example of a commit message that
<span class="emphasis"><em>doesn't</em></span> follow this guideline, and hence has a summary
that is not readable.</p>
<pre class="programlisting">
changeset:   73:584af0e231be
user:        Censored Person &lt;censored.person@example.org&gt;
date:        Tue Sep 26 21:37:07 2006 -0700
summary:     include buildmeister/commondefs. Add exports.</pre>
<p><a name="x_52"></a>As far as the remainder of the contents of the commit message are concerned,
there are no hard-and-fast rules.  Mercurial itself doesn't interpret or
care about the contents of the commit message, though your project may have
policies that dictate a certain kind of formatting.</p>
<p><a name="x_53"></a>My personal preference is for short, but informative, commit messages that
tell me something that I can't figure out with a quick glance at the output
of <span class="command"><strong>hg log --patch</strong></span>.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id508803"></a>1.7.4. 终止提交</h3></div></div></div>
<p><a name="x_54"></a>If you decide that you don't want to commit while in the middle of editing a
commit message, simply exit from your editor without saving the file that
it's editing.  This will cause nothing to happen to either the repository or
the working directory.</p>
<p><a name="x_55"></a>If we run the <span class="command"><strong>hg commit</strong></span> command without any
arguments, it records all of the changes we've made, as reported by <span class="command"><strong>hg status</strong></span> and <span class="command"><strong>hg
diff</strong></span>.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id508844"></a>1.7.5. 欣赏我们的成果</h3></div></div></div>
<p><a name="x_56"></a>Once we've finished the commit, we can use the <span class="command"><strong>hg
tip</strong></span> command to display the changeset we just created.  This
command produces output that is identical to <span class="command"><strong>hg
log</strong></span>, but it only displays the newest revision in the repository.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg tip -vp</code></strong>
changeset:   5:fb560e9a043e
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Tue Mar 31 06:55:36 2009 +0000
files:       hello.c
description:
Added an extra line of output


diff -r 2278160e78d4 -r fb560e9a043e hello.c
--- a/hello.c	Sat Aug 16 22:16:53 2008 +0200
+++ b/hello.c	Tue Mar 31 06:55:36 2009 +0000
@@ -8,5 +8,6 @@
 int main(int argc, char **argv)
 {
 	printf("hello, world!\");
+	printf("hello again!\n");
 	return 0;
 }

</pre>
<p><a name="x_57"></a>We refer to the newest revision in the repository as the tip revision, or
simply the tip.</p>
</div>
</div>
<div class="sect1" lang="zh">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id508902"></a>1.8. 共享修改</h2></div></div></div>
<p><a name="x_58"></a>We mentioned earlier that repositories in Mercurial are self-contained.
This means that the changeset we just created exists only in our <code class="filename">my-hello</code> repository.  Let's look at a few ways
that we can propagate this change into other repositories.</p>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="sec:tour:pull"></a>1.8.1. 从其它版本库取得修改</h3></div></div></div>
<p><a name="x_59"></a>To get started, let's clone our original <code class="filename">hello</code> repository, which does not contain the
change we just committed.  We'll call our temporary repository <code class="filename">hello-pull</code>.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ..</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>hg clone hello hello-pull</code></strong>
updating working directory
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
</pre>
<p><a name="x_5a"></a>We'll use the <span class="command"><strong>hg pull</strong></span> command to bring
changes from <code class="filename">my-hello</code> into <code class="filename">hello-pull</code>.  However, blindly pulling unknown
changes into a repository is a somewhat scary prospect.  Mercurial provides
the <span class="command"><strong>hg incoming</strong></span> command to tell us what
changes the <span class="command"><strong>hg pull</strong></span> command
<span class="emphasis"><em>would</em></span> pull into the repository, without actually
pulling the changes in.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd hello-pull</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>hg incoming ../my-hello</code></strong>
comparing with ../my-hello
searching for changes
changeset:   5:fb560e9a043e
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Tue Mar 31 06:55:36 2009 +0000
summary:     Added an extra line of output

</pre>
<p><a name="x_5b"></a>(Of course, someone could cause more changesets to appear in the repository
that we ran <span class="command"><strong>hg incoming</strong></span> in, before we get a
chance to <span class="command"><strong>hg pull</strong></span> the changes, so that we
could end up pulling changes that we didn't expect.)</p>
<p><a name="x_5c"></a>Bringing changes into a repository is a simple matter of running the
<span class="command"><strong>hg pull</strong></span> command, and telling it which
repository to pull from.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg tip</code></strong>
changeset:   4:2278160e78d4
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:16:53 2008 +0200
summary:     Trim comments.

<code class="prompt">$</code> <strong class="userinput"><code>hg pull ../my-hello</code></strong>
pulling from ../my-hello
searching for changes
adding changesets
adding manifests
adding file changes
added 1 changesets with 1 changes to 1 files
(run 'hg update' to get a working copy)
<code class="prompt">$</code> <strong class="userinput"><code>hg tip</code></strong>
changeset:   5:fb560e9a043e
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Tue Mar 31 06:55:36 2009 +0000
summary:     Added an extra line of output

</pre>
<p><a name="x_5d"></a>As you can see from the before-and-after output of <span class="command"><strong>hg
tip</strong></span>, we have successfully pulled changes into our repository.
There remains one step before we can see these changes in the working
directory.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id509144"></a>1.8.2. 更新工作目录</h3></div></div></div>
<p><a name="x_5e"></a>We have so far glossed over the relationship between a repository and its
working directory.  The <span class="command"><strong>hg pull</strong></span> command
that we ran in <a class="xref" href="a-tour-of-mercurial-the-basics.html#sec:tour:pull" title="1.8.1. 从其它版本库取得修改">第 1.8.1 节 “从其它版本库取得修改”</a> brought changes into the
repository, but if we check, there's no sign of those changes in the working
directory.  This is because <span class="command"><strong>hg pull</strong></span> does
not (by default) touch the working directory.  Instead, we use the <span class="command"><strong>hg update</strong></span> command to do this.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>grep printf hello.c</code></strong>
	printf("hello, world!\");
<code class="prompt">$</code> <strong class="userinput"><code>hg update tip</code></strong>
1 files updated, 0 files merged, 0 files removed, 0 files unresolved
<code class="prompt">$</code> <strong class="userinput"><code>grep printf hello.c</code></strong>
	printf("hello, world!\");
	printf("hello again!\n");
</pre>
<p><a name="x_5f"></a>It might seem a bit strange that <span class="command"><strong>hg pull</strong></span>
doesn't update the working directory automatically.  There's actually a good
reason for this: you can use <span class="command"><strong>hg update</strong></span> to
update the working directory to the state it was in at <span class="emphasis"><em>any
revision</em></span> in the history of the repository.  If you had the
working directory updated to an old revision---to hunt down the origin of a
bug, say---and ran a <span class="command"><strong>hg pull</strong></span> which
automatically updated the working directory to a new revision, you might not
be terribly happy.</p>
<p><a name="x_60"></a>However, since pull-then-update is such a common thing to do, Mercurial lets
you combine the two by passing the <code class="option">-u</code>
option to <span class="command"><strong>hg pull</strong></span>.</p>
<p><a name="x_61"></a>If you look back at the output of <span class="command"><strong>hg pull</strong></span>
in <a class="xref" href="a-tour-of-mercurial-the-basics.html#sec:tour:pull" title="1.8.1. 从其它版本库取得修改">第 1.8.1 节 “从其它版本库取得修改”</a> when we ran it without <code class="option">-u</code>, you can see that it printed a helpful
reminder that we'd have to take an explicit step to update the working
directory:</p>
<p><a name="x_62"></a>To find out what revision the working directory is at, use the <span class="command"><strong>hg parents</strong></span> command.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg parents</code></strong>
changeset:   5:fb560e9a043e
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Tue Mar 31 06:55:36 2009 +0000
summary:     Added an extra line of output

</pre>
<p><a name="x_63"></a>If you look back at <a class="xref" href="a-tour-of-mercurial-the-basics.html#fig:tour-basic:history" title="图 1.1. 版本库 hello 的历史图">图 1.1 “版本库 hello 的历史图”</a>, you'll see
arrows connecting each changeset.  The node that the arrow leads
<span class="emphasis"><em>from</em></span> in each case is a parent, and the node that the
arrow leads <span class="emphasis"><em>to</em></span> is its child.  The working directory has
a parent in just the same way; this is the changeset that the working
directory currently contains.</p>
<p><a name="x_64"></a>To update the working directory to a particular revision, give a revision
number or changeset ID to the <span class="command"><strong>hg update</strong></span>
command.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg update 2</code></strong>
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
<code class="prompt">$</code> <strong class="userinput"><code>hg parents</code></strong>
changeset:   2:fef857204a0c
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Sat Aug 16 22:05:04 2008 +0200
summary:     Introduce a typo into hello.c.

<code class="prompt">$</code> <strong class="userinput"><code>hg update</code></strong>
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
</pre>
<p><a name="x_65"></a>If you omit an explicit revision, <span class="command"><strong>hg update</strong></span>
will update to the tip revision, as shown by the second call to <span class="command"><strong>hg update</strong></span> in the example above.</p>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id509422"></a>1.8.3. 发布修改到其它版本库</h3></div></div></div>
<p><a name="x_66"></a>Mercurial lets us push changes to another repository, from the repository
we're currently visiting.  As with the example of <span class="command"><strong>hg
pull</strong></span> above, we'll create a temporary repository to push our
changes into.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ..</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>hg clone hello hello-push</code></strong>
updating working directory
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
</pre>
<p><a name="x_67"></a>The <span class="command"><strong>hg outgoing</strong></span> command tells us what
changes would be pushed into another repository.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd my-hello</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>hg outgoing ../hello-push</code></strong>
comparing with ../hello-push
searching for changes
changeset:   5:fb560e9a043e
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Tue Mar 31 06:55:36 2009 +0000
summary:     Added an extra line of output

</pre>
<p><a name="x_68"></a>And the <span class="command"><strong>hg push</strong></span> command does the actual
push.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg push ../hello-push</code></strong>
pushing to ../hello-push
searching for changes
adding changesets
adding manifests
adding file changes
added 1 changesets with 1 changes to 1 files
</pre>
<p><a name="x_69"></a>As with <span class="command"><strong>hg pull</strong></span>, the <span class="command"><strong>hg push</strong></span> command does not update the working
directory in the repository that it's pushing changes into. (Unlike <span class="command"><strong>hg pull</strong></span>, <span class="command"><strong>hg push</strong></span>
does not provide a <code class="literal">-u</code> option that updates the other
repository's working directory.)</p>
<p><a name="x_6a"></a>What happens if we try to pull or push changes and the receiving repository
already has those changes? Nothing too exciting.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg push ../hello-push</code></strong>
pushing to ../hello-push
searching for changes
no changes found
</pre>
</div>
<div class="sect2" lang="zh">
<div class="titlepage"><div><div><h3 class="title">
<a name="id509600"></a>1.8.4. 通过网络共享修改</h3></div></div></div>
<p><a name="x_6b"></a>The commands we have covered in the previous few sections are not limited to
working with local repositories.  Each works in exactly the same fashion
over a network connection; simply pass in a URL instead of a local path.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg outgoing http://hg.serpentine.com/tutorial/hello</code></strong>
comparing with http://hg.serpentine.com/tutorial/hello
searching for changes
changeset:   5:fb560e9a043e
tag:         tip
user:        Bryan O'Sullivan &lt;bos@serpentine.com&gt;
date:        Tue Mar 31 06:55:36 2009 +0000
summary:     Added an extra line of output

</pre>
<p><a name="x_6c"></a>In this example, we can see what changes we could push to the remote
repository, but the repository is understandably not set up to let anonymous
users push to it.</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>hg push http://hg.serpentine.com/tutorial/hello</code></strong>
pushing to http://hg.serpentine.com/tutorial/hello
searching for changes
ssl required
</pre>
</div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="preface.html">上一页</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="a-tour-of-mercurial-merging-work.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">序言 </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 第 2 章 Mercurial 教程: 合并工作</td>
</tr>
</table>
</div>
</body>
</html>
