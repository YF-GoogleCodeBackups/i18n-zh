<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>svnserve - &#23450;&#21046;&#30340;&#26381;&#21153;&#22120;</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_8167"><link rel="home" href="index.html" title="Subversion &#26435;&#23041;&#25351;&#21335;"><link rel="up" href="svn.serverconfig.html" title="&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#26381;&#21153;&#37197;&#32622;"><link rel="prev" href="svn.serverconfig.choosing.html" title="&#36873;&#25321;&#19968;&#20010;&#26381;&#21153;&#22120;&#37197;&#32622;"><link rel="next" href="svn.serverconfig.httpd.html" title="httpd - Apache &#30340; HTTP &#26381;&#21153;&#22120;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">svnserve - &#23450;&#21046;&#30340;&#26381;&#21153;&#22120; </th></tr><tr><td width="20%" align="left"><a accesskey="p" href="svn.serverconfig.choosing.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#26381;&#21153;&#37197;&#32622;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="svn.serverconfig.httpd.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="svn.serverconfig.svnserve"></a>svnserve - &#23450;&#21046;&#30340;&#26381;&#21153;&#22120; </h2></div></div></div>
      
      <p><span class="command"><strong>svnserve</strong></span>&#26159;&#19968;&#20010;&#36731;&#22411;&#30340;&#26381;&#21153;&#22120;&#65292;&#21487;&#20197;&#21516;&#23458;&#25143;&#31471;&#36890;&#36807;&#22312;TCP/IP&#22522;&#30784;&#19978;&#30340;&#33258;&#23450;&#20041;&#26377;&#29366;&#24577;&#21327;&#35758;&#36890;&#35759;&#65292;&#23458;&#25143;&#31471;&#36890;&#36807;&#20351;&#29992;&#24320;&#22836;&#20026;<code class="literal">svn://</code>&#25110;&#32773;<code class="literal">svn+ssh://</code><span class="command"><strong>svnserve</strong></span>&#30340;URL&#26469;&#35775;&#38382;&#19968;&#20010;<span class="command"><strong>svnserve</strong></span>&#26381;&#21153;&#22120;&#12290;&#36825;&#19968;&#23567;&#33410;&#23558;&#20250;&#35299;&#37322;&#36816;&#34892;<span class="command"><strong>svnserve</strong></span>&#30340;&#19981;&#21516;&#26041;&#24335;&#65292;&#23458;&#25143;&#31471;&#24590;&#26679;&#23454;&#29616;&#26381;&#21153;&#22120;&#30340;&#35748;&#35777;&#65292;&#24590;&#26679;&#37197;&#32622;&#29256;&#26412;&#24211;&#24688;&#24403;&#30340;&#35775;&#38382;&#25511;&#21046;&#12290;</p>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.svnserve.invoking"></a>&#35843;&#29992;&#26381;&#21153;&#22120;</h3></div></div></div>
        
        <p>&#26377;&#35768;&#22810;&#19981;&#21516;&#26041;&#27861;&#36816;&#34892;<span class="command"><strong>svnserve</strong></span>&#65306;</p>
        <div class="itemizedlist"><ul type="disc"><li>
            <p>&#20316;&#20026;&#19968;&#20010;&#29420;&#31435;&#23432;&#25252;&#36827;&#31243;&#21551;&#21160;<span class="command"><strong>svnserve</strong></span>&#65292;&#30417;&#21548;&#35831;&#27714;&#12290;</p>
          </li><li>
            <p>&#24403;&#29305;&#23450;&#31471;&#21475;&#25910;&#21040;&#19968;&#20010;&#35831;&#27714;&#65292;&#23601;&#20250;&#20351;UNIX&#30340;<span class="command"><strong>inetd</strong></span>&#23432;&#25252;&#36827;&#31243;&#20020;&#26102;&#35843;&#29992;<span class="command"><strong>svnserve</strong></span>&#22788;&#29702;&#12290;</p>
          </li><li>
            <p>&#20351;&#29992;SSH&#22312;&#21152;&#23494;&#36890;&#36947;&#21457;&#36215;&#20020;&#26102;<span class="command"><strong>svnserve</strong></span>&#26381;&#21153;&#12290;</p>
          </li><li>
            <p>&#20197;Windows service&#26381;&#21153;&#26041;&#24335;&#36816;&#34892;<span class="command"><strong>svnserve</strong></span>&#12290;</p>
          </li></ul></div>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.invoking.daemon"></a>svnserve &#19982;&#23432;&#25252;&#36827;&#31243;</h4></div></div></div>
          
          <p>&#20351;&#29992;<span class="command"><strong>svnserve</strong></span>&#26368;&#31616;&#21333;&#30340;&#26041;&#24335;&#26159;&#20316;&#20026;&#29420;&#31435;&#8220;<span class="quote">&#23432;&#25252;</span>&#8221;&#36827;&#31243;&#36816;&#34892;&#65292;&#20351;&#29992;<code class="option">-d</code>&#36873;&#39033;&#65306;</p>
          <pre class="screen">
$ svnserve -d
$               # svnserve is now running, listening on port 3690
</pre>
          <p>When running <span class="command"><strong>svnserve</strong></span> in daemon mode,
          you can use the <code class="option">--listen-port</code> and
          <code class="option">--listen-host</code> options to customize the
          exact port and hostname to &#8220;<span class="quote">bind</span>&#8221; to.</p>
          <p>Once we successfully start <span class="command"><strong>svnserve</strong></span> as
        explained previously, it makes every repository on your system
        available to the network.  A client needs to specify an
        <span class="emphasis"><em>absolute</em></span> path in the repository URL.  For
        example, if a repository is located at
        <code class="filename">/var/svn/project1</code>, a client would
        reach it via
        <code class="uri">svn://host.example.com/var/svn/project1</code>.  To
        increase security, you can pass the <code class="option">-r</code> option
        to <span class="command"><strong>svnserve</strong></span>, which restricts it to
        exporting only repositories below that path.  For
        example:</p>
          <pre class="screen">
$ svnserve -d -r /var/svn
&#8230;
</pre>
          <p>&#20351;&#29992;<code class="option">-r</code>&#21487;&#20197;&#26377;&#25928;&#22320;&#25913;&#21464;&#25991;&#20214;&#31995;&#32479;&#30340;&#26681;&#20301;&#32622;&#65292;&#23458;&#25143;&#31471;&#21487;&#20197;&#20351;&#29992;&#21435;&#25481;&#21069;&#21322;&#37096;&#20998;&#30340;&#36335;&#24452;&#65292;&#30041;&#19979;&#30340;&#35201;&#30701;&#19968;&#20123;&#30340;(&#26356;&#21152;&#26377;&#25552;&#31034;&#24615;)URL&#65306;</p>
          <pre class="screen">
$ svn checkout svn://host.example.com/project1
&#8230;
</pre>
        </div>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.invoking.inetd"></a>&#36890;&#36807; inetd &#35843;&#29992; svnserve</h4></div></div></div>
          
          <p>If you want <span class="command"><strong>inetd</strong></span> to launch the
          process, you need to pass the <code class="option">-i</code>
          (<code class="option">--inetd</code>) option.  In the following
          example, we've shown the output from running
          <code class="literal">svnserve -i</code> at the command line, but note
          that this isn't how you actually start the daemon; see the
          paragraphs following the example for how to configure
          <span class="command"><strong>inetd</strong></span> to start
          <span class="command"><strong>svnserve</strong></span>.</p>
          <pre class="screen">
$ svnserve -i
( success ( 1 2 ( ANONYMOUS ) ( edit-pipeline ) ) )
</pre>
          <p>When invoked with the <code class="option">--inetd</code> option,
        <span class="command"><strong>svnserve</strong></span> attempts to speak with a
        Subversion client via <code class="filename">stdin</code> and
        <code class="filename">stdout</code> using a custom protocol.  This is
        the standard behavior for a program being run via
        <span class="command"><strong>inetd</strong></span>.  The IANA has reserved port 3690 for
        the Subversion protocol, so on a Unix-like system you can add
        lines to <code class="filename">/etc/services</code> such as these (if
        they don't already exist):</p>
          <pre class="screen">
svn           3690/tcp   # Subversion
svn           3690/udp   # Subversion
</pre>
          <p>&#22914;&#26524;&#31995;&#32479;&#26159;&#20351;&#29992;&#32463;&#20856;&#30340;&#31867;Unix&#30340;<span class="command"><strong>inetd</strong></span>&#23432;&#25252;&#36827;&#31243;&#65292;&#20320;&#21487;&#20197;&#22312;<code class="filename">/etc/inetd.conf</code>&#28155;&#21152;&#36825;&#20960;&#34892;&#65306;</p>
          <pre class="screen">
svn stream tcp nowait svnowner /usr/bin/svnserve svnserve -i
</pre>
          <p>&#30830;&#23450;&#8220;<span class="quote">svnowner</span>&#8221;&#29992;&#25143;&#25317;&#26377;&#35775;&#38382;&#29256;&#26412;&#24211;&#30340;&#36866;&#24403;&#26435;&#38480;&#65292;&#29616;&#22312;&#22914;&#26524;&#19968;&#20010;&#23458;&#25143;&#36830;&#25509;&#26469;&#21040;&#20320;&#30340;&#26381;&#21153;&#22120;&#30340;&#31471;&#21475;3690&#65292;<span class="command"><strong>inetd</strong></span>&#20250;&#20135;&#29983;&#19968;&#20010;<span class="command"><strong>svnserve</strong></span>&#36827;&#31243;&#26469;&#20570;&#26381;&#21153;&#12290;&#24403;&#28982;&#65292;&#20320;&#20063;&#21487;&#20197;&#28155;&#21152;<code class="option">-r</code>&#21040;&#21629;&#20196;&#34892;&#65292;&#38480;&#21046;&#26292;&#38706;&#20986;&#30340;&#29256;&#26412;&#24211;&#12290;</p>
        </div>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.invoking.tunnel"></a>&#36890;&#36807;&#38567;&#36947;&#35843;&#29992; svnserve</h4></div></div></div>
          
          <p>A third way to invoke <span class="command"><strong>svnserve</strong></span> is in
          tunnel mode, using the <code class="option">-t</code> option.  This
          mode assumes that a remote-service program such as
          <span class="command"><strong>rsh</strong></span> or <span class="command"><strong>ssh</strong></span> has
          successfully authenticated a user and is now invoking a
          private <span class="command"><strong>svnserve</strong></span> process <span class="emphasis"><em>as
          that user</em></span>.  (Note that you, the user, will
          rarely, if ever, have reason to invoke
          <span class="command"><strong>svnserve</strong></span> with the <code class="option">-t</code> at
          the command line; instead, the SSH daemon
          does so for you.)  The <span class="command"><strong>svnserve</strong></span> program
          behaves normally (communicating via
          <code class="filename">stdin</code> and <code class="filename">stdout</code>)
          and assumes that the traffic is being automatically
          redirected over some sort of tunnel back to the client.
          When <span class="command"><strong>svnserve</strong></span> is invoked by a tunnel
          agent like this, be sure that the authenticated user has
          full read and write access to the repository database files.
          It's essentially the same as a local user accessing the
          repository via <code class="literal">file://</code> URLs.</p>
          <p>&#36825;&#20010;&#36873;&#39033;&#23558;&#22312;<a class="xref" href="svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.sshauth" title="&#31359;&#36234; SSH &#38567;&#36947;">&#8220;&#31359;&#36234; SSH &#38567;&#36947;&#8221;&#19968;&#33410;</a>&#35814;&#32454;&#35752;&#35770;&#12290;</p>
        </div>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.invoking.winservice"></a>svnserve &#19982; Windows &#26381;&#21153;</h4></div></div></div>
          
          <p>If your Windows system is a descendant of Windows NT
          (2000, 2003, XP, or Vista), you can
          run <span class="command"><strong>svnserve</strong></span> as a standard Windows
          service.  This is typically a much nicer experience than
          running it as a standalone daemon with the <code class="option">--daemon
          (-d)</code> option.  Using daemon mode requires launching
          a console, typing a command, and then leaving the console
          window running indefinitely.  A Windows service, however,
          runs in the background, can start at boot time
          automatically, and can be started and stopped using the same
          consistent administration interface as other
          Windows services. </p>
          <p>&#20320;&#38656;&#35201;&#20351;&#29992;&#21629;&#20196;&#34892;&#24037;&#20855;<span class="command"><strong>SC.EXE</strong></span>&#23450;&#20041;&#26032;&#30340;&#26381;&#21153;&#65292;&#23601;&#20687;<span class="command"><strong>inetd</strong></span>&#30340;&#37197;&#32622;&#34892;&#65292;&#20320;&#24517;&#39035;&#22312;Windows&#21551;&#21160;&#26102;&#25351;&#26126;<span class="command"><strong>svnserve</strong></span>&#30340;&#35843;&#29992;&#65306;</p>
          <pre class="screen">
C:\&gt; sc create svn
        binpath= "C:\svn\bin\svnserve.exe --service -r C:\repos"
        displayname= "Subversion Server"
        depend= Tcpip
        start= auto
</pre>
          <p>&#36825;&#26679;&#23450;&#20041;&#20102;&#19968;&#20010;&#26032;&#30340;Windows&#26381;&#21153;&#65292;&#21483;&#20570;&#8220;<span class="quote">svn</span>&#8221;&#65292;&#20250;&#22312;&#21551;&#21160;&#26102;(&#22312;&#36825;&#20010;&#20363;&#23376;&#37324;&#65292;&#26681;&#30446;&#24405;&#26159;<code class="filename">C:\repos</code>&#12290;)&#25191;&#34892;&#29305;&#23450;&#30340;<span class="command"><strong>svnserve.exe</strong></span>&#65292;&#21487;&#26159;&#21069;&#38754;&#36825;&#20010;&#20363;&#23376;&#20135;&#29983;&#20102;&#19968;&#20123;&#38169;&#35823;&#12290;</p>
          <p>First, notice that the <span class="command"><strong>svnserve.exe</strong></span>
          program must always be invoked with the
          <code class="option">--service</code> option.  Any other options to
          <span class="command"><strong>svnserve</strong></span> must then be specified on the
          same line, but you cannot add conflicting options such as
          <code class="option">--daemon (-d)</code>, <code class="option">--tunnel</code>,
          or <code class="option">--inetd (-i)</code>.  Options such as
          <code class="option">-r</code> or <code class="option">--listen-port</code> are
          fine, though.  Second, be careful about spaces when invoking
          the <span class="command"><strong>SC.EXE</strong></span> command: the <code class="literal">key=
          value</code> patterns must have no spaces between
          <code class="literal">key=</code> and must have exactly one space
          before the <code class="literal">value</code>.  Lastly, be careful
          about spaces in your command line to be invoked.  If a
          directory name contains spaces (or other characters that
          need escaping), place the entire inner value of
          <code class="literal">binpath</code> in double quotes, by escaping
          them:</p>
          <pre class="screen">
C:\&gt; sc create svn
        binpath= "\"C:\program files\svn\bin\svnserve.exe\" --service -r C:\repos"
        displayname= "Subversion Server"
        depend= Tcpip
        start= auto
</pre>
          <p>Also note that the word <code class="literal">binpath</code> is
          misleading&#8212;its value is a <span class="emphasis"><em>command
          line</em></span>, not the path to an executable.  That's why
          you need to surround it with quotes if it contains
          embedded spaces.</p>
          <p>&#19968;&#26086;&#23450;&#20041;&#20102;&#26381;&#21153;&#65292;&#23601;&#21487;&#20197;&#20351;&#29992;&#26631;&#20934;GUI&#24037;&#20855;(&#26381;&#21153;&#31649;&#29702;&#25511;&#21046;&#38754;&#26495;)&#36827;&#34892;&#20572;&#27490;&#12289;&#21551;&#21160;&#21644;&#26597;&#35810;&#65292;&#25110;&#32773;&#26159;&#36890;&#36807;&#21629;&#20196;&#34892;&#65306;</p>
          <pre class="screen">
C:\&gt; net stop svn
C:\&gt; net start svn
</pre>
          <p>The service can also be uninstalled (i.e., undefined) by
          deleting its definition:  <strong class="userinput"><code>sc delete svn</code></strong>.
          Just be sure to stop the service first!
          The <span class="command"><strong>SC.EXE</strong></span> program has many other
          subcommands and options; run <strong class="userinput"><code>sc /?</code></strong> to
          learn more about it.</p>
        </div>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.svnserve.auth"></a>&#20869;&#32622;&#30340;&#35748;&#35777;&#21644;&#25480;&#26435;</h3></div></div></div>
        
        <p>&#22914;&#26524;&#19968;&#20010;&#23458;&#25143;&#31471;&#36830;&#25509;&#21040;<span class="command"><strong>svnserve</strong></span>&#36827;&#31243;&#65292;&#22914;&#19979;&#20107;&#24773;&#20250;&#21457;&#29983;&#65306;</p>
        <div class="itemizedlist"><ul type="disc"><li>
            <p>&#23458;&#25143;&#31471;&#36873;&#25321;&#29305;&#23450;&#30340;&#29256;&#26412;&#24211;&#12290;</p>
          </li><li>
            <p>&#26381;&#21153;&#22120;&#22788;&#29702;&#29256;&#26412;&#24211;&#30340;<code class="filename">conf/svnserve.conf</code>&#25991;&#20214;&#65292;&#24182;&#19988;&#25191;&#34892;&#37324;&#38754;&#23450;&#20041;&#30340;&#25152;&#26377;&#35748;&#35777;&#21644;&#25480;&#26435;&#25919;&#31574;&#12290;</p>
          </li><li>
            <p>Depending on the defined policies, one of the
        following may occur:</p>
            <div class="itemizedlist"><ul type="circle"><li>
                <p>&#22914;&#26524;&#27809;&#26377;&#25910;&#21040;&#35748;&#35777;&#35831;&#27714;&#65292;&#23458;&#25143;&#31471;&#21487;&#33021;&#34987;&#20801;&#35768;&#21311;&#21517;&#35775;&#38382;&#12290;</p>
              </li><li>
                <p>&#23458;&#25143;&#31471;&#21487;&#20197;&#22312;&#20219;&#20309;&#35748;&#35777;&#26102;&#34987;&#35201;&#27714;&#12290;</p>
              </li><li>
                <p>&#22914;&#26524;&#25805;&#20316;&#22312;&#8220;<span class="quote">&#36890;&#36947;&#27169;&#24335;</span>&#8221;&#65292;&#23458;&#25143;&#31471;&#20250;&#23459;&#24067;&#33258;&#24049;&#24050;&#32463;&#22312;&#22806;&#37096;&#24471;&#21040;&#35748;&#35777;(&#36890;&#24120;&#36890;&#36807;SSH)&#12290;</p>
              </li></ul></div>
          </li></ul></div>
        <p><span class="command"><strong>svnserve</strong></span>&#26381;&#21153;&#22120;&#32570;&#30465;&#21482;&#30693;&#36947;&#21457;&#36865;CRAM-MD5<sup>[<a name="d4e5599" href="#ftn.d4e5599" class="footnote">40</a>]</sup>&#35748;&#35777;&#35831;&#27714;&#65292;&#26412;&#36136;&#19978;&#35762;&#65292;&#23601;&#26159;&#26381;&#21153;&#22120;&#21457;&#36865;&#19968;&#20123;&#25968;&#25454;&#21040;&#23458;&#25143;&#31471;&#65292;&#23458;&#25143;&#31471;&#20351;&#29992;MD5&#21704;&#24076;&#31639;&#27861;&#21019;&#24314;&#36825;&#20123;&#25968;&#25454;&#32452;&#21512;&#23494;&#30721;&#30340;&#25351;&#32441;&#65292;&#28982;&#21518;&#36820;&#22238;&#25351;&#32441;&#65292;&#26381;&#21153;&#22120;&#25191;&#34892;&#21516;&#26679;&#30340;&#35745;&#31639;&#24182;&#19988;&#26469;&#35745;&#31639;&#32467;&#26524;&#30340;&#19968;&#33268;&#24615;&#65292;<span class="emphasis"><em>&#30495;&#27491;&#30340;&#23494;&#30721;&#24182;&#27809;&#26377;&#22312;&#20114;&#32852;&#32593;&#19978;&#20256;&#36882;&#12290;</em></span></p>
        <p>If your <span class="command"><strong>svnserve</strong></span> server was built with
        SASL support, it not only knows how to send CRAM-MD5 challenges,
        but also likely knows a whole host of other authentication
        mechanisms.  See <a class="xref" href="svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.sasl" title="&#35753; svnserve &#20351;&#29992; SASL">&#8220;&#35753; svnserve &#20351;&#29992; SASL&#8221;&#19968;&#33410;</a> later in this
        chapter to learn how to configure SASL authentication and
        encryption.</p>
        <p>It's also possible, of course, for the client to be
        externally authenticated via a tunnel agent, such as
        <span class="command"><strong>ssh</strong></span>.  In that case, the server simply
        examines the user it's running as, and uses this name as the
        authenticated username.  For more on this, see the later
        section, <a class="xref" href="svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.sshauth" title="&#31359;&#36234; SSH &#38567;&#36947;">&#8220;&#31359;&#36234; SSH &#38567;&#36947;&#8221;&#19968;&#33410;</a>.</p>
        <p>As you've already guessed, a repository's
        <code class="filename">svnserve.conf</code> file is the central
        mechanism for controlling authentication and authorization
        policies.  The file has the same format as other configuration
        files (see <a class="xref" href="svn.customization.html#svn.advanced.confarea" title="&#36816;&#34892;&#37197;&#32622;&#21306;">&#8220;&#36816;&#34892;&#37197;&#32622;&#21306;&#8221;&#19968;&#33410;</a>):
        section names are marked by square brackets
        (<code class="literal">[</code> and <code class="literal">]</code>), comments
        begin with hashes (<code class="literal">#</code>), and each section
        contains specific variables that can be set (<code class="literal">variable
        = value</code>).  Let's walk through these files and learn
        how to use them.</p>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.auth.users"></a>&#21019;&#24314;&#19968;&#20010;&#29992;&#25143;&#25991;&#20214;&#21644;&#35748;&#35777;&#22495;</h4></div></div></div>
          
          <p>For now, the <code class="literal">[general]</code> section of
          <code class="filename">svnserve.conf</code> has all the variables you
          need.  Begin by changing the values of those variables:
          choose a name for a file that will contain your usernames
          and passwords and choose an authentication realm:</p>
          <pre class="screen">
[general]
password-db = userfile
realm = example realm
</pre>
          <p><code class="literal">realm</code>&#26159;&#20320;&#23450;&#20041;&#30340;&#21517;&#31216;&#65292;&#36825;&#21578;&#35785;&#23458;&#25143;&#31471;&#36830;&#25509;&#30340;&#8220;<span class="quote">&#35748;&#35777;&#21629;&#21517;&#31354;&#38388;</span>&#8221;&#65292;Subversion&#20250;&#22312;&#35748;&#35777;&#25552;&#31034;&#37324;&#26174;&#31034;&#65292;&#24182;&#19988;&#20316;&#20026;&#20973;&#35777;&#32531;&#23384;(&#35265;<a class="xref" href="svn.serverconfig.netmodel.html#svn.serverconfig.netmodel.credcache" title="&#23458;&#25143;&#31471;&#20973;&#35777;&#32531;&#23384;">&#8220;&#23458;&#25143;&#31471;&#20973;&#35777;&#32531;&#23384;&#8221;&#19968;&#33410;</a>&#12290;)&#30340;&#20851;&#38190;&#23383;(&#36824;&#26377;&#26381;&#21153;&#22120;&#30340;&#20027;&#26426;&#21517;&#21644;&#31471;&#21475;)&#65292;<code class="literal">password-db</code>&#21442;&#25968;&#25351;&#20986;&#20102;&#20445;&#23384;&#29992;&#25143;&#21644;&#23494;&#30721;&#21015;&#34920;&#25991;&#20214;&#65292;&#36825;&#20010;&#25991;&#20214;&#20351;&#29992;&#21516;&#26679;&#29087;&#24713;&#30340;&#26684;&#24335;&#65292;&#20030;&#20010;&#20363;&#23376;&#65306;</p>
          <pre class="screen">
[users]
harry = foopassword
sally = barpassword
</pre>
          <p>The value of <code class="literal">password-db</code> can be an
          absolute or relative path to the users file.  For many
          admins, it's easy to keep the file right in the
          <code class="filename">conf/</code> area of the repository, alongside
          <code class="filename">svnserve.conf</code>.  On the other hand, it's
          possible you may want to have two or more repositories share
          the same users file; in that case, the file should probably
          live in a more public place.  The repositories sharing the
          users file should also be configured to have the same realm,
          since the list of users essentially defines an
          authentication realm.  Wherever the file lives, be sure to
          set the file's read and write permissions appropriately.  If
          you know which user(s) <span class="command"><strong>svnserve</strong></span> will run
          as, restrict read access to the users file as necessary.</p>
        </div>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.auth.general"></a>&#35774;&#32622;&#35775;&#38382;&#25511;&#21046;</h4></div></div></div>
          
          <p>There are two more variables to set in the
          <code class="filename">svnserve.conf</code> file: they determine what
          unauthenticated (anonymous) and authenticated users are
          allowed to do.  The variables <code class="literal">anon-access</code>
          and <code class="literal">auth-access</code> can be set to the value
          <code class="literal">none</code>, <code class="literal">read</code>, or
          <code class="literal">write</code>.  Setting the value to
          <code class="literal">none</code> prohibits both reading and writing;
          <code class="literal">read</code> allows read-only access to the
          repository, and <code class="literal">write</code> allows complete
          read/write access to the repository.  For example:</p>
          <pre class="screen">
[general]
password-db = userfile
realm = example realm

# anonymous users can only read the repository
anon-access = read

# authenticated users can both read and write
auth-access = write
</pre>
          <p>&#23454;&#20363;&#20013;&#30340;&#35774;&#32622;&#23454;&#38469;&#19978;&#26159;&#21442;&#25968;&#30340;&#32570;&#30465;&#20540;&#65292;&#20320;&#19968;&#23450;&#19981;&#35201;&#24536;&#20102;&#35774;&#32622;&#23427;&#20204;&#65292;&#22914;&#26524;&#20320;&#24076;&#26395;&#26356;&#20445;&#23432;&#19968;&#28857;&#65292;&#20320;&#21487;&#20197;&#23436;&#20840;&#23553;&#38145;&#21311;&#21517;&#35775;&#38382;&#65306;</p>
          <pre class="screen">
[general]
password-db = userfile
realm = example realm

# anonymous users aren't allowed
anon-access = none

# authenticated users can both read and write
auth-access = write
</pre>
          <p>The server process understands not only
        these &#8220;<span class="quote">blanket</span>&#8221; access controls to the
        repository, but also finer-grained access restrictions placed
        on specific files and directories within the repository.  To
        make use of this feature, you need to define a file containing
        more detailed rules, and then set
        the <code class="literal">authz-db</code> variable to point to it:</p>
          <pre class="screen">
[general]
password-db = userfile
realm = example realm

# Specific access rules for specific locations
authz-db = authzfile
</pre>
          <p>We discuss the syntax of the <code class="filename">authzfile</code> file
          in detail later in this chapter, in
          <a class="xref" href="svn.serverconfig.pathbasedauthz.html" title="&#22522;&#20110;&#36335;&#24452;&#30340;&#25480;&#26435;">&#8220;&#22522;&#20110;&#36335;&#24452;&#30340;&#25480;&#26435;&#8221;&#19968;&#33410;</a>.  Note
          that the <code class="literal">authz-db</code> variable isn't mutually
          exclusive with the <code class="literal">anon-access</code>
          and <code class="literal">auth-access</code> variables;  if all the
          variables are defined at once, <span class="emphasis"><em>all</em></span>
          of the rules must be satisfied before access is allowed.</p>
        </div>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.svnserve.sasl"></a>&#35753; svnserve &#20351;&#29992; SASL</h3></div></div></div>
        
        <p>For many teams, the built-in CRAM-MD5 authentication is
        all they need from <span class="command"><strong>svnserve</strong></span>.  However, if
        your server (and your Subversion clients) were built with the
        Cyrus Simple Authentication and Security Layer (SASL) library,
        you have a number of authentication and encryption
        options available to you.</p>
        <div class="sidebar"><p class="title"><b>&#20160;&#20040;&#26159; SASL&#65311;</b></p>
          
          <p>The Cyrus Simple Authentication and Security Layer is
          open source software written by Carnegie Mellon University.
          It adds generic authentication and encryption capabilities
          to any network protocol, and as of Subversion 1.5 and later,
          both the <span class="command"><strong>svnserve</strong></span> server
          and <span class="command"><strong>svn</strong></span> client know how to make use of
          this library.  It may or may not be available to you: if
          you're building Subversion yourself, you'll need to have at
          least version 2.1 of SASL installed on your system, and
          you'll need to make sure that it's detected during
          Subversion's build process.  If you're using a prebuilt
          Subversion binary package, you'll have to check with the
          package maintainer as to whether SASL support was compiled
          in.  SASL comes with a number of pluggable modules that
          represent different authentication systems: Kerberos
          (GSSAPI), NTLM, One-Time-Passwords (OTP), DIGEST-MD5, LDAP,
          Secure-Remote-Password (SRP), and others.  Certain
          mechanisms may or may not be available to you; be sure to
          check which modules are provided.</p>
          <p>You can download Cyrus SASL (both code and
          documentation) from
          <code class="uri">http://asg.web.cmu.edu/sasl/sasl-library.html</code>.</p>
        </div>
        <p>Normally, when a subversion client connects to
        <span class="command"><strong>svnserve</strong></span>, the server sends a greeting that
        advertises a list of the capabilities it supports, and the
        client responds with a similar list of capabilities.  If the
        server is configured to require authentication, it then sends
        a challenge that lists the authentication mechanisms
        available; the client responds by choosing one of the
        mechanisms, and then authentication is carried out in some
        number of round-trip messages.  Even when SASL capabilities
        aren't present, the client and server inherently know how to
        use the CRAM-MD5 and ANONYMOUS mechanisms (see
        <a class="xref" href="svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.auth" title="&#20869;&#32622;&#30340;&#35748;&#35777;&#21644;&#25480;&#26435;">&#8220;&#20869;&#32622;&#30340;&#35748;&#35777;&#21644;&#25480;&#26435;&#8221;&#19968;&#33410;</a>).  If server
        and client were linked against SASL, a number of other
        authentication mechanisms may also be available.  However,
        you'll need to explicitly configure SASL on the server side to
        advertise them.</p>
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.sasl.authn"></a>&#20351;&#29992; SASL &#35748;&#35777;</h4></div></div></div>
          
          <p>To activate specific SASL mechanisms on the server,
          you'll need to do two things.  First, create
          a <code class="literal">[sasl]</code> section in your
          repository's <code class="filename">svnserve.conf</code> file with an
          initial key-value pair:</p>
          <pre class="programlisting">
          [sasl]
          use-sasl = true
</pre>
          <p>Second, create a main SASL configuration file
          called <code class="filename">svn.conf</code> in a place where the
          SASL library can find it&#8212;typically in the directory
          where SASL plug-ins are located.  You'll have to locate the
          plug-in directory on your particular system, such
          as <code class="filename">/usr/lib/sasl2/</code>
          or <code class="filename">/etc/sasl2/</code>.  (Note that this
          is <span class="emphasis"><em>not</em></span>
          the <code class="filename">svnserve.conf</code> file that lives
          within a repository!)</p>
          <p>On a Windows server, you'll also have to edit the system
          registry (using a tool such as <span class="command"><strong>regedit</strong></span>)
          to tell SASL where to find things.  Create a registry key
          named <code class="literal">[HKEY_LOCAL_MACHINE\SOFTWARE\Carnegie
          Mellon\Project Cyrus\SASL Library]</code>, and place two
          keys inside it: a key called <code class="literal">SearchPath</code>
          (whose value is a path to the directory containing the SASL
          <code class="filename">sasl*.dll</code> plug-in libraries), and a key
          called
          <code class="literal">ConfFile</code> (whose value is a path to the
          parent directory containing
          the <code class="filename">svn.conf</code> file you created).</p>
          <p>Because SASL provides so many different kinds of
          authentication mechanisms, it would be foolish (and far
          beyond the scope of this book) to try to describe every
          possible server-side configuration.  Instead, we recommend
          that you read the documentation supplied in the
          <code class="filename">doc/</code> subdirectory of the SASL source
          code.  It goes into great detail about every mechanism and
          how to configure the server appropriately for each.  For the
          purposes of this discussion, we'll just demonstrate a simple
          example of configuring the DIGEST-MD5 mechanism.  For
          example, if your <code class="filename">subversion.conf</code>
          (or <code class="filename">svn.conf</code>) file contains the
          following:</p>
          <pre class="screen">
pwcheck_method: auxprop
auxprop_plugin: sasldb
sasldb_path: /etc/my_sasldb
mech_list: DIGEST-MD5
</pre>
          <p>you've told SASL to advertise the DIGEST-MD5
          mechanism to clients and to check user passwords against a
          private password database located
          at <code class="filename">/etc/my_sasldb</code>.  A system
          administrator can then use
          the <span class="command"><strong>saslpasswd2</strong></span> program to add or modify
          usernames and passwords in the database:</p>
          <pre class="screen">
$ saslpasswd2 -c -f /etc/my_sasldb -u realm username
</pre>
          <p>A few words of warning: first, make sure the
          &#8220;<span class="quote">realm</span>&#8221; argument
          to <span class="command"><strong>saslpasswd2</strong></span> matches the same realm
          you've defined in your
          repository's <code class="filename">svnserve.conf</code> file; if
          they don't match, authentication will fail.  Also, due to a
          shortcoming in SASL, the common realm must be a string with
          no space characters.  Finally, if you decide to go with the
          standard SASL password database, make sure
          the <span class="command"><strong>svnserve</strong></span> program has read access to
          the file (and possibly write access as well, if you're using
          a mechanism such as OTP).</p>
          <p>This is just one simple way of configuring SASL.  Many
          other authentication mechanisms are available, and passwords
          can be stored in other places such as in LDAP or a SQL
          database.  Consult the full SASL documentation for
          details.</p>
          <p>Remember that if you configure your server to only allow
          certain SASL authentication mechanisms, this forces all
          connecting clients to have SASL support as well.  Any
          Subversion client built without SASL support (which includes
          all pre-1.5 clients) will be unable to authenticate.  On the
          one hand, this sort of restriction may be exactly what you
          want (&#8220;<span class="quote">My clients must all use Kerberos!</span>&#8221;).
          However, if you still want non-SASL clients to be able to
          authenticate, be sure to advertise the CRAM-MD5 mechanism as
          an option.  All clients are able to use CRAM-MD5, whether
          they have SASL capabilities or not.</p>
        </div>
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.sasl.encryption"></a>SASL &#21152;&#23494;</h4></div></div></div>
          
          <p>SASL is also able to perform data encryption if a
          particular mechanism supports it.  The built-in CRAM-MD5
          mechanism doesn't support encryption, but DIGEST-MD5 does,
          and mechanisms such as SRP actually require use of the
          OpenSSL library.  To enable or disable different levels of
          encryption, you can set two values in your repository's
          <code class="filename">svnserve.conf</code> file:</p>
          <pre class="screen">
[sasl]
use-sasl = true
min-encryption = 128
max-encryption = 256
</pre>
          <p>The <code class="literal">min-encryption</code> and
          <code class="literal">max-encryption</code> variables control the
          level of encryption demanded by the server.  To disable
          encryption completely, set both values to 0.  To enable
          simple checksumming of data (i.e., prevent tampering and
          guarantee data integrity without encryption), set both
          values to 1.  If you wish to allow&#8212;but not
          require&#8212;encryption, set the minimum value to 0, and
          the maximum value to some bit length.  To require encryption
          unconditionally, set both values to numbers greater than 1.
          In our previous example, we require clients to do at least
          128-bit encryption, but no more than 256-bit
          encryption.</p>
        </div>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.svnserve.sshauth"></a>&#31359;&#36234; SSH &#38567;&#36947;</h3></div></div></div>
        
        <p><span class="command"><strong>svnserve</strong></span>&#30340;&#20869;&#32622;&#35748;&#35777;(&#21644;SASL&#25903;&#25345;)&#21487;&#20197;&#38750;&#24120;&#23481;&#26131;&#24471;&#21040;&#65292;&#22240;&#20026;&#23427;&#36991;&#20813;&#20102;&#21019;&#24314;&#30495;&#23454;&#30340;&#31995;&#32479;&#24080;&#21495;&#65292;&#21478;&#19968;&#26041;&#38754;&#65292;&#19968;&#20123;&#31649;&#29702;&#21592;&#24050;&#32463;&#21019;&#24314;&#22909;&#20102;SSH&#35748;&#35777;&#26694;&#26550;&#65292;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#25152;&#26377;&#30340;&#39033;&#30446;&#29992;&#25143;&#24050;&#32463;&#25317;&#26377;&#20102;&#31995;&#32479;&#24080;&#21495;&#21644;&#26377;&#33021;&#21147;&#8220;<span class="quote">SSH&#21040;</span>&#8221;&#26381;&#21153;&#22120;&#12290;</p>
        <p>SSH&#19982;<span class="command"><strong>svnserve</strong></span>&#32467;&#21512;&#24456;&#31616;&#21333;&#65292;&#23458;&#25143;&#31471;&#21482;&#38656;&#35201;&#20351;&#29992;<code class="literal">svn+ssh://</code>&#30340;URL&#27169;&#24335;&#26469;&#36830;&#25509;&#65306;</p>
        <pre class="screen">
$ whoami
harry

$ svn list svn+ssh://host.example.com/repos/project
harryssh@host.example.com's password:  *****

foo
bar
baz
&#8230;
</pre>
        <p>In this example, the Subversion client is invoking a local
        <span class="command"><strong>ssh</strong></span> process, connecting to
        <code class="literal">host.example.com</code>, authenticating as the
        user <code class="literal">harryssh</code> (according to SSH user
        configuration), then spawning a private
        <span class="command"><strong>svnserve</strong></span> process on the remote machine
        running as the user <code class="literal">harryssh</code>.  The
        <span class="command"><strong>svnserve</strong></span> command is being invoked in tunnel
        mode (<code class="option">-t</code>), and its network protocol is being
        &#8220;<span class="quote">tunneled</span>&#8221; over the encrypted connection by
        <span class="command"><strong>ssh</strong></span>, the tunnel agent.
        If the client performs a commit, the authenticated username
        <code class="literal">harryssh</code> will be used as the author
        of the new revision.</p>
        <p>&#36825;&#37324;&#35201;&#29702;&#35299;&#30340;&#26368;&#37325;&#35201;&#30340;&#20107;&#24773;&#26159;Subversion&#23458;&#25143;&#31471;<span class="emphasis"><em>&#19981;</em></span>&#26159;&#36830;&#25509;&#21040;&#36816;&#34892;&#20013;&#30340;<span class="command"><strong>svnserve</strong></span>&#23432;&#25252;&#36827;&#31243;&#65292;&#36825;&#31181;&#35775;&#38382;&#26041;&#27861;&#19981;&#38656;&#35201;&#19968;&#20010;&#36816;&#34892;&#30340;&#23432;&#25252;&#36827;&#31243;&#65292;&#20063;&#19981;&#38656;&#35201;&#22312;&#24517;&#35201;&#26102;&#21796;&#37266;&#19968;&#20010;&#65292;&#23427;&#20381;&#36182;&#20110;<span class="command"><strong>ssh</strong></span>&#26469;&#21457;&#36215;&#19968;&#20010;<span class="command"><strong>svnserve</strong></span>&#36827;&#31243;&#65292;&#28982;&#21518;&#32593;&#32476;&#26029;&#24320;&#21518;&#32456;&#27490;&#36827;&#31243;&#12290;</p>
        <p>&#24403;&#20351;&#29992;<code class="literal">svn+ssh://</code>&#30340;URL&#35775;&#38382;&#29256;&#26412;&#24211;&#26102;&#65292;&#35760;&#20303;&#26159;<span class="command"><strong>ssh</strong></span>&#25552;&#31034;&#35831;&#27714;&#35748;&#35777;&#65292;&#32780;<span class="emphasis"><em>&#19981;</em></span>&#26159;<span class="command"><strong>svn</strong></span>&#23458;&#25143;&#31471;&#31243;&#24207;&#12290;&#36825;&#24847;&#21619;&#30528;&#23494;&#30721;&#19981;&#20250;&#26377;&#33258;&#21160;&#32531;&#23384;(&#35265;<a class="xref" href="svn.serverconfig.netmodel.html#svn.serverconfig.netmodel.credcache" title="&#23458;&#25143;&#31471;&#20973;&#35777;&#32531;&#23384;">&#8220;&#23458;&#25143;&#31471;&#20973;&#35777;&#32531;&#23384;&#8221;&#19968;&#33410;</a>)&#65292;Subversion&#23458;&#25143;&#31471;&#36890;&#24120;&#20250;&#24314;&#31435;&#22810;&#20010;&#29256;&#26412;&#24211;&#30340;&#36830;&#25509;&#65292;&#20294;&#29992;&#25143;&#36890;&#24120;&#20250;&#22240;&#20026;&#23494;&#30721;&#32531;&#23384;&#29305;&#24615;&#32780;&#27809;&#26377;&#27880;&#24847;&#21040;&#36825;&#19968;&#28857;&#65292;&#24403;&#20351;&#29992;<code class="literal">svn+ssh://</code>&#30340;URL&#26102;&#65292;&#29992;&#25143;&#20250;&#20026;<span class="command"><strong>ssh</strong></span>&#22312;&#27599;&#27425;&#24314;&#31435;&#36830;&#25509;&#26102;&#37325;&#22797;&#30340;&#35810;&#38382;&#23494;&#30721;&#24863;&#21040;&#35752;&#21388;&#65292;&#35299;&#20915;&#26041;&#26696;&#26159;&#29992;&#19968;&#20010;&#29420;&#31435;&#30340;SSH&#23494;&#30721;&#32531;&#23384;&#24037;&#20855;&#65292;&#20687;&#31867;Unix&#31995;&#32479;&#30340;<span class="command"><strong>ssh-agent</strong></span>&#25110;&#32773;&#26159;Windows&#19979;&#30340;<span class="command"><strong>pageant</strong></span>&#12290;</p>
        <p>When running over a tunnel, authorization is primarily
        controlled by operating system permissions to the repository's
        database files; it's very much the same as if Harry were
        accessing the repository directly via a
        <code class="literal">file://</code> URL.  If multiple system users are
        going to be accessing the repository directly, you may want to
        place them into a common group, and you'll need to be careful
        about umasks (be sure to read <a class="xref" href="svn.serverconfig.multimethod.html" title="&#25903;&#25345;&#22810;&#31181;&#29256;&#26412;&#24211;&#35775;&#38382;&#26041;&#27861;">&#8220;&#25903;&#25345;&#22810;&#31181;&#29256;&#26412;&#24211;&#35775;&#38382;&#26041;&#27861;&#8221;&#19968;&#33410;</a> later in this
        chapter).  But even in the case of tunneling, you can still use the
        <code class="filename">svnserve.conf</code> file to block access, by
        simply setting <code class="literal">auth-access = read</code>
        or <code class="literal">auth-access = none</code>.
        <sup>[<a name="d4e5770" href="#ftn.d4e5770" class="footnote">41</a>]</sup>
      </p>
        <p>&#20320;&#20250;&#35748;&#20026;SSH&#31649;&#36947;&#30340;&#25925;&#20107;&#35813;&#32467;&#26463;&#20102;&#65292;&#20294;&#36824;&#19981;&#26159;&#65292;Subversion&#20801;&#35768;&#20320;&#22312;&#36816;&#34892;&#37197;&#32622;&#25991;&#20214;<code class="filename">config</code>(&#35265;<a class="xref" href="svn.customization.html#svn.advanced.confarea" title="&#36816;&#34892;&#37197;&#32622;&#21306;">&#8220;&#36816;&#34892;&#37197;&#32622;&#21306;&#8221;&#19968;&#33410;</a>)&#21019;&#24314;&#19968;&#20010;&#33258;&#23450;&#20041;&#30340;&#31649;&#36947;&#34892;&#20026;&#26041;&#24335;&#65292;&#20030;&#20010;&#20363;&#23376;&#65292;&#20551;&#23450;&#20320;&#24076;&#26395;&#20351;&#29992;RSH&#32780;&#19981;&#26159;SSH&#65292;&#22312;<code class="filename">config</code>&#25991;&#20214;&#30340;<code class="literal">[tunnels]</code>&#37096;&#20998;&#20316;&#22914;&#19979;&#23450;&#20041;&#65306;</p>
        <pre class="screen">
[tunnels]
rsh = rsh
</pre>
        <p>And now, you can use this new tunnel definition by using a
        URL scheme that matches the name of your new variable:
        <code class="literal">svn+rsh://host/path</code>.  When using the new
        URL scheme, the Subversion client will actually be running the
        command <strong class="userinput"><code>rsh host svnserve -t</code></strong> behind the
        scenes.  If you include a username in the URL (e.g.,
        <code class="literal">svn+rsh://username@host/path</code>), the client
        will also include that in its command (<strong class="userinput"><code>rsh
        username@host svnserve -t</code></strong>).  But you can define new
        tunneling schemes to be much more clever than that:</p>
        <pre class="screen">
[tunnels]
joessh = $JOESSH /opt/alternate/ssh -p 29934
</pre>
        <p>This example demonstrates a couple of things.  First, it
        shows how to make the Subversion client launch a very specific
        tunneling binary (the one located at
        <code class="filename">/opt/alternate/ssh</code>) with specific
        options.  In this case, accessing an
        <code class="literal">svn+joessh://</code> URL would invoke the
        particular SSH binary with <code class="option">-p 29934</code> as
        arguments&#8212;useful if you want the tunnel program to
        connect to a nonstandard port.</p>
        <p>Second, it shows how to define a custom environment
        variable that can override the name of the tunneling program.
        Setting the <code class="literal">SVN_SSH</code> environment variable is
        a convenient way to override the default SSH tunnel agent.
        But if you need to have several different overrides for
        different servers, each perhaps contacting a different port or
        passing a different set of options to SSH, you can use the
        mechanism demonstrated in this example.  Now if we were to set
        the <code class="literal">JOESSH</code> environment variable, its value
        would override the entire value of the tunnel
        variable&#8212;<span class="command"><strong>$JOESSH</strong></span> would be executed
        instead of <strong class="userinput"><code>/opt/alternate/ssh -p
        29934</code></strong>.</p>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.serverconfig.svnserve.sshtricks"></a>SSH &#37197;&#32622;&#25216;&#24039;</h3></div></div></div>
        
        <p>It's possible to control not only the way in which the
        client invokes <span class="command"><strong>ssh</strong></span>, but also to control
        the behavior of <span class="command"><strong>sshd</strong></span> on your server
        machine.  In this section, we'll show how to control the
        exact <span class="command"><strong>svnserve</strong></span> command executed
        by <span class="command"><strong>sshd</strong></span>, as well as how to have multiple
        users share a single system account.</p>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.sshtricks.setup"></a>&#21021;&#22987;&#35774;&#32622;</h4></div></div></div>
          
          <p>&#20316;&#20026;&#24320;&#22987;&#65292;&#23450;&#20301;&#21040;&#20320;&#21551;&#21160;<span class="command"><strong>svnserve</strong></span>&#30340;&#24080;&#21495;&#30340;&#20027;&#30446;&#24405;&#65292;&#30830;&#23450;&#36825;&#20010;&#36134;&#25143;&#24050;&#32463;&#23433;&#35013;&#20102;&#19968;&#22871;SSH&#20844;&#24320;/&#31169;&#26377;&#23494;&#38053;&#23545;&#65292;&#29992;&#25143;&#21487;&#20197;&#36890;&#36807;&#20844;&#24320;&#23494;&#38053;&#35748;&#35777;&#65292;&#22240;&#20026;&#25152;&#26377;&#22914;&#19979;&#30340;&#25216;&#24039;&#22260;&#32469;&#30528;&#20351;&#29992;SSH<code class="filename">authorized_keys</code>&#25991;&#20214;&#65292;&#23494;&#30721;&#35748;&#35777;&#22312;&#36825;&#37324;&#19981;&#20250;&#24037;&#20316;&#12290;</p>
          <p>&#22914;&#26524;&#36825;&#20010;&#25991;&#20214;&#36824;&#19981;&#23384;&#22312;&#65292;&#21019;&#24314;&#19968;&#20010;<code class="filename">authorized_keys</code>&#25991;&#20214;(&#22312;UNIX&#19979;&#36890;&#24120;&#26159;<code class="filename">~/.ssh/authorized_keys</code>)&#65292;&#36825;&#20010;&#25991;&#20214;&#30340;&#27599;&#19968;&#34892;&#25551;&#36848;&#20102;&#19968;&#20010;&#20801;&#35768;&#36830;&#25509;&#30340;&#20844;&#38053;&#65292;&#36825;&#20123;&#34892;&#36890;&#24120;&#26159;&#19979;&#38754;&#30340;&#24418;&#24335;&#65306;</p>
          <pre class="screen">
  ssh-dsa AAAABtce9euch.... user@example.com
</pre>
          <p>&#31532;&#19968;&#20010;&#23383;&#27573;&#25551;&#36848;&#20102;&#23494;&#38053;&#30340;&#31867;&#22411;&#65292;&#31532;&#20108;&#20010;&#23383;&#27573;&#26159;&#26410;&#21152;&#23494;&#30340;&#23494;&#38053;&#26412;&#36523;&#65292;&#31532;&#19977;&#20010;&#23383;&#27573;&#26159;&#27880;&#37322;&#12290;&#28982;&#32780;&#65292;&#36825;&#26159;&#19968;&#20010;&#24456;&#23569;&#20154;&#30693;&#36947;&#30340;&#20107;&#23454;&#65292;&#21487;&#20197;&#20351;&#29992;&#19968;&#20010;<code class="literal">command</code>&#26469;&#22788;&#29702;&#25972;&#34892;&#65306;</p>
          <pre class="screen">
  command="program" ssh-dsa AAAABtce9euch.... user@example.com
</pre>
          <p>When the <code class="literal">command</code> field is set, the
          SSH daemon will run the named program instead of the
          typical tunnel-mode <span class="command"><strong>svnserve</strong></span> invocation that the
          Subversion client asks for.  This opens the door to a number
          of server-side tricks.  In the following examples, we
          abbreviate the lines of the file as:</p>
          <pre class="screen">
  command="program" TYPE KEY COMMENT
</pre>
        </div>
        
        <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h4 class="title"><a name="svn.serverconfig.svnserve.sshtricks.fixedcmd"></a>&#25511;&#21046;&#35843;&#29992;&#30340;&#21629;&#20196;</h4></div></div></div>
          
          <p>&#22240;&#20026;&#25105;&#20204;&#21487;&#20197;&#25351;&#23450;&#26381;&#21153;&#22120;&#31471;&#25191;&#34892;&#30340;&#21629;&#20196;&#65292;&#25105;&#20204;&#24456;&#23481;&#26131;&#26469;&#36873;&#25321;&#36816;&#34892;&#19968;&#20010;&#29305;&#23450;&#30340;<span class="command"><strong>svnserve</strong></span>&#31243;&#24207;&#26469;&#24182;&#19988;&#20256;&#36882;&#32473;&#23427;&#39069;&#22806;&#30340;&#21442;&#25968;&#65306;</p>
          <pre class="screen">
  command="/path/to/svnserve -t -r /virtual/root" TYPE KEY COMMENT
</pre>
          <p>&#22312;&#36825;&#20010;&#20363;&#23376;&#37324;&#65292;<code class="filename">/path/to/svnserve</code>&#20063;&#35768;&#20250;&#26159;&#19968;&#20010;<span class="command"><strong>svnserve</strong></span>&#31243;&#24207;&#30340;&#21253;&#35065;&#33050;&#26412;&#65292;&#20250;&#26469;&#35774;&#32622;umask(&#35265;<a class="xref" href="svn.serverconfig.multimethod.html" title="&#25903;&#25345;&#22810;&#31181;&#29256;&#26412;&#24211;&#35775;&#38382;&#26041;&#27861;">&#8220;&#25903;&#25345;&#22810;&#31181;&#29256;&#26412;&#24211;&#35775;&#38382;&#26041;&#27861;&#8221;&#19968;&#33410;</a>)&#12290;&#23427;&#20063;&#23637;&#31034;&#20102;&#24590;&#26679;&#22312;&#34394;&#25311;&#26681;&#30446;&#24405;&#23450;&#20301;&#19968;&#20010;<span class="command"><strong>svnserve</strong></span>&#65292;&#23601;&#20687;&#25105;&#20204;&#32463;&#24120;&#22312;&#20351;&#29992;&#23432;&#25252;&#36827;&#31243;&#27169;&#24335;&#19979;&#36816;&#34892;<span class="command"><strong>svnserve</strong></span>&#19968;&#26679;&#12290;&#36825;&#26679;&#20570;&#19981;&#20165;&#21487;&#20197;&#25226;&#35775;&#38382;&#38480;&#21046;&#22312;&#31995;&#32479;&#30340;&#19968;&#37096;&#20998;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;&#25143;&#19981;&#38656;&#35201;&#22312;<code class="literal">svn+ssh://</code>URL&#37324;&#36755;&#20837;&#32477;&#23545;&#36335;&#24452;&#12290;</p>
          <p>It's also possible to have multiple users share a single
          account.  Instead of creating a separate system account for
          each user, generate a public/private key pair for each
          person.  Then place each public key into
          the <code class="filename">authorized_users</code> file, one per
          line, and use the <code class="option">--tunnel-user</code>
          option:</p>
          <pre class="screen">
  command="svnserve -t --tunnel-user=harry" TYPE1 KEY1 harry@example.com
  command="svnserve -t --tunnel-user=sally" TYPE2 KEY2 sally@example.com
</pre>
          <p>This example allows both Harry and Sally to connect to
          the same account via public key authentication.  Each of
          them has a custom command that will be executed;
          the <code class="option">--tunnel-user</code> option 
          tells <span class="command"><strong>svnserve</strong></span> to assume that the named
          argument is the authenticated user.  Without
          <code class="option">--tunnel-user</code>, it would appear as though
          all commits were coming from the one shared system
          account.</p>
          <p>A final word of caution: giving a user access to the
          server via public-key in a shared account might still allow
          other forms of SSH access, even if you've set
          the <code class="literal">command</code> value
          in <code class="filename">authorized_keys</code>.  For example, the
          user may still get shell access through SSH or be able to
          perform X11 or general port forwarding through your server.
          To give the user as little permission as possible, you may
          want to specify a number of restrictive options immediately
          after the <code class="literal">command</code>:</p>
          <pre class="screen">
  command="svnserve -t --tunnel-user=harry",no-port-forwarding,no-agent-forw
arding,no-X11-forwarding,no-pty TYPE1 KEY1 harry@example.com
</pre>
          <p>Note that this all must be on one line&#8212;truly on
          one line&#8212;since SSH <code class="filename">authorized_keys</code> 
          files do not even allow the conventional backslash character
          (<code class="literal">\</code>) for line continuation.  The only
          reason we've shown it with a line break is to fit it on
          the physical page of a book.</p>
        </div>
      </div>
    <div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d4e5599" href="#d4e5599" class="para">40</a>] </sup>&#35265;RFC 2195&#12290;</p></div><div class="footnote"><p><sup>[<a name="ftn.d4e5770" href="#d4e5770" class="para">41</a>] </sup>&#35831;&#27880;&#24847;&#65292;&#20351;&#29992;<span class="command"><strong>svnserve</strong></span>&#30340;&#35775;&#38382;&#25511;&#21046;&#36827;&#34892;&#26435;&#38480;&#25511;&#21046;&#23558;&#20250;&#22833;&#21435;&#24847;&#20041;&#65292;&#22240;&#20026;&#29992;&#25143;&#24050;&#32463;&#30452;&#25509;&#35775;&#38382;&#21040;&#20102;&#29256;&#26412;&#24211;&#25968;&#25454;&#12290;</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="svn.serverconfig.choosing.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="svn.serverconfig.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="svn.serverconfig.httpd.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#36873;&#25321;&#19968;&#20010;&#26381;&#21153;&#22120;&#37197;&#32622;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;httpd - Apache &#30340; HTTP &#26381;&#21153;&#22120;</td></tr></table></div></body></html>