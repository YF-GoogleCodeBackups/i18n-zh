<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#38145;&#23450;</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_8167"><link rel="home" href="index.html" title="Subversion &#26435;&#23041;&#25351;&#21335;"><link rel="up" href="svn.advanced.html" title="&#31532;&nbsp;3&nbsp;&#31456;&nbsp;&#39640;&#32423;&#20027;&#39064;"><link rel="prev" href="svn.advanced.sparsedirs.html" title="&#31232;&#30095;&#30446;&#24405;"><link rel="next" href="svn.advanced.externals.html" title="&#22806;&#37096;&#23450;&#20041;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#38145;&#23450;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="svn.advanced.sparsedirs.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&#31532;&nbsp;3&nbsp;&#31456;&nbsp;&#39640;&#32423;&#20027;&#39064;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="svn.advanced.externals.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="section" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="svn.advanced.locking"></a>&#38145;&#23450;</h2></div></div></div>
      
      <p>Subversion's copy-modify-merge version control model lives
      and dies on its data merging algorithms&#8212;specifically on
      how well those algorithms perform when trying to resolve
      conflicts caused by multiple users modifying the same file
      concurrently.  Subversion itself provides only one such
      algorithm:  a three-way differencing algorithm that is smart
      enough to handle data at a granularity of a single line of text.
      Subversion also allows you to supplement its content merge
      processing with external differencing utilities (as described in
      <a class="xref" href="svn.advanced.externaldifftools.html#svn.advanced.externaldifftools.diff3" title="&#22806;&#32622; diff3">&#8220;&#22806;&#32622; diff3&#8221;&#19968;&#33410;</a>), some
      of which may do an even better job, perhaps providing
      granularity of a word or a single character of text.  But common
      among those algorithms is that they generally work only on text
      files.  The landscape starts to look pretty grim when you start
      talking about content merges of nontextual file formats.  And
      when you can't find a tool that can handle that type of merging,
      you begin to run into problems with the copy-modify-merge
      model.</p>
      <p>Let's look at a real-life example of where this model runs
      aground.  Harry and Sally are both graphic designers working on
      the same project, a bit of marketing collateral for an
      automobile mechanic.  Central to the design of a particular
      poster is an image of a car in need of some bodywork, stored in
      a file using the PNG image format.  The poster's layout is
      almost finished, and both Harry and Sally are pleased with the
      particular photo they chose for their damaged car&#8212;a baby
      blue 1967 Ford Mustang with an unfortunate bit of crumpling on
      the left front fender.</p>
      <p>Now, as is common in graphic design work, there's a change
      in plans, which causes the car's color to be a concern.  So Sally
      updates her working copy to <code class="literal">HEAD</code>, fires up
      her photo-editing software, and sets about tweaking the image so
      that the car is now cherry red.  Meanwhile, Harry, feeling
      particularly inspired that day, decides that the image would
      have greater impact if the car also appears to have suffered
      greater impact.  He, too, updates to <code class="literal">HEAD</code>,
      and then draws some cracks on the vehicle's windshield.  He
      manages to finish his work before Sally finishes hers, and after
      admiring the fruits of his undeniable talent, he commits the
      modified image.  Shortly thereafter, Sally is finished with the
      car's new finish and tries to commit her changes.  But, as
      expected, Subversion fails the commit, informing Sally that
      her version of the image is now out of date.</p>
      <p>&#36825;&#37324;&#23601;&#26159;&#40635;&#28902;&#30340;&#22320;&#26041;&#65292;&#22914;&#26524;Harry&#21644;Sally&#20462;&#25913;&#30340;&#26159;&#25991;&#26412;&#25991;&#20214;&#65292;&#22905;&#21482;&#38656;&#35201;&#31616;&#21333;&#24471;&#26356;&#26032;&#24037;&#20316;&#25335;&#36125;&#65292;&#25509;&#25910;Harry&#30340;&#20462;&#25913;&#12290;&#22312;&#26368;&#22351;&#30340;&#24773;&#20917;&#19979;&#65292;&#20182;&#20204;&#20250;&#20462;&#25913;&#25991;&#20214;&#30340;&#21516;&#19968;&#37096;&#20998;&#65292;Sally&#38656;&#35201;&#20154;&#24037;&#35299;&#20915;&#20914;&#31361;&#12290;&#20294;&#26159;&#29616;&#22312;&#19981;&#26159;&#25991;&#26412;&#25991;&#20214;&#8212;&#32780;&#26159;&#20108;&#36827;&#21046;&#22270;&#20687;&#65292;&#27809;&#27861;&#20272;&#35745;&#21512;&#24182;&#30340;&#32467;&#26524;&#20250;&#26159;&#20160;&#20040;&#26679;&#23376;&#30340;&#65292;&#24050;&#23384;&#30340;&#36719;&#20214;&#19981;&#21487;&#33021;&#20174;&#22522;&#32447;&#22270;&#20687;&#20998;&#31163;&#20986;Harry&#21644;Sally&#30340;&#24037;&#20316;&#65292;&#24182;&#32452;&#21512;&#20986;&#19968;&#20010;&#25377;&#39118;&#29627;&#29827;&#22351;&#25481;&#30340;&#32418;&#33394;Mustang&#12290;</p>
      <p>&#24456;&#26174;&#28982;&#65292;&#22914;&#26524;&#33021;&#22815;&#23558;Harry&#21644;Sally&#30340;&#24037;&#20316;&#20018;&#34892;&#35805;&#20107;&#24773;&#20250;&#21464;&#24471;&#24179;&#28369;&#65292;&#20063;&#23601;&#26159;&#35828;Harry&#21487;&#20197;&#31561;&#21040;Sally&#30340;&#32418;&#36710;&#28982;&#21518;&#20877;&#30011;&#19978;&#30772;&#22351;&#30340;&#25377;&#39118;&#29627;&#29827;&#65292;&#25110;&#32773;Sally&#22312;&#30772;&#22351;&#20043;&#21518;&#25913;&#21464;&#39068;&#33394;&#12290;&#23601;&#20687;&#22312;<a class="xref" href="svn.basic.vsn-models.html#svn.basic.vsn-models.copy-merge" title="&#8220;&#25335;&#36125;-&#20462;&#25913;-&#21512;&#24182;&#8221;&#26041;&#26696;">&#8220;&#8220;&#25335;&#36125;-&#20462;&#25913;-&#21512;&#24182;&#8221;&#26041;&#26696;&#8221;&#19968;&#33410;</a>&#35752;&#35770;&#30340;&#65292;&#22914;&#26524;Harry&#21644;Sally&#20043;&#38388;&#26377;&#23436;&#32654;&#30340;&#20132;&#27969;&#65292;&#23601;&#19981;&#20250;&#26377;&#36825;&#31181;&#38382;&#39064;&#21457;&#29983;&#12290;<sup>[<a name="d4e2472" href="#ftn.d4e2472" class="footnote">13</a>]</sup>&#20294;&#26159;&#20316;&#20026;&#19968;&#31181;&#29256;&#26412;&#25511;&#21046;&#31995;&#32479;&#65292;&#23454;&#38469;&#19978;&#26159;&#19968;&#31181;&#20132;&#27969;&#30340;&#24418;&#24335;&#65292;&#20351;&#24471;&#36719;&#20214;&#36981;&#24490;&#38750;&#24182;&#34892;&#32534;&#36753;&#30340;&#20018;&#34892;&#21270;&#20063;&#19981;&#26159;&#19968;&#20214;&#22351;&#20107;&#65292;&#36825;&#37324;Subversion&#23454;&#29616;&#20102;&#38145;&#23450;-&#20462;&#25913;-&#35299;&#38145;&#27169;&#22411;&#65292;&#36825;&#37324;&#25105;&#20204;&#35201;&#35752;&#35770;Subversion&#30340;<em class="firstterm">&#38145;&#23450;</em>&#29305;&#24615;&#65292;&#19982;&#20854;&#20182;&#29256;&#26412;&#25511;&#21046;&#31995;&#32479;&#30340;&#8220;<span class="quote">&#20445;&#30041;&#26816;&#20986;</span>&#8221;&#26426;&#21046;&#31867;&#20284;&#12290;</p>
      <p>Subversion's locking feature exists ultimately to minimize
      wasted time and effort.  By allowing a user to programmatically
      claim the exclusive right to change a file in the repository,
      that user can be reasonably confident that any energy he invests
      on unmergeable changes won't be wasted&#8212;his commit of those
      changes will succeed.  Also, because Subversion communicates to
      other users that serialization is in effect for a particular
      versioned object, those users can reasonably expect that the
      object is about to be changed by someone else.  They, too, can
      then avoid wasting their time and energy on unmergeable changes
      that won't be committable due to eventual
      out-of-dateness.</p>
      <p>&#24403;&#25105;&#20204;&#24341;&#29992;Subversion&#38145;&#23450;&#29305;&#24615;&#26102;&#65292;&#36825;&#26159;&#22312;&#35752;&#35770;&#19968;&#20010;&#22788;&#29702;&#29256;&#26412;&#21270;&#25991;&#20214;&#30340;&#34892;&#20026;&#29305;&#24615;<sup>[<a name="d4e2478" href="#ftn.d4e2478" class="footnote">14</a>]</sup>(&#22768;&#26126;&#23545;&#19968;&#20010;&#25991;&#20214;&#25490;&#20182;&#24615;&#20462;&#25913;&#29305;&#26435;)&#65292;&#21253;&#25324;&#23545;&#25991;&#20214;&#30340;&#38145;&#23450;&#21644;&#35299;&#38145;(&#37322;&#25918;&#25490;&#20182;&#24615;&#20462;&#25913;&#26435;&#38480;)&#65292;&#23519;&#30475;&#21253;&#25324;&#25991;&#20214;&#34987;&#35841;&#38145;&#23450;&#30340;&#25253;&#21578;&#65292;&#20197;&#21450;&#25552;&#37266;&#20225;&#22270;&#20462;&#25913;&#38145;&#23450;&#25991;&#20214;&#30340;&#29992;&#25143;&#12290;&#22312;&#26412;&#23567;&#33410;&#65292;&#25105;&#20204;&#20250;&#35206;&#30422;&#38145;&#23450;&#29305;&#24615;&#30340;&#22823;&#37096;&#20998;&#20869;&#23481;&#12290;</p>
      <div class="sidebar"><a name="svn.advanced.locking.meanings"></a><p class="title"><b>&#8220;<span class="quote">&#38145;&#23450;</span>&#8221;&#30340;&#19977;&#31181;&#21547;&#20041;</b></p>
        
        <p>&#22312;&#26412;&#23567;&#33410;&#65292;&#21644;&#20960;&#20046;&#26412;&#20070;&#30340;&#27599;&#19968;&#20010;&#22320;&#26041;&#8220;<span class="quote">lock</span>&#8221;&#21644;&#8220;<span class="quote">locking</span>&#8221;&#25551;&#36848;&#20102;&#19968;&#31181;&#36991;&#20813;&#29992;&#25143;&#20043;&#38388;&#20914;&#31361;&#25552;&#20132;&#30340;&#25490;&#20182;&#26426;&#21046;&#65292;&#20294;&#26159;&#20343;&#19981;&#24184;&#65292;Subversion&#20013;&#36824;&#26377;&#21478;&#22806;&#20004;&#31181;&#38145;&#65292;&#22240;&#27492;&#38656;&#35201;&#22312;&#26412;&#20070;&#26684;&#22806;&#20851;&#24515;&#12290;</p>
        <p>The second is <em class="firstterm">working copy locks</em>,
        used internally by Subversion to prevent clashes between
        multiple Subversion clients operating on the same working
        copy.  This is the sort of lock indicated by an
        <code class="computeroutput">L</code> in the third column of
        <span class="command"><strong>svn status</strong></span> output, and removed by the
        <span class="command"><strong>svn cleanup</strong></span> command, as described in <a class="xref" href="svn.tour.cleanup.html" title="&#26377;&#26102;&#20320;&#21482;&#38656;&#35201;&#28165;&#29702;">&#8220;&#26377;&#26102;&#20320;&#21482;&#38656;&#35201;&#28165;&#29702;&#8221;&#19968;&#33410;</a>.</p>
        <p>Third, there are <em class="firstterm">database locks</em>,
        used internally by the Berkeley DB backend to prevent clashes
        between multiple programs trying to access the database.  This
        is the sort of lock whose unwanted persistence after an error
        can cause a repository to be &#8220;<span class="quote">wedged,</span>&#8221; as
        described in <a class="xref" href="svn.reposadmin.maint.html#svn.reposadmin.maint.recovery" title="Berkeley DB &#24674;&#22797;">&#8220;Berkeley DB &#24674;&#22797;&#8221;&#19968;&#33410;</a>.</p>
        <p>&#22312;&#21457;&#29983;&#38382;&#39064;&#20043;&#21069;&#20320;&#23436;&#20840;&#21487;&#20197;&#24536;&#35760;&#19978;&#38754;&#20004;&#31181;&#38145;&#65292;&#22312;&#26412;&#20070;&#65292;&#8220;<span class="quote">&#38145;&#23450;</span>&#8221;&#24847;&#21619;&#30528;&#31532;&#19968;&#31181;&#38145;&#65292;&#38500;&#38750;&#26159;&#22312;&#20174;&#19978;&#19979;&#25991;&#20013;&#21313;&#20998;&#26126;&#30830;&#25110;&#26126;&#30830;&#25351;&#20986;&#30340;&#12290;</p>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.advanced.locking.creation"></a>&#21019;&#24314;&#38145;&#23450;</h3></div></div></div>
        
        <p>In the Subversion repository, a
        <em class="firstterm">lock</em> is a piece of metadata that
        grants exclusive access to one user to change a file.  This
        user is said to be the <em class="firstterm">lock owner</em>.
        Each lock also has a unique identifier, typically a long
        string of characters, known as the <em class="firstterm">lock
        token</em>.  The repository manages locks, ultimately
        handling their creation, enforcement, and removal.  If any
        commit transaction attempts to modify or delete a locked file
        (or delete one of the parent directories of the file), the
        repository will demand two pieces of information&#8212;that
        the client performing the commit be authenticated as the lock
        owner, and that the lock token has been provided as part of
        the commit process as a form of proof that the client knows which
        lock it is using.</p>
        <p>&#20026;&#20102;&#25551;&#36848;&#38145;&#30340;&#20135;&#29983;&#65292;&#25105;&#20204;&#22238;&#21040;&#21069;&#38754;&#37027;&#20010;&#20851;&#20110;&#22810;&#20010;&#22270;&#24418;&#35774;&#35745;&#24072;&#20849;&#21516;&#24037;&#20316;&#30340;&#20363;&#23376;&#65292;Harry&#20915;&#23450;&#20462;&#25913;&#19968;&#20010;JPEG&#22270;&#20687;&#65292;&#20026;&#20102;&#38450;&#27490;&#20854;&#20182;&#29992;&#25143;&#27492;&#26102;&#25552;&#20132;&#36825;&#20010;&#25991;&#20214;&#30340;&#20462;&#25913;(&#20063;&#26159;&#35686;&#21578;&#21035;&#20154;&#20182;&#27491;&#22312;&#20462;&#25913;&#23427;)&#65292;&#20182;&#20351;&#29992;<span class="command"><strong>svn lock</strong></span>&#21629;&#20196;&#38145;&#23450;&#20102;&#29256;&#26412;&#24211;&#20013;&#30340;&#36825;&#20010;&#25991;&#20214;&#65306;</p>
        <pre class="screen">
$ svn lock banana.jpg -m "Editing file for tomorrow's release."
'banana.jpg' locked by user 'harry'.
$
</pre>
        <p>The preceding example demonstrates a number of new things.
        First, notice that Harry passed the
        <code class="option">--message</code> (<code class="option">-m</code>) option to
        <span class="command"><strong>svn lock</strong></span>.  Similar to <span class="command"><strong>svn
        commit</strong></span>, the <span class="command"><strong>svn lock</strong></span> command can
        take comments&#8212;via either <code class="option">--message</code>
        (<code class="option">-m</code>) or <code class="option">--file</code>
        (<code class="option">-F</code>)&#8212;to describe the reason for locking the
        file.  Unlike <span class="command"><strong>svn commit</strong></span>, however,
        <span class="command"><strong>svn lock</strong></span> will not demand a message by
        launching your preferred text editor.  Lock comments are
        optional, but still recommended to aid communication.</p>
        <p>Second, the lock attempt succeeded.  This means that the
        file wasn't already locked, and that Harry had the latest
        version of the file.  If Harry's working copy of the file had
        been out of date, the repository would have rejected the
        request, forcing Harry to <span class="command"><strong>svn update</strong></span> and
        reattempt the locking command.  The locking command would also
        have failed if the file had already been locked by someone
        else.</p>
        <p>&#23601;&#20687;&#20320;&#30475;&#21040;&#30340;&#65292;<span class="command"><strong>svn lock</strong></span>&#25171;&#21360;&#20102;&#38145;&#23450;&#25104;&#21151;&#30340;&#30830;&#35748;&#20449;&#24687;&#12290;&#27492;&#26102;&#65292;&#36890;&#36807;<span class="command"><strong>svn status</strong></span>&#21644;<span class="command"><strong>svn info</strong></span>&#30340;&#36755;&#20986;&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#25991;&#20214;&#24050;&#32463;&#38145;&#23450;&#12290;</p>
        <pre class="screen">
$ svn status
     K banana.jpg

$ svn info banana.jpg
Path: banana.jpg
Name: banana.jpg
URL: http://svn.example.com/repos/project/banana.jpg
Repository UUID: edb2f264-5ef2-0310-a47a-87b0ce17a8ec
Revision: 2198
Node Kind: file
Schedule: normal
Last Changed Author: frank
Last Changed Rev: 1950
Last Changed Date: 2006-03-15 12:43:04 -0600 (Wed, 15 Mar 2006)
Text Last Updated: 2006-06-08 19:23:07 -0500 (Thu, 08 Jun 2006)
Properties Last Updated: 2006-06-08 19:23:07 -0500 (Thu, 08 Jun 2006)
Checksum: 3b110d3b10638f5d1f4fe0f436a5a2a5
Lock Token: opaquelocktoken:0c0f600b-88f9-0310-9e48-355b44d4a58e
Lock Owner: harry
Lock Created: 2006-06-14 17:20:31 -0500 (Wed, 14 Jun 2006)
Lock Comment (1 line):
Editing file for tomorrow's release.

$
</pre>
        <p><span class="command"><strong>svn info</strong></span>&#21629;&#20196;&#19981;&#20250;&#32852;&#31995;&#29256;&#26412;&#24211;&#65292;&#24403;&#23545;&#24037;&#20316;&#25335;&#36125;&#36335;&#24452;&#24212;&#29992;<span class="command"><strong>svn info</strong></span>&#21629;&#20196;&#26102;&#65292;&#21487;&#20197;&#25581;&#31034;&#20196;&#29260;&#30340;&#19968;&#20010;&#37325;&#35201;&#20107;&#23454;&#8212;&#23427;&#20204;&#32531;&#23384;&#22312;&#24037;&#20316;&#25335;&#36125;&#12290;&#26377;&#38145;&#23450;&#20196;&#29260;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#65292;&#36825;&#32473;&#20102;&#24037;&#20316;&#25335;&#36125;&#26435;&#21033;&#21033;&#29992;&#36825;&#20010;&#38145;&#30340;&#33021;&#21147;&#12290;<span class="command"><strong>svn status</strong></span>&#20250;&#22312;&#25991;&#20214;&#21518;&#38754;&#26174;&#31034;&#19968;&#20010;<code class="literal">K</code>(locKed&#30340;&#32553;&#20889;)&#65292;&#34920;&#26126;&#20102;&#25317;&#26377;&#38145;&#23450;&#20196;&#29260;&#12290;</p>
        <div class="sidebar"><p class="title"><b>&#20851;&#20110;&#38145;&#23450;&#20196;&#29260;</b></p>
          
          <p>A lock token isn't an authentication token, so much as
          an <span class="emphasis"><em>authorization</em></span> token.  The token
          isn't a protected secret.  In fact, a lock's unique token is
          discoverable by anyone who runs <strong class="userinput"><code>svn info
          <em class="replaceable"><code>URL</code></em></code></strong>.  A lock token is special only when it lives
          inside a working copy.  It's proof that the lock was created
          in that particular working copy, and not somewhere else by
          some other client.  Merely authenticating as the lock owner
          isn't enough to prevent accidents.</p>
          <p>For example, suppose you lock a file using a computer at
          your office, but leave work for the day before you finish
          your changes to that file.  It should not be possible to
          accidentally commit changes to that same file from your home
          computer later that evening simply because you've
          authenticated as the lock's owner.  In other words, the lock
          token prevents one piece of Subversion-related software from
          undermining the work of another.  (In our example, if you
          really need to change the file from an alternative working
          copy, you would need to <em class="firstterm">break</em> the lock and relock the
          file.)</p>
        </div>
        <p>&#29616;&#22312;Harry&#24050;&#32463;&#38145;&#23450;&#20102;<code class="filename">banana.jpg</code>&#65292;Sally&#19981;&#33021;&#20462;&#25913;&#25110;&#21024;&#38500;&#36825;&#20010;&#25991;&#20214;&#65306;</p>
        <pre class="screen">
$ svn delete banana.jpg
D         banana.jpg
$ svn commit -m "Delete useless file."
Deleting       banana.jpg
svn: Commit failed (details follow):
svn: Server sent unexpected return value (423 Locked) in response to DELETE\
 request for '/repos/project/!svn/wrk/64bad3a9-96f9-0310-818a-df4224ddc35d/\
banana.jpg'
$
</pre>
        <p>&#20294;&#26159;&#65292;&#24403;&#23436;&#25104;&#20102;&#39321;&#34121;&#30340;&#40644;&#33394;&#28176;&#21464;&#65292;&#23601;&#21487;&#20197;&#25552;&#20132;&#25991;&#20214;&#30340;&#20462;&#25913;&#65292;&#22240;&#20026;&#35748;&#35777;&#20026;&#38145;&#23450;&#30340;&#25317;&#26377;&#32773;&#65292;&#20063;&#22240;&#20026;&#20182;&#30340;&#24037;&#20316;&#25335;&#36125;&#26377;&#27491;&#30830;&#30340;&#38145;&#23450;&#20196;&#29260;&#65306;</p>
        <pre class="screen">
$ svn status
M    K banana.jpg
$ svn commit -m "Make banana more yellow"
Sending        banana.jpg
Transmitting file data .
Committed revision 2201.
$ svn status
$
</pre>
        <p>Notice that after the commit is finished, <span class="command"><strong>svn
        status</strong></span> shows that the lock token is no longer
        present in the working copy.  This is the standard behavior of
        <span class="command"><strong>svn commit</strong></span>&#8212;it searches the working
        copy (or list of targets, if you provide such a list) for
        local modifications and sends all the lock tokens it
        encounters during this walk to the server as part of the
        commit transaction.  After the commit completes successfully,
        all of the repository locks that were mentioned are
        released&#8212;<span class="emphasis"><em>even on files that weren't
        committed</em></span>.  This is meant to discourage users from
        being sloppy about locking or from holding locks for too long.
        If Harry haphazardly locks 30 files in a directory named
        <code class="filename">images</code> because he's unsure of which files
        he needs to change, yet changes only four of those files, when he
        runs <strong class="userinput"><code>svn commit images</code></strong>, the process will
        still release all 30 locks.</p>
        <p>&#33258;&#21160;&#37322;&#25918;&#38145;&#23450;&#30340;&#29305;&#24615;&#21487;&#20197;&#36890;&#36807;<span class="command"><strong>svn commit</strong></span>&#30340;<code class="option">--no-unlock</code>&#36873;&#39033;&#20851;&#38381;&#65292;&#24403;&#20320;&#35201;&#25552;&#20132;&#25991;&#20214;&#65292;&#21516;&#26102;&#26399;&#26395;&#32487;&#32493;&#20462;&#25913;&#32780;&#24517;&#39035;&#20445;&#30041;&#38145;&#23450;&#26102;&#38750;&#24120;&#26377;&#29992;&#12290;&#36825;&#20010;&#29305;&#24615;&#20063;&#21487;&#20197;&#21322;&#27704;&#20037;&#24615;&#30340;&#35774;&#23450;&#65292;&#26041;&#27861;&#26159;&#35774;&#32622;&#36816;&#34892;&#20013;<code class="filename">config</code>&#25991;&#20214;(&#35265;<a class="xref" href="svn.customization.html#svn.advanced.confarea" title="&#36816;&#34892;&#37197;&#32622;&#21306;">&#8220;&#36816;&#34892;&#37197;&#32622;&#21306;&#8221;&#19968;&#33410;</a>)&#30340;<code class="literal">no-unlock = yes</code>&#12290;</p>
        <p>&#24403;&#28982;&#65292;&#38145;&#23450;&#19968;&#20010;&#25991;&#20214;&#19981;&#20250;&#24378;&#21046;&#19968;&#20010;&#20154;&#35201;&#25552;&#20132;&#20462;&#25913;&#65292;&#20219;&#20309;&#26102;&#20505;&#37117;&#21487;&#20197;&#36890;&#36807;&#36816;&#34892;<span class="command"><strong>svn unlock</strong></span>&#21629;&#20196;&#37322;&#25918;&#38145;&#23450;&#65306;</p>
        <pre class="screen">
$ svn unlock banana.c
'banana.c' unlocked.
</pre>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.advanced.locking.discovery"></a>&#21457;&#29616;&#38145;&#23450;</h3></div></div></div>
        
        <p>When a commit fails due to someone else's locks, it's
        fairly easy to learn about them.  The easiest way is to run
        <strong class="userinput"><code>svn status --show-updates</code></strong>:</p>
        <pre class="screen">
$ svn status -u
M              23   bar.c
M    O         32   raisin.jpg
       *       72   foo.h
Status against revision:     105
$
</pre>
        <p>In this example, Sally can see not only that her copy of
        <code class="filename">foo.h</code> is out of date, but also that one of the
        two modified files she plans to commit is locked in the
        repository.  The <code class="literal">O</code> symbol stands for
        &#8220;<span class="quote">Other,</span>&#8221; meaning that a lock exists on the file
        and was created by somebody else.  If she were to attempt a
        commit, the lock on <code class="filename">raisin.jpg</code> would
        prevent it.  Sally is left wondering who made the lock, when,
        and why.  Once again, <span class="command"><strong>svn info</strong></span> has the
        answers:</p>
        <pre class="screen">
$ svn info http://svn.example.com/repos/project/raisin.jpg
Path: raisin.jpg
Name: raisin.jpg
URL: http://svn.example.com/repos/project/raisin.jpg
Repository UUID: edb2f264-5ef2-0310-a47a-87b0ce17a8ec
Revision: 105
Node Kind: file
Last Changed Author: sally
Last Changed Rev: 32
Last Changed Date: 2006-01-25 12:43:04 -0600 (Sun, 25 Jan 2006)
Lock Token: opaquelocktoken:fc2b4dee-98f9-0310-abf3-653ff3226e6b
Lock Owner: harry
Lock Created: 2006-02-16 13:29:18 -0500 (Thu, 16 Feb 2006)
Lock Comment (1 line):
Need to make a quick tweak to this image.
$
</pre>
        <p>Just as you can use <span class="command"><strong>svn info</strong></span> to examine
        objects in the working copy, you can also use it to examine
        objects in the repository.  If the main argument to
        <span class="command"><strong>svn info</strong></span> is a working copy path, then all
        of the working copy's cached information is displayed; any
        mention of a lock means that the working copy is holding a
        lock token (if a file is locked by another user or in another
        working copy, <span class="command"><strong>svn info</strong></span> on a working copy
        path will show no lock information at all).  If the main
        argument to <span class="command"><strong>svn info</strong></span> is a URL, the
        information reflects the latest version of an object in the
        repository, and any mention of a lock describes the current
        lock on the object.</p>
        <p>So in this particular example, Sally can see that Harry
        locked the file on February 16 to &#8220;<span class="quote">make a quick
        tweak.</span>&#8221;  It being June, she suspects that he probably
        forgot all about the lock.  She might phone Harry to complain
        and ask him to release the lock.  If he's unavailable, she
        might try to forcibly break the lock herself or ask an
        administrator to do so.</p>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.advanced.locking.break-steal"></a>&#35299;&#38500;&#21644;&#20599;&#31363;&#38145;&#23450;</h3></div></div></div>
        
        <p>&#29256;&#26412;&#24211;&#38145;&#23450;&#24182;&#19981;&#26159;&#31070;&#22307;&#19981;&#21487;&#20405;&#29359;&#30340;&#8212;&#22312;Subversion&#30340;&#32570;&#30465;&#37197;&#32622;&#29366;&#24577;&#65292;&#19981;&#21482;&#26159;&#21019;&#24314;&#32773;&#21487;&#20197;&#37322;&#25918;&#38145;&#23450;&#65292;&#20219;&#20309;&#20154;&#37117;&#21487;&#20197;&#12290;&#24403;&#26377;&#20854;&#20182;&#20154;&#26399;&#26395;&#28040;&#28781;&#38145;&#23450;&#26102;&#65292;&#25105;&#20204;&#31216;&#20043;&#20026;<em class="firstterm">&#25171;&#30772;</em>&#38145;&#23450;&#12290;</p>
        <p>&#20174;&#31649;&#29702;&#21592;&#30340;&#20301;&#23376;&#19978;&#24456;&#23481;&#26131;&#25171;&#30772;&#38145;&#23450;&#65292;<span class="command"><strong>svnlook</strong></span>&#21644;<span class="command"><strong>svnadmin</strong></span>&#31243;&#24207;&#37117;&#26377;&#33021;&#21147;&#20174;&#29256;&#26412;&#24211;&#30452;&#25509;&#26174;&#31034;&#21644;&#21024;&#38500;&#38145;&#23450;&#12290;(&#20851;&#20110;&#36825;&#20123;&#24037;&#20855;&#30340;&#20449;&#24687;&#21487;&#20197;&#30475;<a class="xref" href="svn.reposadmin.maint.html#svn.reposadmin.maint.tk" title="&#31649;&#29702;&#21592;&#30340;&#24037;&#20855;&#31665;">&#8220;&#31649;&#29702;&#21592;&#30340;&#24037;&#20855;&#31665;&#8221;&#19968;&#33410;</a>&#12290;)</p>
        <pre class="screen">
$ svnadmin lslocks /var/svn/repos
Path: /project2/images/banana.jpg
UUID Token: opaquelocktoken:c32b4d88-e8fb-2310-abb3-153ff1236923
Owner: frank
Created: 2006-06-15 13:29:18 -0500 (Thu, 15 Jun 2006)
Expires: 
Comment (1 line):
Still improving the yellow color.

Path: /project/raisin.jpg
UUID Token: opaquelocktoken:fc2b4dee-98f9-0310-abf3-653ff3226e6b
Owner: harry
Created: 2006-02-16 13:29:18 -0500 (Thu, 16 Feb 2006)
Expires: 
Comment (1 line):
Need to make a quick tweak to this image.

$ svnadmin rmlocks /var/svn/repos /project/raisin.jpg
Removed lock on '/project/raisin.jpg'.
$
</pre>
        <p>The more interesting option is to allow users to break
        each other's locks over the network.  To do this, Sally simply
        needs to pass the <code class="option">--force</code> to the <span class="command"><strong>svn
        unlock</strong></span> command:</p>
        <pre class="screen">
$ svn status -u
M              23   bar.c
M    O         32   raisin.jpg
       *       72   foo.h
Status against revision:     105
$ svn unlock raisin.jpg
svn: 'raisin.jpg' is not locked in this working copy
$ svn info raisin.jpg | grep URL
URL: http://svn.example.com/repos/project/raisin.jpg
$ svn unlock http://svn.example.com/repos/project/raisin.jpg
svn: Unlock request failed: 403 Forbidden (http://svn.example.com)
$ svn unlock --force http://svn.example.com/repos/project/raisin.jpg
'raisin.jpg' unlocked.
$
</pre>
        <p>Sally&#21021;&#22987;&#30340;unlock&#21629;&#20196;&#22833;&#36133;&#20102;&#65292;&#22240;&#20026;&#22905;&#30452;&#25509;&#22312;&#33258;&#24049;&#30340;&#24037;&#20316;&#25335;&#36125;&#19978;&#36816;&#34892;&#20102;<span class="command"><strong>svn unlock</strong></span>&#65292;&#32780;&#36825;&#37324;&#27809;&#26377;&#38145;&#23450;&#20196;&#29260;&#12290;&#20026;&#20102;&#30452;&#25509;&#20174;&#29256;&#26412;&#24211;&#21024;&#38500;&#38145;&#23450;&#65292;&#22905;&#38656;&#35201;&#32473;<span class="command"><strong>svn unlock</strong></span>&#20256;&#36882;URL&#21442;&#25968;&#65292;&#22905;&#30340;&#36825;&#19968;&#27425;&#23581;&#35797;&#21448;&#22833;&#36133;&#20102;&#65292;&#22240;&#20026;&#22905;&#19981;&#26159;&#38145;&#23450;&#30340;&#25317;&#26377;&#32773;(&#20063;&#27809;&#26377;&#38145;&#23450;&#20196;&#29260;)&#12290;&#24403;&#22905;&#20351;&#29992;&#20102;<code class="option">--force</code>&#36873;&#39033;&#21518;&#65292;&#35748;&#35777;&#21644;&#25480;&#26435;&#30340;&#35201;&#27714;&#34987;&#24573;&#30053;&#20102;&#65292;&#36828;&#31243;&#30340;&#38145;&#23450;&#34987;&#25171;&#30772;&#20102;&#12290;</p>
        <p>Simply breaking a lock may not be enough.  In
        the running example, Sally may not only want to break Harry's
        long-forgotten lock, but relock the file for her own use.
        She can accomplish this by using <span class="command"><strong>svn unlock</strong></span>
        with <code class="option">--force</code> and then <span class="command"><strong>svn lock</strong></span>
        back-to-back, but there's a small chance that somebody else
        might lock the file between the two commands.  The simpler thing
        to do is to <em class="firstterm">steal</em> the lock, which involves
        breaking and relocking the file all in one atomic step.  To
        do this, Sally passes the <code class="option">--force</code> option
        to <span class="command"><strong>svn lock</strong></span>:</p>
        <pre class="screen">
$ svn lock raisin.jpg
svn: Lock request failed: 423 Locked (http://svn.example.com)
$ svn lock --force raisin.jpg
'raisin.jpg' locked by user 'sally'.
$
</pre>
        <p>In any case, whether the lock is broken or stolen, Harry
        may be in for a surprise.  Harry's working copy still contains
        the original lock token, but that lock no longer exists.  The
        lock token is said to be <em class="firstterm">defunct</em>.  The
        lock represented by the lock token has either been broken (no
        longer in the repository) or stolen (replaced with a
        different lock).  Either way, Harry can see this by asking
        <span class="command"><strong>svn status</strong></span> to contact the
        repository:</p>
        <pre class="screen">
$ svn status
     K raisin.jpg
$ svn status -u
     B         32   raisin.jpg
$ svn update
  B  raisin.jpg
$ svn status
$
</pre>
        <p>If the repository lock was broken, then <strong class="userinput"><code>svn
        status --show-updates</code></strong> displays a
        <code class="literal">B</code> (Broken) symbol next to the file.  If a
        new lock exists in place of the old one, then a
        <code class="literal">T</code> (sTolen) symbol is shown.  Finally,
        <span class="command"><strong>svn update</strong></span> notices any defunct lock tokens
        and removes them from the working copy.</p>
        <div class="sidebar"><p class="title"><b>&#38145;&#23450;&#31574;&#30053;</b></p>
          
          <p>Different systems have different notions of how strict a
          lock should be.  Some folks argue that locks must be
          strictly enforced at all costs, releasable only by the
          original creator or administrator.  They argue that if
          anyone can break a lock, chaos runs rampant and the
          whole point of locking is defeated.  The other side argues
          that locks are first and foremost a communication tool.  If
          users are constantly breaking each other's locks, it
          represents a cultural failure within the team and the
          problem falls outside the scope of software enforcement.</p>
          <p>Subversion&#32570;&#30465;&#26159;&#27604;&#36739;&#8220;<span class="quote">&#23485;&#26494;&#30340;</span>&#8221;&#26041;&#24335;&#65292;&#20294;&#20063;&#20801;&#35768;&#31649;&#29702;&#21592;&#21019;&#24314;&#38057;&#23376;&#33050;&#26412;&#26469;&#24314;&#31435;&#20005;&#26684;&#30340;&#25511;&#21046;&#31574;&#30053;&#12290;&#20855;&#20307;&#26469;&#35828;&#65292;<code class="filename">pre-lock</code>&#21644;<code class="filename">pre-unlock</code>&#38057;&#23376;&#20801;&#35768;&#31649;&#29702;&#21592;&#20915;&#23450;&#20160;&#20040;&#26102;&#20505;&#21019;&#24314;&#21644;&#37322;&#25918;&#38145;&#23450;&#12290;&#26681;&#25454;&#38145;&#23450;&#26159;&#21542;&#24050;&#32463;&#23384;&#22312;&#65292;&#36825;&#20004;&#20010;&#38057;&#23376;&#33050;&#26412;&#21487;&#20197;&#20915;&#23450;&#26159;&#21542;&#20801;&#35768;&#29305;&#23450;&#29992;&#25143;&#25171;&#30772;&#25110;&#31363;&#21462;&#38145;&#23450;&#12290;&#20063;&#26377;<code class="filename">post-lock</code>&#21644;<code class="filename">post-unlock</code>&#38057;&#23376;&#65292;&#21487;&#20197;&#29992;&#26469;&#21457;&#36865;&#38145;&#23450;&#21160;&#20316;&#30340;&#36890;&#30693;&#37038;&#20214;&#12290;&#20851;&#20110;&#29256;&#26412;&#24211;&#38057;&#23376;&#30340;&#26356;&#22810;&#20449;&#24687;&#21487;&#20197;&#30475;<a class="xref" href="svn.reposadmin.create.html#svn.reposadmin.create.hooks" title="&#23454;&#29616;&#29256;&#26412;&#24211;&#38057;&#23376;">&#8220;&#23454;&#29616;&#29256;&#26412;&#24211;&#38057;&#23376;&#8221;&#19968;&#33410;</a>&#12290;</p>
        </div>
      </div>
      
      <div class="section" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="svn.advanced.locking.lock-communication"></a>&#38145;&#23450;&#20132;&#27969;</h3></div></div></div>
        
        <p>&#25105;&#20204;&#24050;&#32463;&#35265;&#21040;&#20102;&#22914;&#20309;&#21033;&#29992;<span class="command"><strong>svn lock</strong></span>&#21644;<span class="command"><strong>svn unlock</strong></span>&#26469;&#21019;&#24314;&#12289;&#37322;&#25918;&#12289;&#25171;&#30772;&#21644;&#31363;&#21462;&#38145;&#23450;&#65292;&#36825;&#23601;&#28385;&#36275;&#20102;&#39034;&#24207;&#35775;&#38382;&#25991;&#20214;&#30340;&#35201;&#27714;&#65292;&#20294;&#26159;&#28010;&#36153;&#26102;&#38388;&#36825;&#20010;&#22823;&#38382;&#39064;&#35813;&#22914;&#20309;&#21602;&#65311;</p>
        <p>For example, suppose Harry locks an image file and then
        begins editing it.  Meanwhile, miles away, Sally wants to do
        the same thing.  She doesn't think to run <strong class="userinput"><code>svn status
        --show-updates</code></strong>, so she has no idea that Harry has
        already locked the file.  She spends hours editing the file,
        and when she tries to commit her change, she discovers that
        either the file is locked or that she's out of date.
        Regardless, her changes aren't mergeable with Harry's.  One of
        these two people has to throw away his or her work, and a lot of
        time has been wasted.</p>
        <p>Subversion's solution to this problem is to provide a
        mechanism to remind users that a file ought to be locked
        <span class="emphasis"><em>before</em></span> the editing begins.  The mechanism
        is a special property:  <code class="literal">svn:needs-lock</code>.  If
        that property is attached to a file (regardless of its value,
        which is irrelevant), Subversion will try to use
        filesystem-level permissions to make the file read-only&#8212;unless,
        of course, the user has explicitly locked the file.
        When a lock token is present (as a result of using
        <span class="command"><strong>svn lock</strong></span>), the file becomes read/write.
        When the lock is released, the file becomes read-only
        again.</p>
        <p>The theory, then, is that if the image file has this
        property attached, Sally would immediately notice
        something is strange when she opens the file for editing:
        many applications alert users immediately when a read-only
        file is opened for editing, and nearly all would
        prevent her from saving changes to the file.  This
        reminds her to lock the file before editing, whereby she
        discovers the preexisting lock:</p>
        <pre class="screen">
$ /usr/local/bin/gimp raisin.jpg
gimp: error: file is read-only!
$ ls -l raisin.jpg
-r--r--r--   1 sally   sally   215589 Jun  8 19:23 raisin.jpg
$ svn lock raisin.jpg
svn: Lock request failed: 423 Locked (http://svn.example.com)
$ svn info http://svn.example.com/repos/project/raisin.jpg | grep Lock
Lock Token: opaquelocktoken:fc2b4dee-98f9-0310-abf3-653ff3226e6b
Lock Owner: harry
Lock Created: 2006-06-08 07:29:18 -0500 (Thu, 08 June 2006)
Lock Comment (1 line):
Making some tweaks.  Locking for the next two hours.
$
</pre>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">&#25552;&#31034;</h3>
          <p>&#25105;&#20204;&#40723;&#21169;&#29992;&#25143;&#21644;&#31649;&#29702;&#21592;&#37117;&#24212;&#35813;&#32473;&#19981;&#33021;&#26681;&#25454;&#19978;&#19979;&#25991;&#30340;&#25991;&#20214;&#28155;&#21152;<code class="literal">svn:needs-lock</code>&#23646;&#24615;&#65292;&#36825;&#26159;&#40723;&#21169;&#22909;&#30340;&#38145;&#23450;&#20064;&#24815;&#21644;&#38450;&#27490;&#28010;&#36153;&#30340;&#20027;&#35201;&#25216;&#26415;&#25163;&#27573;&#12290;</p>
        </div>
        <p>&#38656;&#35201;&#27880;&#24847;&#21040;&#36825;&#20010;&#23646;&#24615;&#26159;&#20381;&#36182;&#20110;&#38145;&#23450;&#31995;&#32479;&#30340;&#20132;&#27969;&#24037;&#20855;&#65292;&#19981;&#31649;&#26159;&#21542;&#26377;&#36825;&#20010;&#23646;&#24615;&#65292;&#25991;&#20214;&#37117;&#21487;&#20197;&#38145;&#23450;&#12290;&#30456;&#21453;&#30340;&#65292;&#26080;&#35770;&#26377;&#27809;&#26377;&#36825;&#20010;&#23646;&#24615;&#65292;&#24182;&#19981;&#20250;&#35201;&#27714;&#25552;&#20132;&#38656;&#35201;&#39318;&#20808;&#38145;&#23450;&#25991;&#20214;&#12290;</p>
        <p>&#36825;&#20010;&#31995;&#32479;&#24182;&#19981;&#26159;&#27627;&#26080;&#29781;&#30133;&#65292;&#21363;&#20351;&#26377;&#36825;&#20010;&#23646;&#24615;&#65292;&#21482;&#35835;&#25552;&#37266;&#20063;&#26377;&#21487;&#33021;&#22833;&#25928;&#12290;&#26377;&#20123;&#31243;&#24207;&#8220;<span class="quote">&#20599;&#20599;&#30340;&#31713;&#25913;&#20102;</span>&#8221;&#25991;&#20214;&#30340;&#21482;&#35835;&#23646;&#24615;&#65292;&#24708;&#26080;&#22768;&#24687;&#30340;&#20801;&#35768;&#29992;&#25143;&#32534;&#36753;&#21644;&#20445;&#23384;&#25991;&#20214;&#65292;&#19981;&#24184;&#30340;&#26159;&#65292;Subversion&#23545;&#27492;&#26080;&#33021;&#20026;&#21147;&#8212;&#21363;&#20351;&#21040;&#20102;&#29616;&#20170;&#65292;&#36824;&#26159;&#27809;&#26377;&#20219;&#20309;&#24037;&#20855;&#33021;&#22815;&#20195;&#26367;&#20154;&#19982;&#20154;&#30340;&#33391;&#22909;&#20132;&#27969;&#12290;<sup>[<a name="d4e2652" href="#ftn.d4e2652" class="footnote">15</a>]</sup></p>
      </div>
    <div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d4e2472" href="#d4e2472" class="para">13</a>] </sup>&#23545;&#20110;Harry&#21644;Sally&#30340;&#22909;&#33713;&#22366;&#21516;&#21517;&#20154;&#26469;&#35828;&#20132;&#27969;&#20063;&#19981;&#26159;&#37027;&#20040;&#24046;&#30340;&#33647;&#65292;&#20063;&#26159;&#20851;&#20110;&#37027;&#19968;&#28857;&#12290;</p></div><div class="footnote"><p><sup>[<a name="ftn.d4e2478" href="#d4e2478" class="para">14</a>] </sup>Subversion&#30446;&#21069;&#19981;&#20801;&#35768;&#38145;&#23450;&#30446;&#24405;&#12290;</p></div><div class="footnote"><p><sup>[<a name="ftn.d4e2652" href="#d4e2652" class="para">15</a>] </sup>&#38500;&#38750;&#26159;&#65292;&#25110;&#35768;&#19968;&#20010;&#32463;&#20856;&#30340;&#28779;&#31070;&#31934;&#31070;&#34701;&#21512;&#12290;</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="svn.advanced.sparsedirs.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="svn.advanced.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="svn.advanced.externals.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31232;&#30095;&#30446;&#24405;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#22806;&#37096;&#23450;&#20041;</td></tr></table></div></body></html>