<?xml version="1.0" encoding="UTF-8"?>
<!--
   ant pdf html html-single
-->
<project name="docbook" default="html">

    <!-- load properties -->
    <property file="build4.properties"/>

    <!-- Set build directories for all formats. -->
    <property name="build.dir"                  value="${basedir}/build"/>

    <!-- Set DocBook stylesheets. -->
    <property name="db.style.fopdf"             value="${docbook.dir}/docbook4-custom/fopdf.xsl"/>
    <property name="db.style.html.stylesheet"   value="${docbook.dir}/docbook4-custom/html.css"/>
    <property name="db.style.htmlsingle"        value="${docbook.dir}/docbook4-custom/html.xsl"/>
    <property name="db.style.html"              value="${docbook.dir}/docbook4-custom/html_chunk.xsl"/>

    <!-- Classpath for the build tools. -->
    <path id="lib.classpath">
        <fileset dir="${fop.dir}/lib">
            <include name="**/*.jar"/>
        </fileset>
    </path>

    <target name="clean">
        <!-- Delete build directory. -->
        <delete dir="${build.dir}"/>
    </target>

    <target name="all" depends="clean">
        <!-- Compile the documentation in all formats. -->
        <antcall target="pdf"/>
        <antcall target="html"/>
        <antcall target="html-single"/>
    </target>


    <target name="pdf.prepare">

        <!-- Copy all the images to the output location, will be removed later. -->
        <copy todir="${build.dir}/pdf/images">
            <fileset dir="${basedir}/images">
                <include name="**/*.png"/>
                <include name="**/*.svg"/>
                <include name="**/*.gif"/>
            </fileset>
        </copy>

        <!-- Create the XSL/FO temporary file. -->
        <java classname="com.icl.saxon.StyleSheet" fork="true" dir="${basedir}" maxmemory="512m" >
            <classpath refid="lib.classpath"/>
            <arg value="-o"/>
            <arg value="${build.dir}/pdf/${doc.name}.fo"/>
            <arg value="${basedir}/master4.xml"/>
            <arg value="${db.style.fopdf}"/>
        </java>

    </target>

    <target name="pdf" depends="pdf.prepare">

        <!-- Copy all fonts to the output location, will be removed later. -->
        <copy todir="${build.dir}/pdf">
            <fileset dir="${fonts.dir}">
                <include name="*"/>
            </fileset>
        </copy>

        <!-- Create a PDF from the XSL/FO, using customized fop userconfig.xml -->
        <java classname="org.apache.fop.apps.Fop" fork="true" dir="${basedir}" maxmemory="512m" >
            <classpath refid="lib.classpath"/>
            <arg value="-c"/>
            <arg value="${fonts.dir}/userconfig.xml"/>
            <arg value="${build.dir}/pdf/${doc.name}.fo"/>
            <arg value="${build.dir}/pdf/${doc.name}.pdf"/>
        </java>

        <!-- House keeping, delete temporary files. -->
        <delete>
            <fileset dir="${build.dir}/pdf" excludes="**/*.pdf"/>
        </delete>
        <delete  dir="${build.dir}/pdf/images"/>
    </target>

    <target name="html">

        <!-- Make the output dir. -->
        <mkdir dir="${build.dir}/html/"/>

        <!-- Create html files -->
        <java classname="com.icl.saxon.StyleSheet" fork="true" dir="${build.dir}/html" maxmemory="512m" >
            <classpath refid="lib.classpath"/>
            <arg value="${basedir}/master4.xml"/>
            <arg value="${db.style.html}"/>
        </java>

        <!-- Copy html stylesheet to the output location. -->
        <copy file="${db.style.html.stylesheet}" todir="${build.dir}/html"/>
    </target>

    <target name="html-single">

        <!-- Make the output dir. -->
        <mkdir dir="${build.dir}/html_single/"/>

        <!-- Create html files -->
        <java classname="com.icl.saxon.StyleSheet" fork="true" dir="${basedir}" maxmemory="512m" >
            <classpath refid="lib.classpath"/>
            <arg value="-o"/>
            <arg value="${build.dir}/html_single/index.html"/>
            <arg value="${basedir}/master4.xml"/>
            <arg value="${db.style.htmlsingle}"/>
        </java>

        <!-- Copy html stylesheet to the output location. -->
        <copy file="${db.style.html.stylesheet}" todir="${build.dir}/html_single"/>
    </target>

</project>
